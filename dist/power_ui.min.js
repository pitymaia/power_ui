"use strict";function getIdAndCreateIfDontHave(e){let t=e.id;return t||(t=_Unique.domID(e.tagName.toLowerCase())),e.setAttribute("id",t),t}function asDataSet(e){const t=e.split("-").filter(e=>"data"!=e);let n="";for(let e=0;e<t.length;e++)n+=0===e?t[e]:t[e].replace(/\b\w/g,e=>e.toUpperCase());return n}function powerClassAsCamelCase(e){return`${e.split("-")[0]}${e.split("-")[1].charAt(0).toUpperCase()}${e.split("-")[1].slice(1)}`}class SharedScope{constructor({id:e,main:t,view:n,rootCompiler:s,parent:i,ctx:r}){this.id=e,this.tempMainEl=t,this.tempViewEl=n,this.tempRootCompilerEl=s,this.tempParent=i||{node:null,datasetKey:null},this.ctx=r,this.cached={}}get element(){return document.getElementById(this.id)}get main(){return this.tempMainEl?document.getElementById(this.tempMainEl.id):null}get view(){return this.tempViewEl?document.getElementById(this.tempViewEl.id):null}get rootCompiler(){return this.tempRootCompilerEl?document.getElementById(this.tempRootCompilerEl.id):null}get parentNode(){return this.tempParent.node?document.getElementById(this.tempParent.node.id):null}get parentDatasetKey(){return this.tempParent.datasetKey}get parentObj(){if(!this.parentNode)return null;const e=this.parentNode.id,t=this.parentDatasetKey;return this.ctx.allPowerObjsById[e]&&this.ctx.allPowerObjsById[e][t]?this.ctx.allPowerObjsById[e][t]:null}get mainObj(){return this.cached.isMain||this.getTarget(this.main.id,"isMain")}get viewObj(){return this.cached.isView||this.getTarget(this.view.id,"isView")}get rootCompilerObj(){const e="isRootCompiler";return this.cached[e]||this.getTarget(this.rootCompiler.id,e)}getTarget(e,t){if(!e)return!1;if(null!=this.cached[t])return this.cached[t];for(const n of Object.keys(this.ctx.allPowerObjsById[e]||{}))if(this.ctx.allPowerObjsById[e][n][t])return this.cached[t]=this.ctx.allPowerObjsById[e][n],this.cached[t];this.cached[t]=!1}removeInnerElementsFromPower(){const e=this.element.children;for(const t of e)this.removeElementAndInnersFromPower(t),this.element.removeChild(t);delete this.element.dataset.pwhascomp}removeElementAndInnersFromPower(e){(e=e||this.element).id&&this.ctx.allPowerObjsById[e.id]&&(this.ctx.removeEventsOfObject(e.id),delete this.ctx.allPowerObjsById[e.id]);const t=e.children;for(const e of t)this.removeElementAndInnersFromPower(e)}}class _PowerUiBase{constructor(){this._tempScope={}}_createPowerTree(){this.powerTree=new PowerTree(this,_PowerUiBase),this.powerTree._callInit()}}_PowerUiBase._powAttrsConfig=[],_PowerUiBase.injectPow=function(e){e.datasetKey=asDataSet(e.name),_PowerUiBase._powAttrsConfig.push(e)},_PowerUiBase._pwcAttrsConfig=[],_PowerUiBase.injectPwc=function(e){powAttr.datasetKey=asDataSet(powAttr.name),_PowerUiBase._pwcAttrsConfig.push(e)},_PowerUiBase._powerElementsConfig=[],_PowerUiBase.injectPowerCss=function(e){e.datasetKey=asDataSet(e.name),e.isMain?_PowerUiBase._powerElementsConfig.unshift(e):_PowerUiBase._powerElementsConfig.push(e)};const _Unique={n:0,next:()=>++_Unique.n,domID:e=>`_pow${e?"_"+e:"er"}_${_Unique.next()}`,scopeID:()=>`_scope_${_Unique.next()}`};class UEvent{constructor(e){this.observers=[],e&&(UEvent.index[e]=this)}subscribe(e,t,n){this.unsubscribe(e),this.observers.push({fn:e,ctx:t,arguments:arguments})}unsubscribe(e){this.observers=this.observers.filter(t=>t.fn!==e)}broadcast(){for(const e of this.observers)e.fn.apply(e.ctx,e.arguments)}}UEvent.index={};class _PowerBasicElement{constructor(e){this.tempEl=e,this._$pwActive=!1}get id(){return this.element.id||null}set id(e){this.element.id=e}get element(){return this.$shared?this.$shared.element:this.tempEl}get $pwMain(){return this.$shared?this.$shared.mainObj:null}get $pwView(){return this.$shared?this.$shared.viewObj:null}get parent(){return this.$shared?this.$shared.parentObj:null}get children(){return this._cachedChildren||this._getChildren()}_getChildren(){this._cachedChildren=[];const e=this.element;for(const t of e.children)if(t.className.includes("power-"))for(const e of Object.keys(this.$powerUi.powerTree.allPowerObjsById[t.id]||{}))e.startsWith("power")&&this._cachedChildren.push(this.$powerUi.powerTree.allPowerObjsById[t.id][e]);return this._cachedChildren}get innerPowerCss(){return this._cachedInnerPowerCss||this._getInnerPowerCss()}_getInnerPowerCss(){return this._cachedInnerPowerCss=this.$powerUi.powerTree._getAllInnerPowerCss(this.element),this._cachedInnerPowerCss}}class _PowerBasicElementWithEvents extends _PowerBasicElement{constructor(e){super(e),this._events={},this._DOMEvents={},this._events_fn={}}toggle(){this._$pwActive=!this._$pwActive,this.broadcast("toggle",!0)}subscribe({event:e,fn:t,useCapture:n=!0,...s}){this.unsubscribe({event:e,fn:t,useCapture:n,params:s});const i=this;this._events[e]||(this._events[e]=new UEvent(this.id),this._DOMEvents[e]||(this._DOMEvents[e]=new CustomEvent(e,{bubbles:n})),this._events_fn[e]=function(t){i._events[e].broadcast(i,t,s)},this.addEventListener(e,this._events_fn[e],n)),this._events[e].subscribe(t,i,s)}unsubscribe({event:e,fn:t,useCapture:n=!0,...s}){this._events[e]&&(this._events[e].unsubscribe(t),0===this._events[e].observers.length&&(delete this._events[e],this.removeEventListener(e,this._events_fn[e],n)))}broadcast(e,t){void 0!==document.body[e]||t?this._DOMEvents[e]&&this.element.dispatchEvent(this._DOMEvents[e]):(this._DOMEvents[e]&&this.element.dispatchEvent(this._DOMEvents[e]),this.dispatch(e))}dispatch(e){this[e]&&this[e]()}addEventListener(e,t,n=!1){this.element.addEventListener(e,t,n)}removeEventListener(e,t,n=!1){this.element&&this.element.removeEventListener(e,t,n)}getChildrenByPowerCss(e){return this.children.filter(t=>t.$powerCss===e)}getInnerByPowerCss(e){return this.innerPowerCss.filter(t=>t.$powerCss===e)}getInnerWithoutChildrenByPowerCss(e){return this.innerPowerCss.filter(t=>t.$powerCss===e&&t.parent.id!==this.id)}}class PowerTarget extends _PowerBasicElementWithEvents{constructor(e){super(e),this.powerTarget=!0}}class PowerTree{constructor(e,t){this.$powerUi=e,this.allPowerObjsById={},this.attrsConfig={};for(const e of _PowerUiBase._powAttrsConfig){e.callback(document.createElement("div")).compile&&(e.isCompiler=!0),this.attrsConfig[e.datasetKey]=e}for(const e of _PowerUiBase._pwcAttrsConfig){e.callback(document.createElement("div")).compile&&(e.isCompiler=!0),this.attrsConfig[e.datasetKey]=e}this.rootDatasetKeys=Object.keys(this.attrsConfig||{}).filter(e=>this.attrsConfig[e].isCompiler),this.mainDatasetKeys=this.getMainDatasetKeys(),this.buildAndInterpolate(document)}get rootCompilers(){const e={};for(const t of Object.keys(this.allPowerObjsById||{}))this.allPowerObjsById[t]&&this.allPowerObjsById[t].$shared.isRootCompiler&&!this.allPowerObjsById[t].powEvent&&(e[t]=this.allPowerObjsById[t].$shared.originalInnerHTML);return e}removeAllEvents(){for(const e of Object.keys(this.allPowerObjsById||{}))this.removeEventsOfObject(e);UEvent.index={}}resetRootCompilers(){for(const e of Object.keys(this.rootCompilers))if(this.allPowerObjsById[e]){this.removeEventsOfObject(e),this.allPowerObjsById[e].$shared.removeInnerElementsFromPower(),document.getElementById(e).innerHTML=this.rootCompilers[e]}}removeEventsOfObject(e){for(const t of Object.keys(this.allPowerObjsById[e]||{}))if("$shared"!==t)for(const n of Object.keys(this.allPowerObjsById[e][t]._events))for(const s of this.allPowerObjsById[e][t]._events[n].observers)s.ctx.unsubscribe({event:n,fn:s.fn})}getMainDatasetKeys(){const e=[];for(const t of PowerUi._powerElementsConfig)t.isMain&&e.push(t.datasetKey);for(const t of Object.keys(this.attrsConfig||{}))this.attrsConfig[t].isMain&&e.push(this.attrsConfig[t].datasetKey);return e}datasetIsCompiler(e){for(const t of Object.keys(e||{}))if(this.rootDatasetKeys.includes(t))return!0;return!1}datasetIsMain(e){for(const t of Object.keys(e||{}))if(this.mainDatasetKeys.includes(t))return!0;return!1}buildAndInterpolate(e,t){if(this.sweepDOM({entryNode:e,callback:this.buildPowerObjects.bind(this),isInnerCompiler:!1}),!t){const e=document.getElementsByTagName("BODY")[0];e.innerHTML=this.$powerUi.interpolation.replaceInterpolation(e.innerHTML,this)}}buildPowerObjects({currentNode:e,main:t,view:n,isInnerCompiler:s,saved:i,rootCompiler:r,parent:o}){let a=!1,l=[];s=s||!1;let h=o=o||!1;i=i||{pending:[]};const c=t=t||!1,u=n=n||!1;let d=!1,p=!1;if(e.dataset)for(const i of Object.keys(e.dataset||{}))for(const h of["pwc","pow"]){i.startsWith(h)&&(a=this._compile({currentNode:e,datasetKey:i,isInnerCompiler:s,view:n}),a&&!s&&(r=e,p=!0),this.attrsConfig[i]&&this.attrsConfig[i].isMain&&(t=e,d=!0),l.push({datasetKey:i,currentElement:e,main:c,view:u,rootCompiler:s?r:null,isMain:d,isRootCompiler:p,parent:o,originalInnerHTML:a}))}if(e.className&&e.className.includes("power-"))for(const i of PowerUi._powerElementsConfig)e.classList.contains(i.name)&&(i.isMain&&(t=e,d=!0),"powerView"===i.datasetKey&&(n=e),l.push({datasetKey:i.datasetKey,currentElement:e,main:c,view:u,rootCompiler:s?r:null,isMain:d,parent:o}),h={node:e,datasetKey:i.datasetKey});if(!!e.children&&!!e.children.length&&(a||s?this.sweepDOM({entryNode:e,callback:this.buildPowerObjects.bind(this),isInnerCompiler:!0,main:t,view:n,rootCompiler:r,saved:i,parent:h}):this.sweepDOM({entryNode:e,callback:this.buildPowerObjects.bind(this),isInnerCompiler:!1,main:t,view:n,rootCompiler:r,saved:i,parent:h})),a&&!s){e.innerHTML=this.$powerUi.interpolation.compile({template:e.innerHTML,view:n});for(const e of i.pending)this._instanciateObj(e);i.pending=[]}if(l.length>0&&!a||a&&!s){for(const e of l)this._instanciateObj(e);l=[]}else for(const e of l)i.pending.push(e)}getEntryNodeWithParentsAndConfig(e){const t=document.getElementById(e),n=this._getParentElementFromChildElement(t),s=this._getMainElementFromChildElement(t),i=this.datasetIsMain(t.dataset),r=this._getViewElementFromChildElement(t),o=this._getRootCompilerElementFromChildElement(t,this);return{currentNode:t,parent:n,main:s,isMain:i,view:r,isInnerCompiler:o&&this.datasetIsCompiler(t.dataset),rootCompiler:o}}createAndInitObjectsFromCurrentNode({id:e,refresh:t}){const n=this.getEntryNodeWithParentsAndConfig(e);if(this.buildPowerObjects(n),!t){const t=document.getElementById(e);t.innerHTML=this.$powerUi.interpolation.replaceInterpolation(t.innerHTML,this)}this._callInitForObjectAndInners(document.getElementById(e))}_compile({currentNode:e,datasetKey:t,isInnerCompiler:n,view:s}){let i=!1;if(this.attrsConfig[t]&&this.attrsConfig[t].isCompiler&&!0==!e.getAttribute("data-pwhascomp")){const r=getIdAndCreateIfDontHave(e),o=this.attrsConfig[t].callback(e);o.id=r,o.$powerUi=this.$powerUi,i=!!n||(e.innerHTML||!0),o.compile({view:s}),o.element.setAttribute("data-pwhascomp",!0)}return i}_instanciateObj({currentElement:e,datasetKey:t,main:n,view:s,rootCompiler:i,isMain:r,isRootCompiler:o,parent:a,originalInnerHTML:l}){const h=getIdAndCreateIfDontHave(e),c=this.$powerUi[`_${t}`]?`_${t}`:"powerAttrs";let u;if("powerAttrs"===c){if(!this.attrsConfig[t])return;u=this.attrsConfig[t].callback(document.getElementById(h))}else u=this.$powerUi[c](document.getElementById(h));u.isMain=r||null,u.isRootCompiler=o||null,u.originalInnerHTML=l&&!0!==l?l:"",this._addToObjectsById({powerObject:u,id:h,datasetKey:t,main:n,view:s,rootCompiler:i,parent:a})}_addToObjectsById({powerObject:e,id:t,datasetKey:n,main:s,view:i,rootCompiler:r,parent:o}){if(this.allPowerObjsById[t]){const e=document.querySelectorAll(`[id=${t}]`);if(e.length>1)throw console.error("DUPLICATED IDs:",e),`HTML element can't have duplicated IDs: ${t}`}else this.allPowerObjsById[t]={};this.allPowerObjsById[t][n]||(this.allPowerObjsById[t][n]={}),this.allPowerObjsById[t][n]=e,this.allPowerObjsById[t][n].id=t,this.allPowerObjsById[t][n].datasetKey=n,this.allPowerObjsById[t][n].$powerCss=n,this.allPowerObjsById[t][n].$powerUi=this.$powerUi,this.allPowerObjsById[t].$shared||(this.allPowerObjsById[t].$shared=new SharedScope({id:t,main:s,view:i,rootCompiler:r,parent:o,ctx:this})),e.isRootCompiler&&(this.allPowerObjsById[t].$shared.isRootCompiler=e.isRootCompiler,this.allPowerObjsById[t].$shared.originalInnerHTML=e.originalInnerHTML),this.allPowerObjsById[t][n].$shared=this.allPowerObjsById[t].$shared}sweepDOM({entryNode:e,callback:t,isInnerCompiler:n,main:s,view:i,rootCompiler:r,saved:o,parent:a}){const l=!!e&&!!e.nodeType,h=!!e.children&&!!e.children.length;if(l&&h){e.children;for(const l of e.children)t({currentNode:l,callback:t,isInnerCompiler:n,main:s,view:i,rootCompiler:r,saved:o,parent:a})}else t({currentNode:e,callback:t,isInnerCompiler:n,main:s,view:i,rootCompiler:r,saved:o,parent:a})}_getAllInnerPowerCss(e){const t=[];for(const n of _PowerUiBase._powerElementsConfig){const s=e.getElementsByClassName(n.name);for(const e of s){const s=this.allPowerObjsById[e.id][n.datasetKey];t.push(s)}}return t}_getParentElementFromChildElement(e){const t=PowerTree._searchUpDOM(e,PowerTree._checkIfhavePowerParentElement);if(t.conditionResult)return t.powerElement}_getMainElementFromChildElement(e){const t=PowerTree._searchUpDOM(e,this._checkIfIsMainElement);if(t.conditionResult)return t.powerElement}_getViewElementFromChildElement(e){const t=PowerTree._searchUpDOM(e,this._checkIfIsViewElement);if(t.conditionResult)return t.powerElement}_getRootCompilerElementFromChildElement(e,t){const n=PowerTree._searchUpDOM(e,this._checkIfIsCompilerElement,t);if(n.conditionResult)return n.powerElement}_checkIfIsCompilerElement(e,t){let n=!1;return e&&e.dataset&&t.datasetIsCompiler(e.dataset)&&(n=!0),n}_checkIfIsMainElement(e){let t=!1;if(e&&e.className)for(const n of PowerUi._powerElementsConfig.filter(e=>!0===e.isMain))if(e.classList.contains(n.name)){t=!0;break}return t}_checkIfIsViewElement(e){return e&&e.className&&e.classList.contains("power-view")}_callInit(){for(const e of Object.keys(this.allPowerObjsById||{}))this._callInitOfObject(e)}_callInitOfObject(e){for(const t of Object.keys(this.allPowerObjsById[e]||{}))this.allPowerObjsById[e][t].init&&this.allPowerObjsById[e][t].init()}_callInitForObjectAndInners(e){e.id&&this._callInitOfObject(e.id);const t=e?e.children:[];for(const e of t)this._callInitForObjectAndInners(e)}}PowerTree._searchUpDOM=function(e,t,n){let s=e.className.includes("power-")?e:null,i=e.parentElement,r=!1,o=!i;for(;!o;)r=t(i,n),r&&(o=!0),i.className.includes("power-")&&(s=i),i.parentElement&&!o?i=i.parentElement:o=!0;return{powerElement:s,conditionResult:r}},PowerTree._checkIfhavePowerParentElement=function(e){let t=!1;return e.className.includes("power-")&&(t=!0),t};class _pwBasicHover extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1}init(){this.$_pwDefaultValue||(this.$_pwDefaultValue=this.element[this.$_target]),this.$_pwHoverValue||(this.$_pwHoverValue=this.element.getAttribute(this.$_pwAttrName)||""),this.subscribe({event:"mouseover",fn:this.mouseover}),this.subscribe({event:"mouseout",fn:this.mouseout})}mouseover(){this._$pwActive||(this.element[this.$_target]=this.$_pwHoverValue,this.toggle(),this.$shared._priorityActive=!0)}mouseout(){this._$pwActive&&(this.element[this.$_target]=this.$_pwDefaultValue||"",this.toggle(),this.$shared._priorityActive=!1)}}class _pwMainBasicHover extends _pwBasicHover{constructor(e,t,n){super(e,t,n)}mouseover(){this._$pwActive||this.$shared._priorityActive||(this.element[this.$_target]=this.$_pwHoverValue,this.toggle())}mouseout(){this._$pwActive&&(this.element[this.$_target]=this.$_pwDefaultValue||"",this.toggle())}addEventListener(e,t,n){this.$pwMain.subscribe({event:e,fn:t,useCapture:n})}removeEventListener(e,t,n){this.$pwMain.unsubscribe({event:e,fn:t,useCapture:n})}}class PowCssHover extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1,this.$_pwAttrName="data-pow-css-hover"}init(){this.$_pwHoverValues||(this.$_pwHoverValues=this.element.getAttribute(this.$_pwAttrName).split(" ")||[]),this.subscribe({event:"mouseover",fn:this.mouseover}),this.subscribe({event:"mouseout",fn:this.mouseout})}mouseover(){if(!this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle(),this.$shared._priorityActive=!0}}mouseout(){if(this._$pwActive){for(const e of this.$_pwHoverValues)this.element.classList.remove(e);this.toggle(),this.$shared._priorityActive=!1}}}_PowerUiBase.injectPow({name:"data-pow-css-hover",callback:function(e){return new PowCssHover(e)}});class PowMainCssHover extends PowCssHover{constructor(e){super(e),this.$_pwAttrName="data-pow-main-css-hover"}mouseover(){if(!this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle()}}mouseout(){if(this._$pwActive){this.toggle();for(const e of this.$_pwHoverValues)this.element.classList.remove(e)}}addEventListener(e,t,n){this.$pwMain.subscribe({event:e,fn:t,useCapture:n})}removeEventListener(e,t,n){this.$pwMain.unsubscribe({event:e,fn:t,useCapture:n})}}_PowerUiBase.injectPow({name:"data-pow-main-css-hover",isMain:!0,callback:function(e){return new PowMainCssHover(e)}});class PowSrcHover extends _pwBasicHover{constructor(e){super(e),this.$_pwAttrName="data-pow-src-hover",this.$_target="src"}}_PowerUiBase.injectPow({name:"data-pow-src-hover",callback:function(e){return new PowSrcHover(e)}});class PowMainSrcHover extends _pwMainBasicHover{constructor(e){super(e),this.$_pwAttrName="data-pow-main-src-hover",this.$_target="src"}}_PowerUiBase.injectPow({name:"data-pow-main-src-hover",isMain:!0,callback:function(e){return new PowMainSrcHover(e)}});class PowCssHoverRemove extends PowCssHover{constructor(e){super(e),this.$_pwAttrName="data-pow-css-hover-remove"}mouseover(){if(!this._$pwActive){for(const e of this.$_pwHoverValues)this.element.classList.remove(e);this.toggle(),this.$shared._priorityActive=!0}}mouseout(){if(this._$pwActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle(),this.$shared._priorityActive=!1}}}_PowerUiBase.injectPow({name:"data-pow-css-hover-remove",callback:function(e){return new PowCssHoverRemove(e)}});class PowMainCssHoverRemove extends PowMainCssHover{constructor(e){super(e),this.$_pwAttrName="data-pow-main-css-hover-remove"}mouseover(){if(!this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.remove(e);this.toggle()}}mouseout(){if(this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle()}}}_PowerUiBase.injectPow({name:"data-pow-main-css-hover-remove",isMain:!0,callback:function(e){return new PowMainCssHoverRemove(e)}});class PowEval extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1}compile({view:e}){const t=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;this.element.innerHTML=this.$powerUi.interpolation.getDatasetResult(this.element.dataset.powEval,t)}}_PowerUiBase.injectPow({name:"data-pow-eval",callback:function(e){return new PowEval(e)}});class PowEvent extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1}compile({view:e}){!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;for(const t of this.element.attributes)if(t.name.includes("on")){const n=t.name.slice(2,t.name.length);this.element.setAttribute(`data-pow-${n}`,encodeURIComponent(t.value)),t.value=`document.dispatchEvent(new CustomEvent('pwScope', {detail: {viewId: '${e.id}', elementId: '${this.element.id}', attrName: '${n}'}}))`}}}_PowerUiBase.injectPow({name:"data-pow-event",callback:function(e){return new PowEvent(e)}});class PowFor extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1,this._pwEvaluateValue=""}compile({view:e}){if(!this.element.dataset.powFor)return;const t=decodeURIComponent(this.element.dataset.powFor).split(" "),n=`\\b(${t[0]})\\b`,s=t[1];t.shift(),t.shift();let i=t.join(" ");const r=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;i=this.$powerUi.safeEval({text:i,$powerUi:this.$powerUi,scope:r}),"of"===s?this.forOf(n,i):this.forIn(n,i)}forOf(e,t){let n="",s=0;for(const i of t||[]){const t=_Unique.scopeID();let r=this.$powerUi.interpolation.replaceWith({entry:this.element.innerHTML,oldValue:"\\$pwIndex",newValue:s});s+=1,this.$powerUi._tempScope[t]=i,n+=this.$powerUi.interpolation.replaceWith({entry:r,oldValue:e,newValue:encodeURIComponent(`_tempScope['${t}']`)})}this.element.innerHTML=n}forIn(e,t){let n="",s=0;for(const i of Object.keys(t||{})){const r=_Unique.scopeID();let o=this.$powerUi.interpolation.replaceWith({entry:this.element.innerHTML,oldValue:"\\$pwKey",newValue:`'${i}'`});o=this.$powerUi.interpolation.replaceWith({entry:o,oldValue:"\\$pwIndex",newValue:s}),s+=1,this.$powerUi._tempScope[r]=t[i],n+=this.$powerUi.interpolation.replaceWith({entry:o,oldValue:e,newValue:encodeURIComponent(`_tempScope['${r}']`)})}this.element.innerHTML=n}}_PowerUiBase.injectPow({name:"data-pow-for",callback:function(e){return new PowFor(e)}});class PowIf extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1,this.originalHTML=e.innerHTML}compile({view:e}){const t=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;!1===this.$powerUi.safeEval({text:decodeURIComponent(this.element.dataset.powIf),$powerUi:this.$powerUi,scope:t})?(this.element.style.display="none",this.element.innerHTML=""):(this.element.style.display=null,this.element.innerHTML=this.originalHTML)}}function defineInnerDropmenusPosition(e,t){["right-bottom","bottom-right","bottom","right"].includes(e.defaultPosition)?t.defaultPosition="right-bottom":["left-bottom","bottom-left","left"].includes(e.defaultPosition)?t.defaultPosition="left-bottom":["right-top","top-right","top","right"].includes(e.defaultPosition)?t.defaultPosition="right-top":["left-top","top-left"].includes(e.defaultPosition)?t.defaultPosition="left-top":t.defaultPosition="right-bottom"}function defineRootDropmenusPosition(e,t){["right-bottom","bottom-right","left-bottom","bottom-left","right-top","top-right","left-top","top-left"].includes(e.defaultPosition)?t.defaultPosition=e.defaultPosition:"top"===e.defaultPosition?t.defaultPosition="top-right":"bottom"===e.defaultPosition?t.defaultPosition="bottom-right":"right"===e.defaultPosition?t.defaultPosition="bottom-right":"left"===e.defaultPosition?t.defaultPosition="bottom-left":e.element.classList.contains("power-horizontal")?e.defaultPosition="bottom-right":e.defaultPosition="right-bottom"}_PowerUiBase.injectPow({name:"data-pow-if",callback:function(e){return new PowIf(e)}});class KeyboardManager{constructor(e){document.onkeydown=this.checkKey.bind(this),document.onkeyup=this.checkKey.bind(this),this.$powerUi=e,this.keyModeIsOn=!1}getRootElements(){return this.$powerUi.powerTree.rootElements}setKeyModeOn(){if(!1===this.keyModeIsOn){this.keyModeIsOn=!0,this.createBackDrop();for(const e of this.getRootElements()){const t=getComputedStyle(e.element);console.log("styles",t.position),"static"===t.position&&e.element.classList.add("power-keyboard-position"),e.element.classList.add("power-keyboard-mode")}console.log("Keyboard mode ON")}}createBackDrop(){this.backdrop=document.createElement("DIV"),this.backdrop.classList.add("power-keyboard-backdrop"),document.body.appendChild(this.backdrop)}removeBackdrop(){document.body.removeChild(this.backdrop)}setKeyModeOff(){if(this.keyModeIsOn){this.removeBackdrop(),this._17=!1,this._48=!1,this._96=!1,this.keyModeIsOn=!1,console.log("Keyboard mode OFF");for(const e of this.getRootElements())e.element.classList.remove("power-keyboard-mode"),e.element.classList.remove("power-keyboard-position"),console.log("element",e)}}checkKey(e){27===(e=e||window.event).keyCode&&this.setKeyModeOff(),"keydown"===e.type?this[`_${e.keyCode}`]=!0:this[`_${e.keyCode}`]=!1,this._17&&(this._48||this._96)&&this.setKeyModeOn()}}class PowerUi extends _PowerUiBase{constructor(e){super(),this.controllers={$routeSharedScope:{$waitingToDelete:[]}},this.addScopeEventListener(),this.ctrlWaitingToRun=[],this.config=e,this.waitingViews=0,this.waitingInit=[],this.initAlreadyRun=!1,this.interpolation=new PowerInterpolation(e,this),this._events={},this._events.ready=new UEvent,this.request=new Request(e),this.router=new Router(e,this)}addScopeEventListener(){document.removeEventListener("pwScope",this.pwScope.bind(this),!1),document.addEventListener("pwScope",this.pwScope.bind(this),!1)}pwScope(e){const t=this,n=!!(e&&e.detail&&e.detail.viewId&&t.controllers[e.detail.viewId])&&t.controllers[e.detail.viewId].instance,s=!!(e&&e.detail&&e.detail.elementId)&&document.getElementById(e.detail.elementId),i=!!(e&&e.detail&&e.detail.attrName)&&`data-pow-${e.detail.attrName}`,r=!(!s||!i)&&decodeURIComponent(s.getAttribute(i));r&&t.safeEval({text:r,$powerUi:t,scope:n})}safeEval({text:e,scope:t}){return new ParserEval({text:e,scope:t,$powerUi:this}).currentValue}initAll({template:e,routeId:t,viewId:n}){const s=performance.now();this.initAlreadyRun&&this.powerTree.removeAllEvents(),this._createPowerTree(),this.truth={},this.tmp={dropmenu:{}},this.touchdevice=!!(navigator.maxTouchPoints||"ontouchstart"in document.documentElement),this.touchdevice||(this.keyboardManager=new KeyboardManager(this)),this.initAlreadyRun=!0;for(const e of this.waitingInit)document.getElementById(e.node.id).style.visibility=null;this.waitingInit=[],this.controllers[n]&&this.controllers[n].instance&&this.controllers[n].instance.onViewLoad&&this.controllers[n].instance.onViewLoad(this.powerTree.allPowerObjsById[n].$shared.element);const i=performance.now();console.log("PowerUi init run in "+(i-s)+" milliseconds.")}pwReload(){this.initAlreadyRun=!1,this.router._reload()}initNodes({template:e,routeId:t,viewId:n}){const s=performance.now();for(const e of this.waitingInit)this.powerTree.createAndInitObjectsFromCurrentNode({id:e.node.id}),document.getElementById(e.node.id).style.visibility=null;this.controllers[n]&&this.controllers[n].instance&&this.controllers[n].instance.onViewLoad&&this.controllers[n].instance.onViewLoad(this.powerTree.allPowerObjsById[n].$shared.element);const i=performance.now();console.log("PowerUi init run in "+(i-s)+" milliseconds.",this.waitingInit),this.waitingInit=[]}hardRefresh({node:e,view:t}){e=e||document;const n=performance.now();this.powerTree.resetRootCompilers(),this.powerTree.removeAllEvents(),this.powerTree.allPowerObjsById={},this.powerTree.buildAndInterpolate(e,!0),this.powerTree._callInit();const s=performance.now();console.log("hardRefresh run in "+(s-n)+" milliseconds.")}softRefresh(e){const t=performance.now();this.powerTree.resetRootCompilers();for(const e of Object.keys(this.powerTree.rootCompilers||{}))this.powerTree.createAndInitObjectsFromCurrentNode({id:e,refresh:!0});const n=performance.now();console.log("softRefresh run in "+(n-t)+" milliseconds.")}prepareViewToLoad({viewId:e,routeId:t}){const n=document.getElementById(e);return n.style.visibility="hidden",this.waitingViews=this.waitingViews+1,this.waitingInit.push({node:n,viewId:e}),n}runRouteController(){for(const e of this.ctrlWaitingToRun)this.controllers[e.viewId]&&this.controllers[e.viewId].instance&&(this.controllers[e.viewId].instance._viewId=e.viewId,this.controllers[e.viewId].instance._routeId=e.routeId,this.controllers[e.viewId].instance.ctrl(this.controllers[e.viewId].params));this.ctrlWaitingToRun=[]}loadTemplateUrl({template:e,viewId:t,currentRoutes:n,routeId:s,routes:i}){const r=this,o=this.prepareViewToLoad({viewId:t,routeId:s});this.request({url:e,method:"GET",status:"Loading page",withCredentials:!1}).then((function(e,n){o.innerHTML=n.responseText,r.ifNotWaitingServerCallInit({template:e,routeId:s,viewId:t});const a=i[s];!0!==a.avoidCacheTemplate?(a.template=n.responseText,a.templateIsCached=!0):a.templateIsCached=!1})).catch((function(e,n){r.ifNotWaitingServerCallInit({template:e,routeId:s,viewId:t})}))}loadTemplate({template:e,viewId:t,currentRoutes:n,routeId:s,routes:i}){this.prepareViewToLoad({viewId:t,routeId:s}).innerHTML=e,this.ifNotWaitingServerCallInit({template:e,routeId:s,viewId:t})}ifNotWaitingServerCallInit({template:e,routeId:t,viewId:n}){const s=this;s.ctrlWaitingToRun.push({viewId:n,routeId:t}),setTimeout((function(){s.waitingViews=s.waitingViews-1,0===s.waitingViews&&(s.runRouteController(),s.initAlreadyRun?s.initNodes({template:e,routeId:t,viewId:n}):s.initAll({template:e,routeId:t,viewId:n}),s._events.ready.broadcast("ready"))}),10)}sanitizeHTML(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}_powerView(e){return new PowerView(e,this)}_powerMenu(e){return new PowerMenu(e,this)}_powerMain(e){return new PowerMain(e,this)}_powerBrand(e){return new PowerBrand(e,this)}_powerItem(e){return new PowerItem(e,this)}_powerAccordion(e){return new PowerAccordion(e,this)}_powerAccordionSection(e){return new PowerAccordionSection(e,this)}_powerAction(e){return new PowerAction(e,this)}_powerToggle(e){return new PowerToggle(e,this)}_powerDropmenu(e){return new PowerDropmenu(e,this)}_powerStatus(e){return new PowerStatus(e,this)}_powerBasicElement(e){return new _PowerBasicElement(e,this)}_offsetComputedStyles(e){return parseInt(e.left.split("px")[0]||0)+parseInt(e["margin-left"].split("px")[0]||0)+parseInt(e["border-left-width"].split("px")[0]||0)}_offsetComputedRootElementStyles(e){return parseInt(e["margin-left"].split("px")[0]||0)}}class PowerController{constructor({$powerUi:e}){this.$powerUi=e}get router(){return this.$powerUi.router}openRoute({routeId:e,params:t={},target:n}){this.router.openRoute({routeId:e||this._routeId,currentRouteId:this._routeId,currentViewId:this._viewId,params:t,target:n})}closeCurrentRoute(){const e=this.router.getOpenedRoute({routeId:this._routeId,viewId:this._viewId}),t=decodeURI(window.location.hash).split("?");let n=0,s="";for(let i of t)i.includes(e.route)||(i=0!==n?"?"+i:i.replace(this.router.config.rootRoute,""),s+=i,n+=1);this.router.changeHash(s)}safeEval(e){return this.$powerUi.safeEval({text:e,scope:this})}}class Request{constructor(e){const t=this;return function(n){n.withCredentials=void 0===n.withCredentials||n.withCredentials,n.headers=n.headers||e.headers||{},e.authCookie&&(n.headers.Authorization=getCookie(e.authCookie)||null),console.log("headers",n.headers);const s={then:function(e){return this.onsucess=e,this},catch:function(e){return this.onerror=e,this}};return t.ajaxRequest({method:n.method,url:n.url,data:n,onsucess:function(e){if(s.onsucess)try{return s.onsucess(JSON.parse(e.response),e)}catch{return s.onsucess(e.response,e)}return s},onerror:function(e){if(s.onerror)try{return s.onerror(JSON.parse(e.response),e)}catch{return s.onerror(e.response,e)}}}),s}}encodedParams(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length>0&&(t+="&"),t+=encodeURI(n+"="+e[n]));return t}ajaxRequest({method:e,url:t,onsucess:n,onerror:s,async:i,data:r}){null==i&&(i=!0);const o=new XMLHttpRequest;return o.open(e,t,i),o.onload=function(){200===o.status&&n?n(o):200!==o.status&&s?s(o):window.console("Request failed.  Returned status of "+o.status)},e&&"POST"===e.toUpperCase()?o.setRequestHeader("Content-Type","application/json"):o.setRequestHeader("Content-Type","text/html"),r.headers&&r.headers["Content-Type"]&&o.setRequestHeader("Content-Type",r.headers["Content-Type"]),r&&r.body?o.send(JSON.stringify(r.body)):o.send(),o}}function getEmptyRouteObjetc(){return{params:[],id:"",viewId:"",route:"",secundaryRoutes:[]}}class Router{constructor(e={},t){if(this.config=e,this.$powerUi=t,this.routes={},this.oldRoutes=getEmptyRouteObjetc(),this.currentRoutes=getEmptyRouteObjetc(),this.config.rootRoute||(this.config.rootRoute="#!/"),e.routes)for(const t of e.routes)this.add(t);this.init(),window.onhashchange=this.hashChange.bind(this)}add({id:e,route:t,template:n,templateUrl:s,avoidCacheTemplate:i,callback:r,viewId:o,ctrl:a}){if(n=s||n,!this.config.routerMainViewId&&!1!==this.config.routerMainViewId&&(this.config.routerMainViewId="main-view",!document.getElementById(this.config.routerMainViewId)))throw new Error('The router needs a element with an ID to render views, you can define some HTML element with the id "main-view" or set your on id in the config using the key "routerMainViewId" with the choosen id. If you not want render any view in a main view, set the config key "routerMainViewId" to false and a "viewId" flag to each route with a view.');if(!this.config.routerSecundaryViewId&&!1!==this.config.routerSecundaryViewId&&(this.config.routerSecundaryViewId="secundary-view",!document.getElementById(this.config.routerSecundaryViewId)))throw new Error('The router needs a element with an ID to render views, you can define some HTML element with the id "secundary-view" or set your on id in the config using the key "routerSecundaryViewId" with the choosen id. If you not want render any view in a secundary view, set the config key "routerSecundaryViewId" to false and a "viewId" flag to each route with a view.');if(!e)throw new Error("A route ID must be given");if(!t&&!n&&!r)throw new Error("route, template, templateUrl or callback must be given");if(!1===this.config.routerMainViewId&&n&&!o)throw new Error(`You set the config flag "routerMainViewId" to false, but do not provide a custom "viewId" to the route "${t}" and id "${e}". Please define some element with some id to render the template, templateUrl, and pass it as "viewId" paramenter to the router.`);if(!1===this.config.routerSecundaryViewId&&n&&!o)throw new Error(`You set the config flag "routerSecundaryViewId" to false, but do not provide a custom "viewId" to the route "${t}" and id "${e}". Please define some element with some id to render the template, templateUrl, and pass it as "viewId" paramenter to the router.`);if("string"!=typeof t)throw new TypeError("typeof route must be a string");if(r&&"function"!=typeof r)throw new TypeError("typeof callback must be a function");"/"===t&&(t="");const l={route:this.config.rootRoute+t,callback:r||null,template:n||null,templateUrl:s||null,avoidCacheTemplate:!0===i,templateIsCached:!s,viewId:o||null,ctrl:a||null};if("otherwise"!==e||n)for(const n of Object.keys(this.routes||{}))if(this.routes[n].route===l.route&&("otherwise"!==n||this.routes[n].template))throw"otherwise"===n||"otherwise"===e?new Error(`the route "${t||"/"}" already exists, so "${e}" can't use it if you use a template. You can remove the template or use another route.`):new Error(`the route "${t||"/"}" already exists, so "${e}" can't use it.`);if(this.routes[e])throw new Error(`the id ${t.id} already exists`);this.routes[e]=l}hashChange(e){this.oldRoutes=this.cloneRoutes({source:this.currentRoutes}),this.currentRoutes=getEmptyRouteObjetc(),this.init({onHashChange:e})}cloneRoutes({source:e}){const t={params:[],id:e.id,viewId:e.viewId,route:e.route,secundaryRoutes:[]};for(const n of e.params)t.params.push({key:n.key,value:n.value});for(const n of e.secundaryRoutes){const e={id:n.id,viewId:n.viewId,route:n.route,params:[]};for(const t of n.params)e.params.push({key:t.key,value:t.value});t.secundaryRoutes.push(e)}return t}_reload(){const e=this.currentRoutes.viewId;this.savedOldRoutes=this.cloneRoutes({source:this.oldRoutes}),this.oldRoutes=this.cloneRoutes({source:this.currentRoutes}),this.currentRoutes=getEmptyRouteObjetc(),this.removeMainView({viewId:e}),this.closeOldSecundaryViews(),this.hashChange(),this.oldRoutes=this.cloneRoutes({source:this.savedOldRoutes}),delete this.savedOldRoutes}init({secundaryRoute:e,onHashChange:t}={}){const n=this.extractRouteParts(e||decodeURI(window.location.hash)||this.config.rootRoute);for(const t of Object.keys(this.routes||{}))if("otherwise"!==t||this.routes[t].template){const s=this.getRouteParamKeys(this.routes[t].route);let i=this.buildRegExPatternToRoute(t,s);if(n.path.match(i)){if(!e){this.oldRoutes.id&&this.oldRoutes.route===n.path.replace(this.config.rootRoute,"")||(this.removeMainView({viewId:this.routes[t].viewId||this.config.routerMainViewId}),this.loadRoute({routeId:t,paramKeys:s,viewId:this.config.routerMainViewId,ctrl:this.routes[t].ctrl})),this.setMainRouteState({routeId:t,paramKeys:s,route:n.path,viewId:this.config.routerMainViewId});for(const e of n.secundaryRoutes)this.init({secundaryRoute:e});return this.closeOldSecundaryViews(),!0}{const n=e.replace(this.config.rootRoute,""),i=this.oldRoutes.secundaryRoutes.find(e=>e&&e.route===n),r=this.currentRoutes.secundaryRoutes.find(e=>e&&e.route===n);if(i||r)r||this.currentRoutes.secundaryRoutes.push(i);else{const n=this.loadSecundaryRoute({routeId:t,paramKeys:s,routerSecundaryViewId:this.config.routerSecundaryViewId,ctrl:this.routes[t].ctrl});this.setSecundaryRouteState({routeId:t,paramKeys:s,secundaryRoute:e,secundaryViewId:n})}}}}if(!e){const e=this.routes.otherwise?this.routes.otherwise.route:this.config.rootRoute;window.location.replace(encodeURI(e))}}closeOldSecundaryViews(){for(const e of this.oldRoutes.secundaryRoutes)this.currentRoutes.secundaryRoutes.find(t=>t.route===e.route)||this.removeSecundaryView({secundaryViewId:e.viewId,routeId:e.id});this.clearRouteSharedScopes()}clearRouteSharedScopes(){for(const e of this.$powerUi.controllers.$routeSharedScope.$waitingToDelete)this.$powerUi.controllers.$routeSharedScope[e]&&0===this.$powerUi.controllers.$routeSharedScope[e]._instances&&delete this.$powerUi.controllers.$routeSharedScope[e];this.$powerUi.controllers.$routeSharedScope.$waitingToDelete=[]}removeSecundaryView({secundaryViewId:e,routeId:t}){this.$powerUi.powerTree.allPowerObjsById[e]&&this.$powerUi.powerTree.allPowerObjsById[e].$shared&&this.$powerUi.powerTree.allPowerObjsById[e].$shared.removeElementAndInnersFromPower();const n=document.getElementById(e);n.parentNode.removeChild(n),this.$powerUi.controllers[e]&&(delete this.$powerUi.controllers[e],this.$powerUi.controllers.$routeSharedScope[t]&&void 0!==this.$powerUi.controllers.$routeSharedScope[t]._instances&&(this.$powerUi.controllers.$routeSharedScope[t]._instances=this.$powerUi.controllers.$routeSharedScope[t]._instances-1,0===this.$powerUi.controllers.$routeSharedScope[t]._instances&&this.$powerUi.controllers.$routeSharedScope.$waitingToDelete.push(t)))}removeMainView({viewId:e}){this.$powerUi.powerTree&&this.$powerUi.powerTree.allPowerObjsById[e].$shared.removeInnerElementsFromPower()}loadRoute({routeId:e,paramKeys:t,viewId:n,ctrl:s}){if(s){this.$powerUi.controllers[n]=s;const e=s.params||{};e.$powerUi=this.$powerUi,this.$powerUi.controllers[n].instance=new s.component(e)}if(this.routes[e].template&&!this.config.noRouterViews){if(this.routes[e].viewId&&!document.getElementById(this.routes[e].viewId))throw new Error(`You defined a custom viewId "${this.routes[e].viewId}" to the route "${this.routes[e].route}" but there is no element on DOM with that id.`);this.routes[e].templateUrl&&!0!==this.routes[e].templateIsCached?this.$powerUi.loadTemplateUrl({template:this.routes[e].template,viewId:this.routes[e].viewId||n,currentRoutes:this.currentRoutes,routeId:e,routes:this.routes}):this.$powerUi.loadTemplate({template:this.routes[e].template,viewId:this.routes[e].viewId||n,currentRoutes:this.currentRoutes,routeId:e,routes:this.routes})}if(this.routes[e].callback)return this.routes[e].callback.call(this,this.routes[e])}loadSecundaryRoute({routeId:e,paramKeys:t,routerSecundaryViewId:n,ctrl:s}){s&&(this.$powerUi.controllers.$routeSharedScope[e]||(this.$powerUi.controllers.$routeSharedScope[e]={},this.$powerUi.controllers.$routeSharedScope[e]._instances=0),this.$powerUi.controllers.$routeSharedScope[e]._instances=this.$powerUi.controllers.$routeSharedScope[e]._instances+1,s.params.$shared=this.$powerUi.controllers.$routeSharedScope[e]);const i=document.createElement("div"),r=getIdAndCreateIfDontHave(i);return i.id=r,i.classList.add("power-view"),document.getElementById(n).appendChild(i),this.loadRoute({routeId:e,paramKeys:t,viewId:r,ctrl:this.routes[e].ctrl}),r}openRoute({routeId:e,params:t,target:n,currentRouteId:s,currentViewId:i}){const r=this.getRouteParamKeysWithoutDots(this.routes[e].route);if(r)for(const n of r)if(!t||!t[n])throw`The parameter "${n}" of route "${e}" is missing!`;if(!this.routeExists({routeId:e,params:t}))if("_self"===n){const n=this.getOpenedRoute({routeId:s,viewId:i}),o=this.getOpenedSecundaryRoutesHash([n.route])+`?sr=${this.buildHash({routeId:e,params:t,paramKeys:r})}`;this.changeHash(o)}else if("_blank"===n){const n=this.getOpenedSecundaryRoutesHash()+`?sr=${this.buildHash({routeId:e,params:t,paramKeys:r})}`;this.changeHash(n)}else this.changeHash(this.buildHash({routeId:e,params:t,paramKeys:r}))}getOpenedSecundaryRoutesHash(e=[]){const t=this.extractRouteParts(decodeURI(window.location.hash));let n=t.path.replace(this.config.rootRoute,"");for(let s of t.secundaryRoutes)s=s.replace(this.config.rootRoute,""),0!==e.lenght&&e.includes(s)||(n+=`?sr=${s}`),console.log("route",s);return n}changeHash(e){window.history.pushState(null,null,window.location.href),window.location.replace(encodeURI(this.config.rootRoute)+encodeURI(e))}buildHash({routeId:e,params:t,paramKeys:n}){let s=this.routes[e].route.slice(3,this.routes[e].length);if(t&&n.length)for(const e of n)s=s.replace(`:${e}`,t[e]);return s}routeExists({routeId:e,params:t}){let n=!1;if(e===this.currentRoutes.id){if(!t)return!0;let e=!1;for(const s of Object.keys(t||{})){for(const n of this.currentRoutes.params)s===n.key&&t[s]===n.value&&(e=!0);n=e,e=!1}if(n)return!0}for(const s of this.currentRoutes.secundaryRoutes)if(e===s.id){let e=!1;for(const i of Object.keys(t||{})){for(const n of s.params)i===n.key&&t[i]===n.value&&(e=!0);n=e,e=!1}}return n}setMainRouteState({routeId:e,paramKeys:t,route:n,viewId:s}){this.currentRoutes.id=e,this.currentRoutes.route=n.replace(this.config.rootRoute,""),this.currentRoutes.viewId=this.routes[e].viewId||s,this.currentRoutes.isMainView=!0,this.currentRoutes.params=t?this.getRouteParamValues({routeId:e,paramKeys:t}):[]}setSecundaryRouteState({routeId:e,paramKeys:t,secundaryRoute:n,secundaryViewId:s}){const i={isMainView:!1,params:[],id:"",route:n.replace(this.config.rootRoute,""),viewId:this.routes[e].viewId||s};i.id=e,t&&(i.params=this.getRouteParamValues({routeId:e,paramKeys:t,secundaryRoute:n})),this.currentRoutes.secundaryRoutes.push(i)}extractRouteParts(e){const t={path:e,secundaryRoutes:[]};if(e.includes("?")){const n=e.split("?");t.path=n[0];for(const e of n)if(e.includes("sr="))for(const n of e.split("sr="))n&&t.secundaryRoutes.push(this.config.rootRoute+n)}return t}buildRegExPatternToRoute(e,t){let n=new RegExp(`^${this.routes[e].route}$`);if(t){let e=n.toString();e=e.substring(1),e=e.slice(0,-1);for(const n of t)e=e.replace(n,"[^]*");n=new RegExp(e)}return n}getRoute({routeId:e}){return this.routes[e]}getOpenedRoute({routeId:e,viewId:t}){if(this.currentRoutes.id===e&&this.currentRoutes.viewId)return this.currentRoutes;for(const n of this.currentRoutes.secundaryRoutes)if(n.id===e&&n.viewId===t)return n}getRouteParamKeys(e){const t=new RegExp(/:[^\s/]+/g);return e.match(t)}getRouteParamKeysWithoutDots(e){const t=[];for(const n of this.getRouteParamKeys(e)||[])t.push(n.substring(1));return t}getRouteParamValues({routeId:e,paramKeys:t,secundaryRoute:n}){const s=this.routes[e].route.split("/"),i=(n||decodeURI(window.location.hash)||this.config.rootRoute).split("/"),r=[];for(const e of t)r.push({key:e.substring(1),value:i[s.indexOf(e)].replace(/(\?sr=[^]*)/,"")});return r}getParamValue(e){const t=this.currentRoutes.params.find(t=>t.key===e);return t?t.value:null}}class PowerInterpolation{constructor(e={},t){this.config=e,this.$powerUi=t,this.startSymbol=e.interpolateStartSymbol||"{{",this.endSymbol=e.interpolateEndSymbol||"}}"}compile({template:e,scope:t,view:n}){return!t&&n&&(t=!!(n&&n.id&&this.$powerUi.controllers[n.id])&&this.$powerUi.controllers[n.id].instance),this.replaceInterpolation(e,t)}getDatasetResult(e,t){return this.compile({template:`${this.startSymbol} ${decodeURIComponent(e)} ${this.endSymbol}`,scope:t})}standardRegex(){const e=`${this.startSymbol}[^]*?${this.endSymbol}`;return new RegExp(e,"gm")}replaceInterpolation(e,t){const n=(e=this.stripWhiteChars(e)).replace(/<!--[\s\S]*?-->/gm,"").match(this.standardRegex());if(n)for(const s of n){const n=this.getInterpolationValue(s,t);e=e.replace(s,n)}return e.trim()}stripWhiteChars(e){let t=e.replace(/ +(?= )/g,"");return t=t.replace(/[\t\n\r]/g,""),t}stripInterpolation(e){let t=e.replace(this.startSymbol,"");return t=t.replace(this.endSymbol,""),t}replaceWith({entry:e,oldValue:t,newValue:n}){const s=new RegExp(t,"gm"),i=e.match(this.standardRegex());if(i)for(const t of i){let i=t.replace(s,n);e=e.replace(t,i)}return e=this.replaceIdsAndRemoveInterpolationSymbol({entry:e,regexOldValue:s,newValue:n})}replaceIdsAndRemoveInterpolationSymbol({entry:e,regexOldValue:t,newValue:n}){const s=document.createElement("div");s.innerHTML=e;for(const e of s.children){for(const s of e.attributes)(s.name.includes("data-pow")||s.name.includes("data-pwc"))&&(s.value=s.value.replace(t,n));e.id&&(e.id=this.replaceInterpolation(e.id,this.$powerUi)),e.children.length&&(e.innerHTML=this.replaceIdsAndRemoveInterpolationSymbol({entry:e.innerHTML,regexOldValue:t,newValue:n}))}return s.innerHTML}getInterpolationValue(e,t){let n=this.stripWhiteChars(e);return n=this.stripInterpolation(n),this.safeEvaluate(n,t)}safeEvaluate(e,t){let n;try{n=this.$powerUi.safeEval({text:decodeURIComponent(e),scope:t,$powerUi:this.$powerUi})}catch(e){n=""}return void 0===n?"":n}safeString(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}class PowerView extends _PowerBasicElementWithEvents{constructor(e){super(e),this.isView=!0}}PowerUi.injectPowerCss({name:"power-view",isMain:!0});class SyntaxTree{constructor({counter:e}){this.currentPriority=0,this.nodes=[],this.tokensListener=new TokensListener({counter:e,syntaxTree:this}),this.validAfter={variable:this.variableValidation,string:this.stringValidation,parentheses:this.parenthesesValidation,dot:this.dotValidation,integer:this.numberValidation,float:this.numberValidation,operator:this.operationValidation,equal:this.equalityValidation,"NOT-equal":this.equalityValidation,"greater-than":this.equalityValidation,"minor-than":this.equalityValidation,"minor-or-equal":this.equalityValidation,"greater-or-equal":this.equalityValidation,object:this.objectValidation,function:this.objectValidation,anonymousFunc:this.objectValidation,dictNode:this.objectValidation,comma:this.commaValidation,AND:this.orAndNotValidation,OR:this.orAndNotValidation,NOT:this.orAndNotValidation,"NOT-NOT":this.orAndNotValidation,"short-hand":this.shortHandValidation,dictDefinition:()=>!0,arrayDefinition:()=>!0}}buildTreeLeaf(e){this.tree=this.checkAndPrioritizeSyntax({nodes:this.nodes,isParameter:e})}shortHandValidation({currentNode:e,isParameter:t}){return!(e.condition[0]&&e.condition[0].expression_nodes&&!e.condition[0].expression_nodes.length)&&(!(e.if[0]&&e.if[0].expression_nodes&&!e.if[0].expression_nodes.length)&&!(e.else[0]&&e.else[0].expression_nodes&&!e.else[0].expression_nodes.length))}firstNodeValidation({node:e,isParameter:t}){return!["dot","anonymousFunc","AND","OR","NOT-equal","minor-or-equal","greater-or-equal","equal","minor-than","greater-than"].includes(e.syntax)&&("operator"!==e.syntax||"+"===e.label||"-"===e.label)}orAndNotValidation({nextNode:e,isParameter:t}){return!!["string","variable","integer","object","float","dictNode","parentheses","NOT","NOT-NOT","function"].includes(e.syntax)||"operator"===e.syntax&&("+"===e.label||"-"===e.label)}commaValidation({nextNode:e,isParameter:t}){return!!["string","variable","integer","object","float","dictNode","parentheses","arrayDefinition","dictDefinition","NOT","NOT-NOT","comma","function","end"].includes(e.syntax)||"operator"===e.syntax&&("+"===e.label||"-"===e.label)}objectValidation({nextNode:e,isParameter:t}){return!!(["operator","anonymousFunc","short-hand","NOT-equal","equal","minor-than","greater-than","minor-or-equal","greater-or-equal","dot","AND","OR","dictNode","end"].includes(e.syntax)||"comma"===e.syntax&&t)}equalityValidation({nextNode:e,currentNode:t,isParameter:n}){return!!["variable","parentheses","function","arrayDefinition","dictDefinition","float","integer","dictNode","object","NOT","NOT-NOT","string"].includes(e.syntax)||("string"===e.syntax&&"+"===t.label||"operator"===e.syntax&&("+"===e.label||"-"===e.label))}operationValidation({nextNode:e,currentNode:t,isParameter:n}){return!!["NOT","NOT-NOT","float","object","integer","variable","dictNode","arrayDefinition","dictDefinition","parentheses","function"].includes(e.syntax)||("string"===e.syntax&&"+"===t.label||"operator"===e.syntax&&("+"===e.label||"-"===e.label))}variableValidation({nextNode:e,isParameter:t}){return!!(["dot","operator","NOT-equal","equal","minor-than","greater-than","minor-or-equal","greater-or-equal","AND","OR","short-hand","end"].includes(e.syntax)||"comma"===e.syntax&&t)}numberValidation({nextNode:e,isParameter:t}){return!!(["operator","NOT-equal","equal","minor-than","greater-than","AND","minor-or-equal","greater-or-equal","OR","short-hand","end"].includes(e.syntax)||"comma"===e.syntax&&t)}stringValidation({nextNode:e,isParameter:t}){return!["NOT","NOT-NOT","string","variable","dictNode","function","parentheses","arrayDefinition","dictDefinition","integer","float","especial","anonymousFunc","dot","dictNode"].includes(e.syntax)&&(e.syntax,!0)}parenthesesValidation({nextNode:e,isParameter:t}){return!!(["anonymousFunc","dot","operator","short-hand","NOT-equal","equal","minor-or-equal","greater-or-equal","minor-than","greater-than","AND","OR","short-hand","end"].includes(e.syntax)||"comma"===e.syntax&&t)}dotValidation({nextNode:e,isParameter:t}){return!!["function","variable","dictNode"].includes(e.syntax)}isNextValidAfterCurrent({currentNode:e,nextNode:t,isParameter:n}){return!!this.validAfter[e.syntax]&&this.validAfter[e.syntax]({currentNode:e,nextNode:t,isParameter:n})}checkAndPrioritizeSyntax({nodes:e,isParameter:t}){let n=[],s=[],i=[],r=!1;if((e=this.filterNodesAndUnifyObjects(e)).push({syntax:"end"}),!e.length)return[];let o=0;const a=e.length-1;let l=!0;if(l=this.firstNodeValidation({node:this.getCurrentNode({index:0,nodes:e})}),!1===l)throw`PowerUI template invalid syntax: "${e[0].label}" starting the expression.`;for(;o<=a&&l;){const a=this.getCurrentNode({index:o,nodes:e});if(l=this.isNextValidAfterCurrent({currentNode:a,nextNode:this.getNextNode({index:o,nodes:e}),isParameter:t}),!1===l&&"end"!==a.syntax)throw`PowerUI template invalid syntax: "${a.label}".`;const h=this.createExpressionGroups({index:o,currentNode:a,previousNode:this.getPreviousNode({index:o,nodes:e}),nextNode:this.getNextNode({index:o,nodes:e}),current_expression_nodes:n,priority_nodes:s,expression_groups:i,doubleOperator:r});s=h.priority_nodes,n=h.current_expression_nodes,i=h.expression_groups,r=h.doubleOperator,o+=1}return i=this.prioritizeExpressionGroups({priority:"equality",expression_groups:i}),i=this.prioritizeExpressionGroups({priority:"AND",expression_groups:i}),i.pop(),i}createExpressionGroups({index:e,currentNode:t,previousNode:n,nextNode:s,current_expression_nodes:i,priority_nodes:r,expression_groups:o,doubleOperator:a}){if("operator"===t.syntax&&0===e?(r.push(t),a=!0):"operator"===t.syntax&&"operator"===n.syntax?(r.push(t),a=!0):["integer","float","string","variable","parentheses","object","short-hand","dictDefinition","arrayDefinition"].includes(t.syntax)?"operator"===s.syntax&&"+"!==s.label&&"-"!==s.label||"operator"===n.syntax&&"+"!==n.label&&"-"!==n.label?r.push(t):a?(r.push(t),a=!1):i.push(t):"operator"===t.syntax&&("+"!==t.label&&"-"!==t.label?r.push(t):(r.length&&(i.push({priority:r}),r=[]),i.push(t))),["NOT-equal","equal","greater-than","minor-than","minor-or-equal","greater-or-equal","OR","AND","end"].includes(t.syntax)){const e=["OR","AND"].includes(t.syntax)?t.syntax:"equality";r.length&&(i.push({priority:r}),r=[]);const n={kind:"expression",expression_nodes:i};o.push(n),i=[],t.kind="end"===t.syntax?"end":e,o.push(t)}return{priority_nodes:r,current_expression_nodes:i,expression_groups:o,doubleOperator:a}}prioritizeExpressionGroups({priority:e,expression_groups:t}){let n=[],s=[],i=!1;for(const r of t)"end"===r.syntax&&s.length?(n.length?n.push({priority:s}):n=s,n.push(r),s=[]):r.kind===e?(i=!0,s.push(r)):!r.priority&&"expression"!==r.kind&&i&&s.length?(n.push({priority:s}),n.push(r),s=[],i=!1):"OR"===r.syntax||"AND"===r.syntax?(n.push({priority:s}),n.push(r),s=[]):s.push(r);return n}getCurrentNode({index:e,nodes:t}){return t[e]}getPreviousNode({index:e,nodes:t}){return t[e-1]||{syntax:"end"}}getNextNode({index:e,nodes:t}){return t[e+1]||{syntax:"end"}}filterNodesAndUnifyObjects(e){const t=[];let n=this.newObject(),s=e.length-1,i=!1;for(;e[s];){if("empty"!==e[s].syntax)if(["function","dictNode","anonymousFunc"].includes(e[s].syntax)){n.parameters.unshift(e[s]);let t=e[s].label;"function"===e[s].syntax&&(t+="()"),n.label=t+n.label,i=!0}else i&&(t.unshift(n),i=!1,n=this.newObject()),t.unshift(e[s]);else i&&(t.unshift(n),i=!1,n=this.newObject());s-=1}return i&&(t.unshift(n),i=!1,n=this.newObject()),t}newObject(){return{syntax:"object",label:"",parameters:[]}}}class PowerLexer{constructor({text:e,tokensTable:t,counter:n,isParameter:s}){this.isParameter=s,this.originalText=String(e),this.syntaxTree=new SyntaxTree({counter:n}),this.tokens=[]}scan(){for(const e of this.originalText){const t=this.convertToToken(e);this.tokens.push(t)}this.tokens.push({name:"end",value:null})}convertToToken(e){for(const t of this.tokensTable)if(t.values.includes(e))return{name:t.name,value:e};return{name:"undefined",value:e}}}class PowerTemplateParser extends PowerLexer{constructor({text:e,tokensTable:t,counter:n,isParameter:s}){super({text:e,tokensTable:t,counter:n||0,isParameter:s}),this.counter=n||0,this.tokensTable=t||[{name:"blank",values:[" ","\t","\n"]},{name:"escape",values:["\\"]},{name:"especial",values:["_","$"]},{name:"quote",values:['"',"`","'"]},{name:"braces",values:["{","}"]},{name:"separator",values:["(",")","[","]"]},{name:"operator",values:["+","-","*","/","%"]},{name:"equal",values:["="]},{name:"minor-than",values:["<"]},{name:"greater-than",values:[">"]},{name:"NOT",values:["!"]},{name:"AND",values:["&"]},{name:"OR",values:["|"]},{name:"comma",values:","},{name:"dot",values:["."]},{name:"short-hand",values:["?",":"]},{name:"number",values:["0","1","2","3","4","5","6","7","8","9"]},{name:"letter",values:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{name:"end",values:[null]}],this.buildSyntaxTree()}buildSyntaxTree(){this.scan(),this.syntaxTree.buildTreeLeaf(this.isParameter||!1)}scan(){let e=this.counter;for(const t of this.originalText){const n=this.convertToToken(t);this.tokens.push(n),this.syntaxTree.tokensListener.read({token:n,counter:e}),e+=1}const t=this.convertToToken(null);this.tokens.push(t),this.syntaxTree.tokensListener.read({token:t,counter:e})}}class TokensListener{constructor({counter:e,syntaxTree:t}){this.syntaxTree=t,this.currentTokens=[],this.currentLabel="",this.start=e,this.patterns=[{name:"empty",obj:EmptyPattern},{name:"string",obj:StringPattern},{name:"arrayDefinition",obj:ArrayDefinitionPattern},{name:"variable",obj:VariablePattern},{name:"number",obj:NumberPattern},{name:"operator",obj:OperationPattern},{name:"equal",obj:EqualPattern},{name:"minor-than",obj:MinorThanPattern},{name:"greater-than",obj:GreaterThanPattern},{name:"NOT",obj:NotPattern},{name:"AND",obj:AndPattern},{name:"OR",obj:OrPattern},{name:"comma",obj:CommaPattern},{name:"dot",obj:DictPattern},{name:"braces",obj:BracesPattern},{name:"separator",obj:DictPattern},{name:"short-hand",obj:ShortHandPattern},{name:"parentheses",obj:parenthesesPattern}],this.candidates=[],this.checking="firstToken",this.resetCandidates()}read({token:e,counter:t}){for(const n of this.candidates)if(n.instance[this.checking]({token:e,counter:t})){this.currentTokens.push(e),this.currentLabel=this.currentLabel+(e.value||(null===e.value?"":e.value));break}}nextPattern({token:e,counter:t,syntax:n,parameters:s}){this.syntaxTree.nodes.push({syntax:n,label:this.currentLabel,tokens:this.currentTokens,start:this.start,end:t,parameters:s||[]}),this.start=t,this.currentTokens=[],this.currentLabel="",this.checking="firstToken",this.resetCandidates(),this.read({token:e,counter:t})}resetCandidates(){this.candidates=[];for(const e of this.patterns)this.candidates.push({name:e.name,instance:new e.obj(this)})}}class ParserEval{constructor({text:e,nodes:t,scope:n,$powerUi:s}){this.$powerUi=s,this.$scope=n||{},this.nodes=t||new PowerTemplateParser({text:e}).syntaxTree.tree,this.currentValue="",this.operator="",this.doubleOperator="",this.lastNode="",this.currentNode="",this.nextNode="",this.equality="$_not_Setted_$",this.leftExpressionValueToCompare="$_not_Setted_$",this.rightExpressionValueToCompare="$_not_Setted_$",this.evalNodes()}evalNodes(){let e=0;for(let t of this.nodes){if(t.expression_nodes)for(const n of t.expression_nodes)this.currentNode=n,this.nextNode=t.expression_nodes[e+1],"short-hand"===n.syntax?this.evalShortHandExpression(n):"dictDefinition"===n.syntax?this.evalDictDefinition(n):"variable"===n.syntax&&["true","false","null","undefined"].includes(n.label)?this.evalSpecialValues(n.label):this.eval(n),this.lastNode=n;else"equality"===t.kind||["===","!==","==","!=",">=","<=",">","<"].includes(t.label)?(this.leftExpressionValueToCompare=this.currentValue,this.currentValue="",this.equality=t):["OR","AND"].includes(t.syntax)?(this.leftExpressionValueToCompare=this.currentValue,this.currentValue="",this.orAndExpression=t):this.nodes[e+1]&&"OR"===this.nodes[e+1].syntax&&t.priority&&t.priority[0]&&t.priority[0].priority?t.priority.length>1?this.currentValue=this.recursiveEval(t.priority):this.currentValue=this.recursiveEval(t.priority[0].priority):this.nodes[e-1]&&"OR"===this.nodes[e-1].syntax&&t.priority&&t.priority[0]&&t.priority[0].priority?t.priority.length>1?this.currentValue=this.recursiveEval(t.priority):this.currentValue=this.recursiveEval(t.priority[0].priority):this.nodes[e+1]&&"AND"===this.nodes[e+1].syntax&&t.priority?this.currentValue=this.recursiveEval(t.priority):this.nodes[e-1]&&"AND"===this.nodes[e-1].syntax&&t.priority?this.currentValue=this.recursiveEval(t.priority):console.log("NO EXPRESSION_NODES!!",this.currentValue,t,this.nodes);this.equality&&""!==this.currentValue&&"$_not_Setted_$"!==this.leftExpressionValueToCompare?this.evalEquality():this.orAndExpression&&"OR"===this.orAndExpression.syntax&&""!==this.currentValue&&"$_not_Setted_$"!==this.leftExpressionValueToCompare?this.evalOrExpression():this.orAndExpression&&"AND"===this.orAndExpression.syntax&&""!==this.currentValue&&"$_not_Setted_$"!==this.leftExpressionValueToCompare&&this.evalAndExpression(),e+=1}}evalDictDefinition(e){this.currentValue={};for(const t of e.parameters)this.currentValue[this.recursiveEval(t.key)]=this.recursiveEval(t.value)}evalArrayDefinition(e){this.currentValue=[];for(const t of e.parameters)this.currentValue.push(this.recursiveEval(t))}evalSpecialValues(e){"true"===e?this.currentValue=!0:"false"===e?this.currentValue=!1:"null"===e?this.currentValue=null:"undefined"===e&&(this.currentValue=void 0)}evalShortHandExpression(e){const t=this.recursiveEval(e.condition),n=this.recursiveEval(e.if),s=this.recursiveEval(e.else);this.currentValue=t?n:s}evalOrExpression(){this.currentValue=this.leftExpressionValueToCompare||this.currentValue,this.leftExpressionValueToCompare="$_not_Setted_$"}evalAndExpression(){this.currentValue=this.leftExpressionValueToCompare&&this.currentValue,this.leftExpressionValueToCompare="$_not_Setted_$"}evalEquality(){"==="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare===this.currentValue:"=="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare==this.currentValue:"!=="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare!==this.currentValue:"!="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare!=this.currentValue:"<="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare<=this.currentValue:">="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare>=this.currentValue:">"===this.equality.label?this.currentValue=this.leftExpressionValueToCompare>this.currentValue:"<"===this.equality.label&&(this.currentValue=this.leftExpressionValueToCompare<this.currentValue),this.leftExpressionValueToCompare="$_not_Setted_$"}eval(e){let t="";if("float"===e.syntax)t=parseFloat(e.label),""===this.currentValue?this.currentValue=this.adjustForNegative(t):this.currentValue=this.mathOrConcatValues(t);else if("integer"===e.syntax)t=parseInt(e.label),""===this.currentValue?this.currentValue=this.adjustForNegative(t):this.currentValue=this.mathOrConcatValues(t);else if("operator"===e.syntax)this.operator?"-"===this.operator&&"-"===e.label?this.operator="+":"-"===this.operator&&"+"===e.label?this.operator="-":"+"===this.operator&&"-"===e.label?this.operator="-":"+"===this.operator&&"+"===e.label?this.operator="+":"-"===this.doubleOperator&&"-"===e.label?this.doubleOperator="+":"-"===this.doubleOperator&&"+"===e.label?this.doubleOperator="-":"+"===this.doubleOperator&&"-"===e.label?this.doubleOperator="-":"+"===this.doubleOperator&&"+"===e.label?this.doubleOperator="+":this.doubleOperator=e.label:this.operator=e.label;else if(e.priority||"parentheses"===e.syntax){const n=e.priority?[{expression_nodes:e.priority}]:e.parameters;t=this.recursiveEval(n),this.currentValue=this.mathOrConcatValues(t)}else"variable"===e.syntax?(t=this.getOnScope(e.label),""===this.currentValue?this.currentValue=this.adjustForNegative(t):this.currentValue=this.mathOrConcatValues(t)):"string"===e.syntax?(t=this.removeQuotes(e.label),""===this.currentValue?this.currentValue=this.adjustForNegative(t):this.currentValue=this.mathOrConcatValues(t)):"arrayDefinition"===e.syntax?this.evalArrayDefinition(e):"object"===e.syntax?(t=this.evalObject(e),this.currentValue=this.mathOrConcatValues(t)):console.log("NOT NUMBER OR OPERATOR OR PRIORITY OR SHORT-HAND",e);return t}removeQuotes(e){let t="";for(const n of e)['"',"`","'"].includes(n)||(t+=n);return t}evalObject(e){let t="",n="",s="",i=0;for(const r of e.parameters){let e="";if("function"===r.syntax?e=r.label:"dictNode"===r.syntax?e=this.recursiveEval(r.parameters):"anonymousFunc"!==r.syntax&&console.log("NOT FUNCTION or DICTNODE!",r),0===i)t=this.getObjScope(e),i=1;else if(""===t)return;if("anonymousFunc"!==r.syntax)if(""===n&&t)n=t[e];else{if(!n)return n;n=n[e]}if("function"===r.syntax||"anonymousFunc"===r.syntax){const e=[];for(const t of r.parameters[0].expression_nodes)e.push(this.recursiveEval([{expression_nodes:[t]}]));s=n.apply(t||null,e),n=s}}return""!==n&&(s=n,n=""),s}recursiveEval(e){return new ParserEval({nodes:e,scope:this.$scope,$powerUi:this.$powerUi}).currentValue}adjustForNegative(e){return"-"===this.operator&&(e=-e),this.operator="",e}mathOrConcatValues(e){return this.operator&&!1===isNaN(e)&&(Number.isInteger(e)?e=parseInt(e):!1===isNaN(parseFloat(e))&&(e=parseFloat(e))),"-"===this.doubleOperator&&(e=-e,this.doubleOperator=""),"+"===this.operator?e=this.currentValue+e:"-"===this.operator?e=this.currentValue-e:"/"===this.operator?e=this.currentValue/e:"*"===this.operator&&(e=this.currentValue*e),this.operator="",e}getOnScope(e){return void 0!==this.$scope[e]?this.$scope[e]:void 0!==this.$powerUi[e]?this.$powerUi[e]:void 0}getObjScope(e){return void 0!==this.$scope[e]?this.$scope:void 0!==this.$powerUi[e]?this.$powerUi:void 0}}class StringPattern{constructor(e){this.listener=e,this.openQuote=null,this.escape=!1,this.invalid=!1}firstToken({token:e,counter:t}){return!!["quote"].includes(e.name)&&(this.openQuote=e.value,this.listener.candidates=this.listener.candidates.filter(e=>"string"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return e.value!==this.openQuote&&"end"!==e.name?("escape"===e.name&&(this.escape=!0),!0):e.value===this.openQuote&&("escape"===e.name?this.escape=!1:(this.openQuote=null,this.listener.checking="endToken"),!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"string",token:e,counter:t}),!1):!0===this.invalid&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class VariablePattern{constructor(e){this.listener=e}firstToken({token:e,counter:t}){return!!["letter","especial"].includes(e.name)&&(this.listener.candidates=this.listener.candidates.filter(e=>"variable"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return!!["letter","especial","number"].includes(e.name)||(["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"variable",token:e,counter:t}),!1):"("===e.value||"["===e.value||"dot"===e.name?(this.listener.checking="firstToken",this.listener.firstNodeLabel=this.listener.currentLabel,this.listener.candidates=[{name:"object",instance:new ObjectPattern(this.listener)}],!0):(this.listener.checking="endToken",!0))}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class BracesPattern{constructor(e){this.listener=e,this.innerObjects=0,this.currentParams="",this.dictDefinition=[],this.currentKey="",this.currentValue=""}firstToken({token:e,counter:t}){return"{"===e.value&&(this.listener.candidates=this.listener.candidates.filter(e=>"braces"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){if(0!==this.innerObjects||"}"!==e.value)return["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","number","letter","operator","dot","separator","undefined","short-hand","braces"].includes(e.name)?(["{","(","["].includes(e.value)?this.innerObjects=this.innerObjects+1:["}",")","]"].includes(e.value)&&(this.innerObjects=this.innerObjects-1),0===this.innerObjects&&(":"===e.value?(this.currentKey=this.currentParams.trim(),this.currentParams="",this.containsQuotes(this.currentKey)||(this.currentKey=`"${this.currentKey}"`),this.currentKey=new PowerTemplateParser({text:this.currentKey,counter:t-this.currentKey.length,isParameter:!0}).syntaxTree.tree):","===e.value&&this.setDictDefinition(t)),(":"!==e.value&&","!==e.value||0!==this.innerObjects)&&(this.currentParams=this.currentParams+e.value),!0):(this.listener.checking="endToken",!0);this.setDictDefinition(t),this.listener.checking="endToken"}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"dictDefinition",token:e,counter:t,parameters:this.dictDefinition}),!1)}containsQuotes(e){return e.indexOf("'")>=0||e.indexOf('"')>=0||e.indexOf("`")>=0}setDictDefinition(e){""!==this.currentParams&&(this.currentValue=this.currentParams,this.currentParams="",this.currentValue=new PowerTemplateParser({text:this.currentValue,counter:e-this.currentValue.length,isParameter:!0}).syntaxTree.tree,this.dictDefinition.push({kind:"keyValue",key:this.currentKey,value:this.currentValue}))}}class NumberPattern{constructor(e){this.listener=e,this.float=!1}firstToken({token:e,counter:t}){return"number"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"number"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return!1===this.float&&"number"===e.name||(!1===this.float&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT-NOT","NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"integer",token:e,counter:t}),!1):!1===this.float&&"."===e.value?(this.float=!0,!0):!0===this.float&&"number"===e.name||(!0===this.float&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT-NOT","NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"float",token:e,counter:t}),!1):(this.listener.checking="endToken",!0)))}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class OperationPattern{constructor(e){this.listener=e}firstToken({token:e,counter:t}){return"operator"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"operator"===e.name),this.openOperator=e.value,this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return["blank","end","letter","especial","number","quote","operator"].includes(e.name)||"("===e.value?(this.listener.nextPattern({syntax:"operator",token:e,counter:t}),!1):(this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class EqualPattern{constructor(e){this.listener=e,this.one=null,this.two=null,this.three=null,this.invalid=!1}firstToken({token:e,counter:t}){return"equal"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"equal"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return null===this.two?"equal"===e.name?(this.two=e.value,!0):(this.invalid=!0,this.listener.checking="endToken",!0):"equal"===e.name?(this.three=e.value,this.listener.checking="endToken",!0):["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"equal",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"equal",token:e,counter:t}),!1):!0!==this.invalid||!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class MinorThanPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"minor-than"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"minor-than"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return"equal"===e.name?(this.listener.checking="endToken",!0):["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"minor-than",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"minor-or-equal",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class GreaterThanPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"greater-than"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"greater-than"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return"equal"===e.name?(this.listener.checking="endToken",!0):["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"greater-than",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"greater-or-equal",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class NotPattern{constructor(e){this.listener=e,this.one=null,this.two=null,this.three=null,this.invalid=!1}firstToken({token:e,counter:t}){return"NOT"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"NOT"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return null===this.two?"equal"===e.name||"NOT"===e.name?(this.two=e.value,!0):["blank","end","letter","especial","number","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"NOT",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0):(this.three=e.value,"="===this.two&&"equal"===e.name?(this.listener.checking="endToken",!0):"="===this.two&&["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"NOT-equal",token:e,counter:t}),!1):"!"===this.two&&["blank","end","letter","especial","number","quote"].includes(e.name)?(this.listener.checking="endToken",this.listener.nextPattern({syntax:"NOT-NOT",token:e,counter:t}),!1):"!"===this.two&&"NOT"===e.name?(this.listener.checking="endToken",!0):(this.invalid=!0,this.listener.checking="endToken",!0))}endToken({token:e,counter:t}){return!1===this.invalid&&"="===this.three&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"NOT-equal",token:e,counter:t}),!1):!1===this.invalid&&"!"===this.three&&["blank","end","letter","number","especial","quote"].includes(e.name)?void this.listener.nextPattern({syntax:"NOT-NOT",token:e,counter:t}):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):("!"!==e.value&&(this.invalid=!0),!0)}}class AndPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"AND"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"AND"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return"AND"===e.name?(this.listener.checking="endToken",!0):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"AND",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class OrPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"OR"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"OR"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return"OR"===e.name?(this.listener.checking="endToken",!0):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"OR",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class ShortHandPattern{constructor(e){this.listener=e,this.currentParams="",this.shortHand={syntax:"short-hand",condition:[],if:[],else:[],label:""},this.counter=0,this.openShortHand=0,this.needCloseShortHand=0,this.parentheses=0,this.brackets=0}firstToken({token:e,counter:t}){return"short-hand"===e.name&&"?"===e.value&&(this.openShortHand=this.openShortHand+1,this.createConditionNode({token:e,counter:t}),!0)}middleTokens({token:e,counter:t}){if(["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","number","letter","operator","dot","separator","undefined"].includes(e.name))return this.currentParams=this.currentParams+e.value,"("===e.value?this.parentheses=this.parentheses+1:"["===e.value?this.brackets=this.brackets+1:")"===e.value?this.parentheses=this.parentheses-1:"]"===e.value&&(this.brackets=this.brackets-1),!0;if("short-hand"===e.name&&":"===e.value)return 0===this.brackets&&0===this.parentheses&&(this.needCloseShortHand=this.needCloseShortHand+1,this.openShortHand===this.needCloseShortHand&&(this.needCloseShortHand=this.needCloseShortHand-1,this.createIfNode({token:e,text:this.currentParams}))),this.currentParams=this.currentParams+e.value,!0;if("short-hand"===e.name&&"?"===e.value){if(0===this.brackets&&0===this.parentheses){if(1===this.openShortHand&&1===this.needCloseShortHand){let n=this.shortHand.label+this.currentParams;return this.listener.syntaxTree.nodes=[{syntax:"temp",label:n}],this.shortHand={syntax:"short-hand",condition:[],if:[],else:[],label:""},this.openShortHand=this.openShortHand-1,this.needCloseShortHand=this.needCloseShortHand-1,this.counter=0,this.currentParams=this.currentParams+e.value,this.createConditionNode({token:e,counter:t}),!0}this.openShortHand=this.openShortHand+1}return this.currentParams=this.currentParams+e.value,!0}return"end"===e.name?(this.createElseNode({token:e}),!1):(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}createConditionNode({token:e}){for(const e of this.listener.syntaxTree.nodes)this.shortHand.label=`${this.shortHand.label}${e.label}`;this.shortHand.condition=new PowerTemplateParser({text:this.shortHand.label,counter:this.counter,isParameter:!0}).syntaxTree.tree,this.listener.syntaxTree.nodes=[],this.listener.candidates=this.listener.candidates.filter(e=>"short-hand"===e.name),this.listener.checking="middleTokens",this.counter=this.shortHand.label.length+1,this.currentParams="",this.fullLabel=this.shortHand.label+e.value}createIfNode({token:e,text:t}){this.shortHand.if=new PowerTemplateParser({text:t,counter:this.counter,isParameter:!0}).syntaxTree.tree,this.shortHand.label=this.fullLabel+this.currentParams,this.counter=this.shortHand.label.length+1,this.currentParams=""}createElseNode({token:e}){this.shortHand.else=new PowerTemplateParser({text:this.currentParams,counter:this.counter,isParameter:!0}).syntaxTree.tree,this.shortHand.label=this.shortHand.label+this.currentParams,this.shortHand.start=0,this.shortHand.end=this.shortHand.label.length,this.listener.syntaxTree.nodes.push(this.shortHand),this.openShortHand=this.openShortHand-1,this.needCloseShortHand=this.needCloseShortHand-1}}class CommaPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"comma"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"comma"===e.name),this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","especial","separator","operator","quote","equal","NOT","NOT-NOT","comma","number","letter"].includes(e.name)?(this.listener.nextPattern({syntax:"comma",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class DictPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){if("dot"===e.name&&0===this.listener.syntaxTree.nodes.length){this.listener.checking="endToken",this.listener.firstNodeLabel=this.listener.currentLabel;const e=new ObjectPattern(this.listener);return e.invalid=!0,this.listener.candidates=[{name:"object",instance:e}],!0}if("dot"===e.name||"["===e.value){this.listener.checking="firstToken",this.listener.firstNodeLabel=this.listener.currentLabel;const e=new ObjectPattern(this.listener);return e.anonymous=!0,this.listener.candidates=[{name:"object",instance:e}],!0}return!1}}class parenthesesPattern{constructor(e){this.listener=e,this.invalid=!1,this.nodes=[],this.currentOpenChar=null,this.currentParams="",this.currentParamsCounter=null,this.innerOpenedParenteses=0,this.anonymous=!1}firstToken({token:e,counter:t}){if(this.currentOpenChar=e.value,"("!==this.currentOpenChar||this.listener.isAnonymousFunc){if(!0===this.listener.isAnonymousFunc){this.listener.checking="firstToken",this.listener.firstNodeLabel=this.listener.currentLabel;const e=new ObjectPattern(this.listener);return e.anonymous=!0,this.listener.candidates=[{name:"object",instance:e}],this.listener.isAnonymousFunc=!1,!0}return!1}return this.listener.candidates=this.listener.candidates.filter(e=>"parentheses"===e.name),this.listener.checking="middleTokens",null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0}middleTokens({token:e,counter:t}){return")"===e.value&&0===this.innerOpenedParenteses?(this.listener.checking="endToken",!0):["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator","braces","undefined"].includes(e.name)?(this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),"("===e.value?this.innerOpenedParenteses=this.innerOpenedParenteses+1:")"===e.value&&(this.innerOpenedParenteses=this.innerOpenedParenteses-1),!0):this.innerOpenedParenteses>=0&&"end"===e.name?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){if(!1===this.invalid){if(["blank","end","dot","operator"].includes(e.name)){const n=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return this.listener.nextPattern({syntax:this.anonymous?"anonymousFunc":"parentheses",token:e,counter:t,parameters:n}),!1}if("("===e.value){const e=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return this.listener.syntaxTree.nodes.push({syntax:this.anonymous?"anonymousFunc":"parentheses",label:this.listener.currentLabel,tokens:this.listener.currentTokens,start:this.listener.start,end:t,parameters:e||[]}),this.listener.start=t,this.listener.currentTokens=[],this.currentParams=[],this.listener.currentLabel="",this.anonymous=!0,this.listener.checking="middleTokens",!0}return this.invalid=!0,!0}return!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class ArrayDefinitionPattern{constructor(e){this.listener=e,this.invalid=!1,this.nodes=[],this.innerOpenedObjects=0,this.currentParams="",this.arrayContent=[],this.currentParamsCounter=null}firstToken({token:e,counter:t}){const n=this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1];return!("["!==e.value||n&&"dictNode"===n.syntax)&&(this.listener.candidates=this.listener.candidates.filter(e=>"arrayDefinition"===e.name),this.listener.checking="middleTokens",null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0)}middleTokens({token:e,counter:t}){return"]"===e.value&&0===this.innerOpenedObjects?(this.listener.checking="endToken",""!==this.currentParams&&this.setArrayItem(),!0):["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator","braces","undefined"].includes(e.name)?(0===this.innerOpenedObjects&&","===e.value?this.setArrayItem():this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),["{","(","["].includes(e.value)?this.innerOpenedObjects=this.innerOpenedObjects+1:["}",")","]"].includes(e.value)&&(this.innerOpenedObjects=this.innerOpenedObjects-1),!0):void 0}endToken({token:e,counter:t}){return!1===this.invalid?["end","blank","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","operator"].includes(e.name)?(this.listener.nextPattern({syntax:"arrayDefinition",token:e,counter:t,parameters:this.arrayContent}),!1):(this.invalid=!0,!0):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}setArrayItem(){const e=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!1}).syntaxTree.tree;this.arrayContent.push(e),this.currentParams=""}}class ObjectPattern{constructor(e){this.listener=e,this.invalid=!1,this.nodes=[],this.currentOpenChar=null,this.currentParams="",this.currentParamsCounter=null,this.innerOpenedObjects=0,this.anonymous=!1}firstToken({token:e,counter:t}){if(null===e.value){const n=this.listener.currentTokens[this.listener.currentTokens.length-1];if("("===n.value||"["===n.value||"."===n.value)return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1}return this.currentOpenChar=this.listener.currentTokens[this.listener.currentTokens.length-1].value,"("===this.currentOpenChar?")"===e.value?(this.listener.checking="endToken",!0):["blank","end","letter","number","especial","NOT","NOT-NOT","quote","undefined"].includes(e.name)||"-"===e.value||"+"===e.value?(this.listener.checking="middleTokens",this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0):["(","[","{"].includes(e.value)?(this.innerOpenedObjects=this.innerOpenedObjects+1,this.currentParams=this.currentParams+e.value,this.listener.checking="middleTokens",null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0):(this.invalid=!0,this.listener.checking="endToken",!0):"["!==this.currentOpenChar&&"."!==this.currentOpenChar||"separator"===e.name&&"("!==e.value?("dot"===e.name||"separator"===e.name)&&(this.invalid=!0,this.listener.checking="endToken",!0):("."!==this.listener.currentLabel&&"["!==this.listener.currentLabel?(this.listener.firstNodeLabel=this.listener.currentLabel,this.currentParams=`"${this.listener.currentLabel.slice(0,this.listener.currentLabel.length-1)}"`,this.createDictionaryNode({token:e,counter:t}),"."===this.currentOpenChar&&"number"===e.name&&(this.invalid=!0)):this.listener.checking="middleTokens",this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0)}middleTokens({token:e,counter:t}){if("("===this.currentOpenChar&&")"===e.value&&0===this.innerOpenedObjects)return this.listener.checking="endToken",!0;if("("===this.currentOpenChar&&["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator","braces","undefined"].includes(e.name))return this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),["(","{","["].includes(e.value)?this.innerOpenedObjects=this.innerOpenedObjects+1:[")","}","]"].includes(e.value)&&(this.innerOpenedObjects=this.innerOpenedObjects-1),!0;if("("===this.currentOpenChar&&this.innerOpenedObjects>=0&&"end"===e.name)return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1;if("["===this.currentOpenChar&&"]"===e.value&&0===this.innerOpenedObjects)return this.invalid=!this.currentParams.length,this.listener.checking="endToken",!0;if("."!==this.currentOpenChar||!["blank","end","operator","dot"].includes(e.name)&&"("!==e.value&&"["!==e.value)return"["===this.currentOpenChar&&["blank","escape","especial","quote","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator"].includes(e.name)?(this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),"["===e.value?this.innerOpenedObjects=this.innerOpenedObjects+1:"]"===e.value&&(this.innerOpenedObjects=this.innerOpenedObjects-1),!0):"."===this.currentOpenChar&&["especial","number","letter"].includes(e.name)?(this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0):"["===this.currentOpenChar&&this.innerOpenedObjects>=0&&"end"===e.name?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0);{if(this.listener.currentTokens.length>=2&&"dot"===this.listener.currentTokens[0].name&&"number"===this.listener.currentTokens[1].name||this.listener.syntaxTree.nodes.length&&this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1]&&"dictNode"===this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1].syntax&&"."===this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1].tokens[this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1].tokens.length-1].value&&"number"===this.listener.currentTokens[0].name)return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1;const n=new PowerTemplateParser({text:`"${this.currentParams}"`,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return this.listener.currentLabel=this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,"("===e.value&&(this.listener.isAnonymousFunc=!0),this.listener.nextPattern({syntax:"dictNode",token:e,counter:t,parameters:n}),!1}}endToken({token:e,counter:t}){if(!1===this.invalid){if(["blank","end","operator","comma","dot"].includes(e.name)){const n=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return"("===this.currentOpenChar?(this.listener.currentLabel=this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,this.listener.nextPattern({syntax:this.anonymous?"anonymousFunc":"function",token:e,counter:t,parameters:n}),!1):"["===this.currentOpenChar||"."===this.currentOpenChar?(this.listener.currentLabel=this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,this.listener.nextPattern({syntax:"dictNode",token:e,counter:t,parameters:n}),!1):(this.invalid=!0,!0)}return"("!==this.currentOpenChar||"("!==e.value&&"["!==e.value?"["!==this.currentOpenChar||"["!==e.value&&"("!==e.value?(this.invalid=!0,!0):(this.createDictionaryNode({token:e,counter:t}),this.currentOpenChar=e.value,!0):(this.listener.checking="middleTokens",this.createAnonymousFuncNode({token:e,counter:t}),this.currentOpenChar=e.value,!0)}return!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}dictHaveInvalidParams(e){return 0===e.length&&(invalid=!0,!0)}createDictionaryNode({token:e,counter:t}){const n=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;if(this.dictHaveInvalidParams(n))return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1;this.listener.syntaxTree.nodes.push({syntax:"dictNode",label:this.listener.firstNodeLabel?this.listener.firstNodeLabel:this.listener.currentLabel,tokens:this.listener.currentTokens,start:this.listener.start,end:t,parameters:n||[]}),this.listener.start=t,this.listener.currentTokens=[],this.currentParams=[],this.listener.currentLabel="",this.listener.firstNodeLabel="",this.anonymous=!0,this.listener.checking="middleTokens"}createAnonymousFuncNode({token:e,counter:t}){const n=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;this.listener.currentLabel=!0===this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,this.listener.syntaxTree.nodes.push({syntax:!0===this.anonymous?"anonymousFunc":"function",label:this.listener.currentLabel,tokens:this.listener.currentTokens,start:this.listener.start,end:t,parameters:n||[]}),this.listener.start=t,this.listener.currentTokens=[],this.currentParams=[],this.listener.currentLabel="",this.listener.firstNodeLabel="",this.anonymous=!0,this.listener.checking="middleTokens"}}class EmptyPattern{constructor(e){this.listener=e}firstToken({token:e,counter:t}){return"blank"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"empty"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return"blank"===e.name||(this.listener.nextPattern({syntax:"empty",token:e,counter:t}),!1)}}class AccordionModel{constructor(e){this.ctx=e,this.multipleSectionsOpen="true"===e.element.getAttribute("data-multiple-sections-open")}}class AccordionSectionModel{constructor(e){this.ctx=e,this.active=!1}}class AccordionSectionHtmlCtrl{constructor(e){this.ctx=e}toggle(){if(!this.ctx.powerAccordion.model.multipleSectionsOpen)for(const e of Object.keys(this.ctx.powerAccordion.childrenActions||{})){const t=this.ctx.powerAccordion.childrenActions[e];t.targetObj.id!==this.ctx.powerAccordion.id&&t._$pwActive&&this.ctx!==t.targetObj&&(t.toggle({avoidCallAction:!0}),t.targetObj.model.active=!t.targetObj.model.active)}}}class PowerAccordion extends PowerTarget{constructor(e){super(e),this.model=new AccordionModel(this)}init(){this.childrenSections=this.getChildrenByPowerCss("powerAccordionSection"),this.childrenActions=this.getChildrenByPowerCss("powerAction")}}PowerUi.injectPowerCss({name:"power-accordion"});class PowerAccordionSection extends PowerTarget{constructor(e){super(e),this.model=new AccordionSectionModel(this),this.ctrl="htmlCtrl"}init(){this.htmlCtrl=new AccordionSectionHtmlCtrl(this);let e=this.parent;do{"powerAccordion"===e.$powerCss?this.powerAccordion=e:e=e.parent}while(e&&"powerAccordion"!==e.$powerCss)}action(){this[this.ctrl].toggle()}}PowerUi.injectPowerCss({name:"power-accordion-section"});class PowerAction extends PowerTarget{constructor(e){if(super(e),this._target=this.element.dataset.powerTarget,!this._target)throw console.error("power-action selector needs a power element target",this.element),'Missing power-action target. Please define it: data-power-target="power_element_id"'}init(){const e=this.$powerUi.powerTree.allPowerObjsById[this._target];for(const t in e)e[t].powerTarget&&(this.targetObj=e[t]);this.targetObj.powerAction=this,this.subscribe({event:"click",fn:this.toggle})}toggle(e={}){this.targetObj.action&&!e.avoidCallAction&&this.targetObj.action(),this._$pwActive?(this._$pwActive=!1,this.targetObj._$pwActive=!1,this.targetObj.element.classList.remove("power-active"),this.element.classList.remove("power-active")):(this._$pwActive=!0,this.targetObj._$pwActive=!0,this.targetObj.element.classList.add("power-active"),this.element.classList.add("power-active")),this.broadcast("toggle",!0)}ifClickOut(){this._$pwActive?document.removeEventListener("click",this._clickPowerItemOrOutside):(this._clickPowerItemOrOutside=this.clickPowerItemOrOutside.bind(this),document.addEventListener("click",this._clickPowerItemOrOutside))}clickPowerItemOrOutside(e){const t=document.getElementById(this.targetObj.id),n=document.getElementById(this.id);let s=e.target;if(s.classList.contains("power-item")||s.classList.contains("power-brand"))this.toggle();else{do{if(s===t||s===n)return;s=s.parentNode}while(s);this.toggle()}}}PowerUi.injectPowerCss({name:"power-action"});class PowerToggle extends PowerAction{constructor(e){super(e)}}PowerUi.injectPowerCss({name:"power-toggle"});class PowerBrand extends PowerTarget{constructor(e){super(e),this.id=this.element.getAttribute("id")}}PowerUi.injectPowerCss({name:"power-brand"});class PowerDropmenu extends PowerTarget{constructor(e){super(e),this.defaultPosition=this.element.getAttribute("data-power-position")||"bottom-right",this._markRootAndMenuDropmenu()}init(){if(this.childrenPowerActions=this.getChildrenByPowerCss("powerAction"),this.innerPowerActionsWithoutChildren=this.getInnerWithoutChildrenByPowerCss("powerAction"),this.childrenPowerItems=this.getChildrenByPowerCss("powerItem"),this.innerPowerItemsWithoutChildren=this.getInnerWithoutChildrenByPowerCss("powerItem"),this.innerPowerDropmenus=this.getInnerByPowerCss("powerDropmenu"),this.isRootElement&&!this.isMenuElement){defineRootDropmenusPosition(this,this);for(const e of this.innerPowerDropmenus)defineInnerDropmenusPosition(this,e)}}_markRootAndMenuDropmenu(){const e=PowerTree._searchUpDOM(this.element,PowerTree._checkIfhavePowerParentElement);e.conditionResult?(e.powerElement.className.includes("power-dropmenu")?this.isRootElement=!1:this.isRootElement=!0,e.powerElement.className.includes("power-menu")&&(this.isMenuElement=!0)):this.isRootElement=!0}hoverModeOn(){if(this.$powerUi.tmp.dropmenu._mouseIsMovingTo)this.$powerUi.tmp.dropmenu._mouseIsMovingTo.id!==this.id&&this.moveOverPossibleNewTarget(this);else for(const e of this.childrenPowerActions)e.subscribe({event:"mouseenter",fn:this.onMouseEnterAction,action:e,dropmenu:this}),e.subscribe({event:"click",fn:this.onMouseEnterAction,action:e,dropmenu:this})}onMouseEnterAction(e,t,n){if(this.$powerUi.tmp.dropmenu._mouseIsMovingTo)this.$powerUi.tmp.dropmenu._mouseIsMovingTo.id!==n.dropmenu.id&&n.dropmenu.moveOverPossibleNewTarget(this);else if(!n.action._$pwActive){n.action.toggle(),n.dropmenu.onMouseEnterItem(e,t,n,!0);for(const e of n.dropmenu.childrenPowerItems)e.subscribe({event:"mouseenter",fn:n.dropmenu.onMouseEnterItem,action:n.action,dropmenu:n.dropmenu,item:e});n.dropmenu.startWatchMouseMove(e,t,n)}}onMouseEnterItem(e,t,n,s){if(this.$powerUi.tmp.dropmenu._mouseIsMovingTo)this.$powerUi.tmp.dropmenu._mouseIsMovingTo.id!==n.dropmenu.id&&n.dropmenu.moveOverPossibleNewTarget(n.item);else{s||n.action._$pwActive&&n.action.toggle();for(const e of n.dropmenu.innerPowerActionsWithoutChildren)e._$pwActive&&e.toggle();for(const e of n.dropmenu.childrenPowerActions)e._$pwActive&&e.id!==n.action.id&&e.toggle();for(const e of n.dropmenu.childrenPowerItems)e.unsubscribe({event:"mouseenter",fn:n.dropmenu.onMouseEnterItem,action:n.action,dropmenu:n.dropmenu})}}hoverModeOff(){this.stopWatchMouseMove();for(const e of this.childrenPowerActions)e.unsubscribe({event:"mouseenter",fn:this.onMouseEnterAction,action:e,dropmenu:this}),e.unsubscribe({event:"click",fn:this.onMouseEnterAction,action:e,dropmenu:this})}moveOverPossibleNewTarget(e){this.$powerUi.tmp.dropmenu._possibleNewTarget=e}onmousestop(){if(this.$powerUi.tmp.dropmenu._possibleNewTarget&&!this.$powerUi.tmp.dropmenu._possibleNewTarget._$pwActive){const e=this.$powerUi.tmp.dropmenu._possibleNewTarget;setTimeout((function(){e.broadcast("mouseenter")}),10),this.stopWatchMouseMove()}else this.$powerUi.tmp.dropmenu._resetMouseTimeout()}resetMouseTimeout(){clearTimeout(this.$powerUi.tmp.dropmenu.timeout),this.$powerUi.tmp.dropmenu.timeout=setTimeout(this.$powerUi.tmp.dropmenu._onmousestop,120)}startWatchMouseMove(e,t,n){this.$powerUi.tmp.dropmenu._mouseIsMovingTo||(n.action.targetObj.subscribe({event:"mouseenter",fn:this.stopWatchMouseMove,action:n.action,dropmenu:n.dropmenu}),this.$powerUi.tmp.dropmenu._mouseIsMovingTo=n.action.targetObj,this.$powerUi.tmp.dropmenu._onmousestop=this.onmousestop.bind(this),this.$powerUi.tmp.dropmenu._resetMouseTimeout=this.resetMouseTimeout.bind(this),this.$powerUi.tmp.dropmenu.timeout=setTimeout(this.$powerUi.tmp.dropmenu._onmousestop,300),document.addEventListener("mousemove",this.$powerUi.tmp.dropmenu._resetMouseTimeout,!0))}stopWatchMouseMove(){this.$powerUi.tmp.dropmenu._mouseIsMovingTo=!1,this.$powerUi.tmp.dropmenu._possibleNewTarget=!1,clearTimeout(this.$powerUi.tmp.dropmenu.timeout),document.removeEventListener("mousemove",this.$powerUi.tmp.dropmenu._resetMouseTimeout,!0),this.unsubscribe({event:"mouseenter",fn:this.stopWatchMouseMove})}setPositionRightBottom(e){this.element.style.left=this.powerAction.element.offsetLeft+this.powerAction.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop+"px"}setPositionBottomRight(e){this.element.style.top=this.powerAction.element.offsetTop+this.powerAction.element.offsetHeight+"px",this.element.style.left=this.powerAction.element.offsetLeft+"px"}setPositionLeftBottom(e){this.element.style.left=this.powerAction.element.offsetLeft-this.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop+"px"}setPositionBottomLeft(e){const t=this.powerAction.element.offsetWidth-this.element.offsetWidth;this.element.style.left=this.powerAction.element.offsetLeft+t+"px"}setPositionRightTop(e){this.element.style.left=this.powerAction.element.offsetLeft+this.powerAction.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop-(this.element.offsetHeight-this.powerAction.element.offsetHeight)+"px"}setPositionTopRight(e){this.element.style.left=this.powerAction.element.offsetLeft+"px",this.element.style.top=this.powerAction.element.offsetTop-this.element.offsetHeight+"px"}setPositionLeftTop(e){this.element.style.left=this.powerAction.element.offsetLeft-this.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop-(this.element.offsetHeight-this.powerAction.element.offsetHeight)+"px"}setPositionTopLeft(e){const t=this.powerAction.element.offsetWidth-this.element.offsetWidth;this.element.style.left=this.powerAction.element.offsetLeft+t+"px",this.element.style.top=this.powerAction.element.offsetTop-this.element.offsetHeight+"px"}ifPositionOutOfScreenChangeDirection(){const e=this.element.getBoundingClientRect(),t={topDown:this.defaultPosition.includes("bottom")?"bottom":"top",leftRight:this.defaultPosition.includes("right")?"right":"left"},n={topDown:0,leftRight:0};e.right>document.defaultView.innerWidth?(t.leftRight="left",n.leftRight++):e.left<0&&(t.leftRight="right",n.leftRight++),e.bottom>document.defaultView.innerHeight?(t.topDown="top",n.topDown++):e.top<0&&(t.topDown="bottom",n.topDown++),(n.topDown>0||n.leftRight>0)&&("top"===t.topDown?"left"===t.leftRight?this.setPositionLeftTop():this.setPositionRightTop():"left"===t.leftRight?this.setPositionLeftBottom():this.setPositionRightBottom(),this.setPositionLimits())}setPositionLimits(){const e=this.element.getBoundingClientRect();e.left<0&&(this.element.style.left="0px"),e.top<0&&(this.element.style.top="0px")}resetDropmenuPosition(){this.element.style.top=null,this.element.style.left=null}toggle(){this.resetDropmenuPosition(),this.element.classList.add("power-hide");const e=this;this._$pwActive?this.$powerUi.touchdevice||this.hoverModeOff():(setTimeout((function(){"bottom-right"===e.defaultPosition?e.setPositionBottomRight():"right-bottom"===e.defaultPosition?e.setPositionRightBottom():"bottom-left"===e.defaultPosition?e.setPositionBottomLeft():"left-bottom"===e.defaultPosition?e.setPositionLeftBottom():"top-right"===e.defaultPosition?e.setPositionTopRight():"right-top"===e.defaultPosition?e.setPositionRightTop():"left-top"===e.defaultPosition?e.setPositionLeftTop():"top-left"===e.defaultPosition?e.setPositionTopLeft():e.setPositionRightBottom(),"fixed"===getComputedStyle(e.powerAction.element).position&&(e.element.style.position="fixed",e.element.style.left=getComputedStyle(e.powerAction.element).left),e.ifPositionOutOfScreenChangeDirection(),e.element.classList.remove("power-hide")}),50),this.$powerUi.touchdevice||this.hoverModeOn()),this.powerAction.ifClickOut(),this.broadcast("toggle",!0)}action(){this.toggle()}}PowerUi.injectPowerCss({name:"power-dropmenu"});class PowerItem extends PowerTarget{constructor(e){super(e)}}PowerUi.injectPowerCss({name:"power-item"});class PowerMain extends _PowerBasicElementWithEvents{constructor(e){super(e)}}PowerUi.injectPowerCss({name:"power-main",isMain:!0});class PowerMenu extends PowerTarget{constructor(e,t){super(e),this.$powerUi=t,this._$pwActive=!1,this.id=this.element.getAttribute("id"),this.powerTarget=!0,this.defaultPosition=this.element.getAttribute("data-power-position"),this.defaultPosition||(this.element.classList.contains("power-horizontal")?this.defaultPosition="bottom-right":this.defaultPosition="right-bottom")}init(){this.childrenPowerActions=this.getChildrenByPowerCss("powerAction"),this.innerPowerActionsWithoutChildren=this.getInnerWithoutChildrenByPowerCss("powerAction"),this.childrenPowerDropmenus=this.getChildrenByPowerCss("powerDropmenu"),this.innerPowerDropmenus=this.getInnerByPowerCss("powerDropmenu");for(const e of this.innerPowerDropmenus)e.isRootElement?defineRootDropmenusPosition(this,e):defineInnerDropmenusPosition(this,e);for(const e of this.childrenPowerActions)this.$powerUi.touchdevice||(e.subscribe({event:"click",fn:this.hoverModeOn,menu:this}),e.subscribe({event:"toggle",fn:this.maySetHoverModeOff,menu:this}))}hoverModeOn(e,t,n){for(const e of n.menu.childrenPowerActions)e.subscribe({event:"mouseenter",fn:n.menu.onMouseEnterAction,action:e,menu:n.menu})}onMouseEnterAction(e,t,n){n.menu.resetAnyDropdownTmpInfo(),n.action._$pwActive||n.action.toggle();for(const e of n.menu.innerPowerActionsWithoutChildren)e._$pwActive&&e.toggle();for(const e of n.menu.childrenPowerActions)e._$pwActive&&e.id!==n.action.id&&e.toggle()}maySetHoverModeOff(e,t,n){setTimeout((function(){let s=!1;for(const e of n.menu.childrenPowerActions)e._$pwActive&&(s=!0);!1===s&&n.menu.hoverModeOff(e,t,n)}),50)}hoverModeOff(e,t,n){for(const e of n.menu.childrenPowerActions)e.unsubscribe({event:"mouseenter",fn:n.menu.onMouseEnterAction,action:e,menu:n.menu})}resetAnyDropdownTmpInfo(){this.$powerUi.tmp.dropmenu._mouseIsMovingTo=!1,this.$powerUi.tmp.dropmenu._possibleNewTarget=!1,clearTimeout(this.$powerUi.tmp.dropmenu.timeout),document.removeEventListener("mousemove",this.$powerUi.tmp.dropmenu._resetMouseTimeout,!0),this.unsubscribe({event:"mouseenter",fn:this.stopWatchMouseMove})}toggle(){this.powerAction.ifClickOut(),this.powerAction.broadcast("toggle",!0)}action(){this.toggle()}}PowerUi.injectPowerCss({name:"power-menu",isMain:!0});class PowerStatus extends PowerTarget{constructor(e){super(e);const t=this.element.getAttribute("data-power-active"),n=this.element.getAttribute("data-power-inactive");this.activeValues=t?t.split(" "):[],this.inactiveValues=n?n.split(" "):[],this.inactive()}active(){for(const e of this.activeValues)this.element.classList.add(e);for(const e of this.inactiveValues)this.element.classList.remove(e)}inactive(){for(const e of this.inactiveValues)this.element.classList.add(e);for(const e of this.activeValues)this.element.classList.remove(e)}toggle(){this._$pwActive=!this._$pwActive,this._$pwActive?this.active():this.inactive()}init(){let e=!1,t=this.element.parentElement;const n=this.$powerUi.powerTree.allPowerObjsById;for(;!e;){if(t)for(const e of Object.keys(n[t.id]||{}))n[t.id][e].powerTarget&&(this.targetObj=n[t.id][e]);this.targetObj||e?e=!0:t=t.parentElement}this.targetObj&&this.targetObj.subscribe({event:"toggle",fn:this.toggle.bind(this)})}}PowerUi.injectPowerCss({name:"power-status"});