"use strict";function getIdAndCreateIfDontHave(e){let t=e.id;return t||(t=_Unique.domID(e.tagName.toLowerCase())),e.setAttribute("id",t),t}function asDataSet(e){const t=e.split("-").filter(e=>"data"!=e);let i="";for(let e=0;e<t.length;e++)i+=0===e?t[e]:t[e].replace(/\b\w/g,e=>e.toUpperCase());return i}function powerClassAsCamelCase(e){return`${e.split("-")[0]}${e.split("-")[1].charAt(0).toUpperCase()}${e.split("-")[1].slice(1)}`}class SharedScope{constructor({id:e,main:t,view:i,rootCompiler:s,parent:n,ctx:r}){this.id=e,this.tempMainEl=t,this.tempViewEl=i,this.tempRootCompilerEl=s,this.tempParent=n||{node:null,datasetKey:null},this.ctx=r,this.cached={}}get element(){return document.getElementById(this.id)}get main(){return this.tempMainEl?document.getElementById(this.tempMainEl.id):null}get view(){return this.tempViewEl?document.getElementById(this.tempViewEl.id):null}get rootCompiler(){return this.tempRootCompilerEl?document.getElementById(this.tempRootCompilerEl.id):null}get parentNode(){return this.tempParent.node?document.getElementById(this.tempParent.node.id):null}get parentDatasetKey(){return this.tempParent.datasetKey}get parentObj(){if(!this.parentNode)return null;const e=this.parentNode.id,t=this.parentDatasetKey;return this.ctx.allPowerObjsById[e]&&this.ctx.allPowerObjsById[e][t]?this.ctx.allPowerObjsById[e][t]:null}get mainObj(){return this.cached.isMain||this.getTarget(this.main.id,"isMain")}get viewObj(){return this.cached.isView||this.getTarget(this.view.id,"isView")}get rootCompilerObj(){const e="isRootCompiler";return this.cached[e]||this.getTarget(this.rootCompiler.id,e)}getTarget(e,t){if(!e)return!1;if(null!=this.cached[t])return this.cached[t];for(const i of Object.keys(this.ctx.allPowerObjsById[e]||{}))if(this.ctx.allPowerObjsById[e][i][t])return this.cached[t]=this.ctx.allPowerObjsById[e][i],this.cached[t];this.cached[t]=!1}removeInnerElementsFromPower(){const e=this.element.children;for(const t of e)this.removeElementAndInnersFromPower(t),this.element.removeChild(t);delete this.element.dataset.pwhascomp}removeElementAndInnersFromPower(e){(e=e||this.element).id&&this.ctx.allPowerObjsById[e.id]&&(this.ctx.removeEventsOfObject(e.id),delete this.ctx.allPowerObjsById[e.id]);const t=e.children;for(const e of t)this.removeElementAndInnersFromPower(e)}}class _PowerUiBase{constructor(){this._tempScope={}}_createPowerTree(){this.powerTree=new PowerTree(this,_PowerUiBase),this.powerTree._callInit()}}_PowerUiBase._powAttrsConfig=[],_PowerUiBase.injectPow=function(e){e.datasetKey=asDataSet(e.name),_PowerUiBase._powAttrsConfig.push(e)},_PowerUiBase._pwcAttrsConfig=[],_PowerUiBase.injectPwc=function(e){powAttr.datasetKey=asDataSet(powAttr.name),_PowerUiBase._pwcAttrsConfig.push(e)},_PowerUiBase._powerElementsConfig=[],_PowerUiBase.injectPowerCss=function(e){e.datasetKey=asDataSet(e.name),e.isMain?_PowerUiBase._powerElementsConfig.unshift(e):_PowerUiBase._powerElementsConfig.push(e)};const _Unique={n:0,next:()=>++_Unique.n,domID:e=>`_pow${e?"_"+e:"er"}_${_Unique.next()}`,scopeID:()=>`_scope_${_Unique.next()}`,last:()=>_Unique.n};class UEvent{constructor(e){this.observers=[],e&&(UEvent.index[e]=this)}subscribe(e,t){this.unsubscribe(e),this.observers.push({fn:e,ctx:t,arguments:arguments})}unsubscribe(e){this.observers=this.observers.filter(t=>t.fn!==e)}broadcast(){for(const e of this.observers)e.fn.apply(e.ctx,e.arguments)}popBroadcast(){if(this.observers.length>0){const e=this.observers[this.observers.length-1];e.fn.apply(e.ctx,e.arguments)}}}UEvent.index={};class _PowerBasicElement{constructor(e){this.tempEl=e,this._$pwActive=!1}get id(){return this.element.id||null}set id(e){this.element.id=e}get element(){return this.$shared?this.$shared.element:this.tempEl}get $pwMain(){return this.$shared?this.$shared.mainObj:null}get $pwView(){return this.$shared?this.$shared.viewObj:null}get parent(){return this.$shared?this.$shared.parentObj:null}get children(){return this._cachedChildren||this._getChildren()}_getChildren(){this._cachedChildren=[];const e=this.element;for(const t of e.children)if(t.className.includes("power-"))for(const e of Object.keys(this.$powerUi.powerTree.allPowerObjsById[t.id]||{}))e.startsWith("power")&&this._cachedChildren.push(this.$powerUi.powerTree.allPowerObjsById[t.id][e]);return this._cachedChildren}get innerPowerCss(){return this._cachedInnerPowerCss||this._getInnerPowerCss()}_getInnerPowerCss(){return this._cachedInnerPowerCss=this.$powerUi.powerTree._getAllInnerPowerCss(this.element),this._cachedInnerPowerCss}}class _PowerBasicElementWithEvents extends _PowerBasicElement{constructor(e){super(e),this._events={},this._DOMEvents={},this._events_fn={}}toggle(){this._$pwActive=!this._$pwActive,this.broadcast("toggle",!0)}subscribe({event:e,fn:t,useCapture:i=!0,...s}){this.unsubscribe({event:e,fn:t,useCapture:i,params:s});const n=this;this._events[e]||(this._events[e]=new UEvent(this.id),this._DOMEvents[e]||(this._DOMEvents[e]=new CustomEvent(e,{bubbles:i})),this._events_fn[e]=function(t){n._events[e].broadcast(n,t,s)},this.addEventListener(e,this._events_fn[e],i)),this._events[e].subscribe(t,n,s)}unsubscribe({event:e,fn:t,useCapture:i=!0,...s}){this._events[e]&&(this._events[e].unsubscribe(t),0===this._events[e].observers.length&&(delete this._events[e],this.removeEventListener(e,this._events_fn[e],i)))}broadcast(e,t){void 0!==document.body[e]||t?this._DOMEvents[e]&&this.element.dispatchEvent(this._DOMEvents[e]):(this._DOMEvents[e]&&this.element.dispatchEvent(this._DOMEvents[e]),this.dispatch(e))}dispatch(e){this[e]&&this[e]()}addEventListener(e,t,i=!1){this.element.addEventListener(e,t,i)}removeEventListener(e,t,i=!1){this.element&&this.element.removeEventListener(e,t,i)}getChildrenByPowerCss(e){return this.children.filter(t=>t.$powerCss===e)}getInnerByPowerCss(e){return this.innerPowerCss.filter(t=>t.$powerCss===e)}getInnerWithoutChildrenByPowerCss(e){return this.innerPowerCss.filter(t=>t.$powerCss===e&&t.parent.id!==this.id)}}class PowerTarget extends _PowerBasicElementWithEvents{constructor(e){super(e),this.powerTarget=!0}}class PowerTree{constructor(e,t){this.$powerUi=e,this.allPowerObjsById={},this.attrsConfig={};for(const e of _PowerUiBase._powAttrsConfig){e.callback(document.createElement("div")).compile&&(e.isCompiler=!0),this.attrsConfig[e.datasetKey]=e}for(const e of _PowerUiBase._pwcAttrsConfig){e.callback(document.createElement("div")).compile&&(e.isCompiler=!0),this.attrsConfig[e.datasetKey]=e}this.rootDatasetKeys=Object.keys(this.attrsConfig||{}).filter(e=>this.attrsConfig[e].isCompiler),this.mainDatasetKeys=this.getMainDatasetKeys(),this.buildAndInterpolate(document)}removeAllEvents(){for(const e of Object.keys(this.allPowerObjsById||{}))this.removeEventsOfObject(e);UEvent.index={}}removeEventsOfObject(e){for(const t of Object.keys(this.allPowerObjsById[e]||{}))if("$shared"!==t)for(const i of Object.keys(this.allPowerObjsById[e][t]._events))for(const s of this.allPowerObjsById[e][t]._events[i].observers)s.ctx.unsubscribe({event:i,fn:s.fn})}getMainDatasetKeys(){const e=[];for(const t of PowerUi._powerElementsConfig)t.isMain&&e.push(t.datasetKey);for(const t of Object.keys(this.attrsConfig||{}))this.attrsConfig[t].isMain&&e.push(this.attrsConfig[t].datasetKey);return e}datasetIsCompiler(e){for(const t of Object.keys(e||{}))if(this.rootDatasetKeys.includes(t))return!0;return!1}datasetIsMain(e){for(const t of Object.keys(e||{}))if(this.mainDatasetKeys.includes(t))return!0;return!1}buildAndInterpolate(e,t){if(this.sweepDOM({entryNode:e,callback:this.buildPowerObjects.bind(this),isInnerCompiler:!1}),!t){this.interpolateInOrder();const e=document.getElementsByTagName("BODY")[0];e.innerHTML=this.$powerUi.interpolation.replaceInterpolation(e.innerHTML,this.$powerUi)}}buildPowerObjects({currentNode:e,main:t,view:i,isInnerCompiler:s,saved:n,rootCompiler:r,parent:o}){let a=!1,l=[];s=s||!1;let c=o=o||!1;n=n||{pending:[]};const h=t=t||!1,d=i=i||!1;let u=!1,p=!1;if(e.dataset)for(const n of Object.keys(e.dataset||{}))for(const c of["pwc","pow"]){n.startsWith(c)&&(a=this._compile({currentNode:e,datasetKey:n,isInnerCompiler:s,view:i}),a&&!s&&(r=e,p=!0),this.attrsConfig[n]&&this.attrsConfig[n].isMain&&(t=e,u=!0),l.push({datasetKey:n,currentElement:e,main:h,view:d,rootCompiler:s?r:null,isMain:u,isRootCompiler:p,parent:o,originalInnerHTML:a}))}if(e.className&&e.className.includes("power-"))for(const n of PowerUi._powerElementsConfig)e.classList.contains(n.name)&&(n.isMain&&(t=e,u=!0),"powerView"===n.datasetKey&&(i=e),l.push({datasetKey:n.datasetKey,currentElement:e,main:h,view:d,rootCompiler:s?r:null,isMain:u,parent:o}),c={node:e,datasetKey:n.datasetKey});if(!!e.children&&!!e.children.length&&(a||s?this.sweepDOM({entryNode:e,callback:this.buildPowerObjects.bind(this),isInnerCompiler:!0,main:t,view:i,rootCompiler:r,saved:n,parent:c}):this.sweepDOM({entryNode:e,callback:this.buildPowerObjects.bind(this),isInnerCompiler:!1,main:t,view:i,rootCompiler:r,saved:n,parent:c})),a&&!s){e.innerHTML=this.$powerUi.interpolation.compile({template:e.innerHTML,view:i});for(const e of n.pending)this._instanciateObj(e);n.pending=[]}if(l.length>0&&!a||a&&!s){for(const e of l)this._instanciateObj(e);l=[]}else for(const e of l)n.pending.push(e)}getEntryNodeWithParentsAndConfig(e){const t=document.getElementById(e),i=this._getParentElementFromChildElement(t),s=this._getMainElementFromChildElement(t),n=this.datasetIsMain(t.dataset),r=this._getViewElementFromChildElement(t),o=this._getRootCompilerElementFromChildElement(t,this);return{currentNode:t,parent:i,main:s,isMain:n,view:r,isInnerCompiler:o&&this.datasetIsCompiler(t.dataset),rootCompiler:o}}interpolateInOrder(){const e=document.getElementsByClassName("power-view");let t=!1;for(const i of e)if("root-view"===i.id)t=i;else if("secundary-view"!==i.id){const e=this.$powerUi.controllers[i.id]?this.$powerUi.controllers[i.id].instance:this.$powerUi;i.innerHTML=this.$powerUi.interpolation.replaceInterpolation(i.innerHTML,e)}if(t){const e=this.$powerUi.controllers[t.id]?this.$powerUi.controllers[t.id].instance:this.$powerUi;t.innerHTML=this.$powerUi.interpolation.replaceInterpolation(t.innerHTML,e)}}createAndInitObjectsFromCurrentNode({id:e}){const t=this.getEntryNodeWithParentsAndConfig(e);this.buildPowerObjects(t);const i=document.getElementById(e),s=this.$powerUi.controllers[i.id]?this.$powerUi.controllers[i.id].instance:this.$powerUi;i.innerHTML=this.$powerUi.interpolation.replaceInterpolation(i.innerHTML,s),this._callInitForObjectAndInners(document.getElementById(e))}_compile({currentNode:e,datasetKey:t,isInnerCompiler:i,view:s}){let n=!1;if(this.attrsConfig[t]&&this.attrsConfig[t].isCompiler&&!0==!e.getAttribute("data-pwhascomp")){const r=getIdAndCreateIfDontHave(e),o=this.attrsConfig[t].callback(e);o.id=r,o.$powerUi=this.$powerUi,n=!!i||(e.innerHTML||!0),o.compile({view:s}),o.element.setAttribute("data-pwhascomp",!0)}return n}_instanciateObj({currentElement:e,datasetKey:t,main:i,view:s,rootCompiler:n,isMain:r,isRootCompiler:o,parent:a,originalInnerHTML:l}){const c=getIdAndCreateIfDontHave(e),h=this.$powerUi[`_${t}`]?`_${t}`:"powerAttrs";let d;if("powerAttrs"===h){if(!this.attrsConfig[t])return;d=this.attrsConfig[t].callback(document.getElementById(c))}else d=this.$powerUi[h](document.getElementById(c));d.isMain=r||null,d.isRootCompiler=o||null,d.originalInnerHTML=l&&!0!==l?l:"",this._addToObjectsById({powerObject:d,id:c,datasetKey:t,main:i,view:s,rootCompiler:n,parent:a})}_addToObjectsById({powerObject:e,id:t,datasetKey:i,main:s,view:n,rootCompiler:r,parent:o}){if(this.allPowerObjsById[t]){const e=document.querySelectorAll(`[id=${t}]`);if(e.length>1)throw console.error("DUPLICATED IDs:",e),`HTML element can't have duplicated IDs: ${t}`}else this.allPowerObjsById[t]={};this.allPowerObjsById[t][i]||(this.allPowerObjsById[t][i]={}),this.allPowerObjsById[t][i]=e,this.allPowerObjsById[t][i].id=t,this.allPowerObjsById[t][i].datasetKey=i,this.allPowerObjsById[t][i].$powerCss=i,this.allPowerObjsById[t][i].$powerUi=this.$powerUi,this.allPowerObjsById[t].$shared||(this.allPowerObjsById[t].$shared=new SharedScope({id:t,main:s,view:n,rootCompiler:r,parent:o,ctx:this})),e.isRootCompiler&&(this.allPowerObjsById[t].$shared.isRootCompiler=e.isRootCompiler,this.allPowerObjsById[t].$shared.originalInnerHTML=e.originalInnerHTML),this.allPowerObjsById[t][i].$shared=this.allPowerObjsById[t].$shared}sweepDOM({entryNode:e,callback:t,isInnerCompiler:i,main:s,view:n,rootCompiler:r,saved:o,parent:a}){const l=!!e&&!!e.nodeType,c=!!e.children&&!!e.children.length;if(l&&c){e.children;for(const l of e.children)t({currentNode:l,callback:t,isInnerCompiler:i,main:s,view:n,rootCompiler:r,saved:o,parent:a})}else t({currentNode:e,callback:t,isInnerCompiler:i,main:s,view:n,rootCompiler:r,saved:o,parent:a})}_getAllInnerPowerCss(e){const t=[];for(const i of _PowerUiBase._powerElementsConfig){const s=e.getElementsByClassName(i.name);for(const e of s){const s=this.allPowerObjsById[e.id][i.datasetKey];t.push(s)}}return t}_getParentElementFromChildElement(e){const t=PowerTree._searchUpDOM(e,PowerTree._checkIfhavePowerParentElement);if(t.conditionResult)return t.powerElement}_getMainElementFromChildElement(e){const t=PowerTree._searchUpDOM(e,this._checkIfIsMainElement);if(t.conditionResult)return t.powerElement}_getViewElementFromChildElement(e){const t=PowerTree._searchUpDOM(e,this._checkIfIsViewElement);if(t.conditionResult)return t.powerElement}_getRootCompilerElementFromChildElement(e,t){const i=PowerTree._searchUpDOM(e,this._checkIfIsCompilerElement,t);if(i.conditionResult)return i.powerElement}_checkIfIsCompilerElement(e,t){let i=!1;return e&&e.dataset&&t.datasetIsCompiler(e.dataset)&&(i=!0),i}_checkIfIsMainElement(e){let t=!1;if(e&&e.className)for(const i of PowerUi._powerElementsConfig.filter(e=>!0===e.isMain))if(e.classList.contains(i.name)){t=!0;break}return t}_checkIfIsViewElement(e){return e&&e.className&&e.classList.contains("power-view")}_callInit(){for(const e of Object.keys(this.allPowerObjsById||{}))this._callInitOfObject(e)}_callInitOfObject(e){for(const t of Object.keys(this.allPowerObjsById[e]||{}))this.allPowerObjsById[e][t].init&&this.allPowerObjsById[e][t].init()}_callInitForObjectAndInners(e){e.id&&this._callInitOfObject(e.id);const t=e?e.children:[];for(const e of t)this._callInitForObjectAndInners(e)}}PowerTree._searchUpDOM=function(e,t,i){let s=e.className.includes("power-")?e:null,n=e.parentElement,r=!1,o=!n;for(;!o;)r=t(n,i),r&&(o=!0),n.className.includes("power-")&&(s=n),n.parentElement&&!o?n=n.parentElement:o=!0;return{powerElement:s,conditionResult:r}},PowerTree._checkIfhavePowerParentElement=function(e){let t=!1;return e.className.includes("power-")&&(t=!0),t};class _pwBasicHover extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1}init(){this.$_pwDefaultValue||(this.$_pwDefaultValue=this.element[this.$_target]),this.$_pwHoverValue||(this.$_pwHoverValue=this.element.getAttribute(this.$_pwAttrName)||""),this.subscribe({event:"mouseover",fn:this.mouseover}),this.subscribe({event:"mouseout",fn:this.mouseout})}mouseover(){this._$pwActive||(this.element[this.$_target]=this.$_pwHoverValue,this.toggle(),this.$shared._priorityActive=!0)}mouseout(e){this._$pwActive&&(this.element[this.$_target]=this.$_pwDefaultValue||"",this.toggle(),this.$shared._priorityActive=!1)}}class _pwMainBasicHover extends _pwBasicHover{constructor(e,t,i){super(e,t,i)}mouseover(){this._$pwActive||this.$shared._priorityActive||(this.element[this.$_target]=this.$_pwHoverValue,this.toggle())}mouseout(){this._$pwActive&&(this.element[this.$_target]=this.$_pwDefaultValue||"",this.toggle())}addEventListener(e,t,i){this.$pwMain.subscribe({event:e,fn:t,useCapture:i})}removeEventListener(e,t,i){this.$pwMain.unsubscribe({event:e,fn:t,useCapture:i})}}class PowCssHover extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1,this.$_pwAttrName="data-pow-css-hover"}init(){this.$_pwHoverValues||(this.$_pwHoverValues=this.element.getAttribute(this.$_pwAttrName).split(" ")||[]),this.subscribe({event:"mouseover",fn:this.mouseover}),this.subscribe({event:"mouseout",fn:this.mouseout})}mouseover(){if(!this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle(),this.$shared._priorityActive=!0}}mouseout(){if(this._$pwActive){for(const e of this.$_pwHoverValues)this.element.classList.remove(e);this.toggle(),this.$shared._priorityActive=!1}}}_PowerUiBase.injectPow({name:"data-pow-css-hover",callback:function(e){return new PowCssHover(e)}});class PowMainCssHover extends PowCssHover{constructor(e){super(e),this.$_pwAttrName="data-pow-main-css-hover"}mouseover(){if(!this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle()}}mouseout(){if(this._$pwActive){this.toggle();for(const e of this.$_pwHoverValues)this.element.classList.remove(e)}}addEventListener(e,t,i){this.$pwMain.subscribe({event:e,fn:t,useCapture:i})}removeEventListener(e,t,i){this.$pwMain.unsubscribe({event:e,fn:t,useCapture:i})}}_PowerUiBase.injectPow({name:"data-pow-main-css-hover",isMain:!0,callback:function(e){return new PowMainCssHover(e)}});class PowSrcHover extends _pwBasicHover{constructor(e){super(e),this.$_pwAttrName="data-pow-src-hover",this.$_target="src"}}_PowerUiBase.injectPow({name:"data-pow-src-hover",callback:function(e){return new PowSrcHover(e)}});class PowMainSrcHover extends _pwMainBasicHover{constructor(e){super(e),this.$_pwAttrName="data-pow-main-src-hover",this.$_target="src"}}_PowerUiBase.injectPow({name:"data-pow-main-src-hover",isMain:!0,callback:function(e){return new PowMainSrcHover(e)}});class PowCssHoverRemove extends PowCssHover{constructor(e){super(e),this.$_pwAttrName="data-pow-css-hover-remove"}mouseover(){if(!this._$pwActive){for(const e of this.$_pwHoverValues)this.element.classList.remove(e);this.toggle(),this.$shared._priorityActive=!0}}mouseout(){if(this._$pwActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle(),this.$shared._priorityActive=!1}}}_PowerUiBase.injectPow({name:"data-pow-css-hover-remove",callback:function(e){return new PowCssHoverRemove(e)}});class PowMainCssHoverRemove extends PowMainCssHover{constructor(e){super(e),this.$_pwAttrName="data-pow-main-css-hover-remove"}mouseover(){if(!this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.remove(e);this.toggle()}}mouseout(){if(this._$pwActive&&!this.$shared._priorityActive){for(const e of this.$_pwHoverValues)this.element.classList.add(e);this.toggle()}}}function othersInit(e){e.element.value=e.currentValue,e.subscribe({event:"change",fn:e.onchange})}function othersChange(e){e.currentValue=e.element.value}function checkboxInit(e){const t=e.element;!0===e.currentValue?t.checked="checked":delete t.checked,e.subscribe({event:"change",fn:e.onchange})}function checkboxChange(e){e.currentValue=!e.currentValue}function radioInit(e){const t=e.element;e.currentValue===t.value?t.checked=!0:t.checked=!1,e.subscribe({event:"change",fn:e.onchange})}function radioChange(e){!0===e.element.checked&&(e.currentValue=e.element.value)}function selectMultipleInit(e){const t=e.element;for(const i of t.children)e.currentValue.includes(i.value)?i.selected=!0:i.selected=!1;e.subscribe({event:"change",fn:e.onchange})}function selectOneInit(e){const t=e.element;for(const i of t.children)e.currentValue===i.value?i.selected=!0:i.selected=!1;e.subscribe({event:"change",fn:e.onchange})}function selectMultipleChange(e){const t=e.element;for(const i of t.children)if(i.selected)e.currentValue.includes(i.value)||e.currentValue.push(i.value);else{const t=e.currentValue.indexOf(i.value);t>-1&&e.currentValue.splice(t,1)}}_PowerUiBase.injectPow({name:"data-pow-main-css-hover-remove",isMain:!0,callback:function(e){return new PowMainCssHoverRemove(e)}});class PowBind extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1,this.originalHTML=e.innerHTML}init(){const e=this.$pwView;this.ctrlScope=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance,this.type=this.element.type,"checkbox"===this.type?checkboxInit(this):"radio"===this.type?radioInit(this):"select-one"===this.type?selectOneInit(this):"select-multiple"===this.type?selectMultipleInit(this):othersInit(this)}onchange(e){"checkbox"===this.type?checkboxChange(this):"radio"===this.type?radioChange(this):"select-multiple"===this.type?selectMultipleChange(this):othersChange(this)}get currentValue(){return this.$powerUi.safeEval({text:this.$powerUi.interpolation.decodeHtml(this.element.dataset.powBind),$powerUi:this.$powerUi,scope:this.ctrlScope})}set currentValue(e){this.$powerUi.setValueOnScope({text:this.$powerUi.interpolation.decodeHtml(this.element.dataset.powBind),$powerUi:this.$powerUi,scope:this.ctrlScope,valueToSet:e})}}_PowerUiBase.injectPow({name:"data-pow-bind",callback:function(e){return new PowBind(e)}});class PowEval extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1}compile({view:e}){const t=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;this.element.innerHTML=this.$powerUi.interpolation.getDatasetResult(this.element.dataset.powEval,t)}}_PowerUiBase.injectPow({name:"data-pow-eval",callback:function(e){return new PowEval(e)}});class PowEvent extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1}compile({view:e}){!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;for(const t of this.element.attributes)if(t.name.includes("on")&&!t.name.includes("data")){const i=t.name.slice(2,t.name.length);this.element.setAttribute(`data-pow-${i}`,this.$powerUi.interpolation.encodeHtml(t.value)),t.value=`window._$dispatchPowerEvent(event, this, '${e.id}', '${i}')`}}}_PowerUiBase.injectPow({name:"data-pow-event",callback:function(e){return new PowEvent(e)}});class PowFor extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1,this._pwEvaluateValue=""}compile({view:e}){if(!this.element.dataset.powFor)return;const t=this.$powerUi.interpolation.decodeHtml(this.element.dataset.powFor).split(" "),i=`\\b(${t[0]})\\b`,s=t[1];t.shift(),t.shift();let n=t.join(" ");const r=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;n=this.$powerUi.safeEval({text:n,$powerUi:this.$powerUi,scope:r}),"of"===s?this.forOf(i,n):this.forIn(i,n)}forOf(e,t){let i="",s=0;for(const n of t||[]){const t=_Unique.scopeID();let r=this.$powerUi.interpolation.replaceWith({entry:this.element.innerHTML,oldValue:"\\$pwIndex",newValue:s});s+=1,this.$powerUi._tempScope[t]=n,i+=this.$powerUi.interpolation.replaceWith({entry:r,oldValue:e,newValue:this.$powerUi.interpolation.encodeHtml(`_tempScope['${t}']`)})}this.element.innerHTML=i}forIn(e,t){let i="",s=0;for(const n of Object.keys(t||{})){const r=_Unique.scopeID();let o=this.$powerUi.interpolation.replaceWith({entry:this.element.innerHTML,oldValue:"\\$pwKey",newValue:`'${n}'`});o=this.$powerUi.interpolation.replaceWith({entry:o,oldValue:"\\$pwIndex",newValue:s}),s+=1,this.$powerUi._tempScope[r]=t[n],i+=this.$powerUi.interpolation.replaceWith({entry:o,oldValue:e,newValue:this.$powerUi.interpolation.encodeHtml(`_tempScope['${r}']`)})}this.element.innerHTML=i}}_PowerUiBase.injectPow({name:"data-pow-for",callback:function(e){return new PowFor(e)}});class PowIf extends _PowerBasicElementWithEvents{constructor(e){super(e),this._$pwActive=!1,this.originalHTML=e.innerHTML}compile({view:e}){const t=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance;!1===this.$powerUi.safeEval({text:this.$powerUi.interpolation.decodeHtml(this.element.dataset.powIf),$powerUi:this.$powerUi,scope:t})?(this.element.style.display="none",this.element.innerHTML=""):(this.element.style.display=null,this.element.innerHTML=this.originalHTML)}}function defineInnerDropmenusPosition(e,t){["right-bottom","bottom-right","bottom","right"].includes(e.defaultPosition)?t.defaultPosition="right-bottom":["left-bottom","bottom-left","left"].includes(e.defaultPosition)?t.defaultPosition="left-bottom":["right-top","top-right","top","right"].includes(e.defaultPosition)?t.defaultPosition="right-top":["left-top","top-left"].includes(e.defaultPosition)?t.defaultPosition="left-top":t.defaultPosition="right-bottom"}function defineRootDropmenusPosition(e,t){["right-bottom","bottom-right","left-bottom","bottom-left","right-top","top-right","left-top","top-left"].includes(e.defaultPosition)?t.defaultPosition=e.defaultPosition:"top"===e.defaultPosition?t.defaultPosition="top-right":"bottom"===e.defaultPosition?t.defaultPosition="bottom-right":"right"===e.defaultPosition?t.defaultPosition="bottom-right":"left"===e.defaultPosition?t.defaultPosition="bottom-left":e.element.classList.contains("power-horizontal")?e.defaultPosition="bottom-right":e.defaultPosition="right-bottom"}_PowerUiBase.injectPow({name:"data-pow-if",callback:function(e){return new PowIf(e)}});class watchInputUntilThen{constructor(e,t,i){this.element=e,this.condition=t,this.than=i,this.whatch()}whatch(){const e=this;e.interval=setInterval((function(){e.condition(e.element)&&(e.than(e.element),clearInterval(e.interval))}),300)}}class KeyboardManager{constructor(e){document.onkeydown=this.checkKey.bind(this),document.onkeyup=this.checkKey.bind(this),this.$powerUi=e,this.keyModeIsOn=!1}getRootElements(){return this.$powerUi.powerTree.rootElements}setKeyModeOn(){if(!1===this.keyModeIsOn){this.keyModeIsOn=!0,this.createBackDrop();for(const e of this.getRootElements()){"static"===getComputedStyle(e.element).position&&e.element.classList.add("power-keyboard-position"),e.element.classList.add("power-keyboard-mode")}console.log("Keyboard mode ON")}}createBackDrop(){this.backdrop=document.createElement("DIV"),this.backdrop.classList.add("power-keyboard-backdrop"),document.body.appendChild(this.backdrop)}removeBackdrop(){document.body.removeChild(this.backdrop)}setKeyModeOff(){if(this.keyModeIsOn){this.removeBackdrop(),this._17=!1,this._48=!1,this._96=!1,this.keyModeIsOn=!1,console.log("Keyboard mode OFF");for(const e of this.getRootElements())e.element.classList.remove("power-keyboard-mode"),e.element.classList.remove("power-keyboard-position")}}checkKey(e){27===(e=e||window.event).keyCode&&this.setKeyModeOff(),"keydown"===e.type?this[`_${e.keyCode}`]=!0:this[`_${e.keyCode}`]=!1,this._17&&(this._48||this._96)&&this.setKeyModeOn()}}class PowerUi extends _PowerUiBase{constructor(e){if(super(),e.devMode&&window.addEventListener("message",t=>{if(t.origin.startsWith(e.devMode.main)||t.origin.startsWith(e.devMode.iframe)){if(!0===t.data.click&&t.data.id){this.getCurrentElementCtrl(document.getElementById(t.data.id)).windowsOrder()}if(window.location.href.startsWith(e.devMode.iframe))if("addInnerHTML"===t.data.command){const e=document.getElementById(t.data.id);e.innerHTML=e.innerHTML+t.data.value}else if("replaceInnerHTML"===t.data.command){document.getElementById(t.data.id).innerHTML=t.data.value}else if("addClassList"===t.data.command){document.getElementById(t.data.id).classList.add(t.data.value)}else if("removeClassList"===t.data.command){document.getElementById(t.data.id).classList.remove(t.data.value)}}else console.log("DANGER",t.origin)}),window._$dispatchPowerEvent=this._$dispatchPowerEvent,this.controllers={$routeSharedScope:{$waitingToDelete:[]}},this.JSONById={},this._Unique=_Unique,this.addScopeEventListener(),this.numberOfopenModals=0,this.ctrlWaitingToRun=[],this.config=e,this.waitingViews=0,this.waitingInit=[],this.initAlreadyRun=!1,this._services=e.services||{},this._addPowerServices(),this.interpolation=new PowerInterpolation(e,this),this._events={},this._events.ready=new UEvent,this._events.Escape=new UEvent,this.request=new Request({config:e,$powerUi:this}),e.$root){const t="root-view",i="$root",s=new e.$root.component({$powerUi:this,viewId:t,routeId:i}),n=s.component,r=this;s.template.then((function(s){r.loadRootScope({viewId:t,routeId:i,$root:e.$root,crtlInstance:n,template:s}),r.bootstrap(e)})).catch((function(e){console.log("error",e)}))}else this.bootstrap(e)}bootstrap(e){this.router=new Router(e,this),document.addEventListener("keyup",this._keyUp.bind(this),!1)}loadRootScope({viewId:e,routeId:t,$root:i,crtlInstance:s,template:n}){this.controllers[e]={component:i.component,params:i.params},this.controllers[e].instance=s,this.controllers[e].instance._viewId=e,this.controllers[e].instance._routeId=t;const r=this.prepareViewToLoad({viewId:e,routeId:t});this.buildViewTemplateAndMayCallInit({self:this,view:r,template:n,routeId:t,viewId:e,title:null}),this.registerRootTemplate({template:n,ctrl:s,viewId:e,view:document.getElementById(e)})}registerRootTemplate({template:e,ctrl:t,viewId:i,view:s}){this._rootScope={routeId:"#root",template:e,ctrl:t,viewId:i,view:s,title:null}}getCurrentElementCtrl(e){return e.classList&&e.classList.contains("power-view")&&this.controllers[e.id]?this.controllers[e.id].instance:e.parentNode?this.getCurrentElementCtrl(e.parentNode):null}treeTemplate(e){return new PowerTreeTemplate({$powerUi:this,tree:e}).template}treeTemplatePlus(e){return new PowerTreeTemplate({$powerUi:this,tree:e,boilerplate:!0}).template}getCookie(e){const t=e+"=",i=document.cookie.split(";");for(var s=0;s<i.length;s++){for(var n=i[s];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null}setCookie({name:e,value:t,days:i,domain:s,path:n}){var r="";if(i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3),r=";expires="+o.toUTCString()}document.cookie=e+"="+(t||"")+r+`;${s?"domain="+s+";":""}path=${n||"/"};`}removeCookie({name:e,value:t,domain:i,path:s}){document.cookie=`${e}=${t||""};${i?"domain="+i+";":""}Max-Age=-99999999;path=${s||"/"};`}_addService(e,t){this._services[e]=t}_addPowerServices(){this._addService("widget",{component:WidgetService}),this._addService("JSONSchema",{component:JSONSchemaService})}_$dispatchPowerEvent(e,t,i,s){document.dispatchEvent(new CustomEvent("pwScope",{detail:{viewId:i,elementId:t.id,attrName:s,event:e}}))}_keyUp(e){"Escape"!=e.key&&27!=e.keyCode||this._events.Escape.popBroadcast()}addScopeEventListener(){document.removeEventListener("pwScope",this.pwScope.bind(this),!1),document.addEventListener("pwScope",this.pwScope.bind(this),!1)}pwScope(e){const t=this,i=!!(e&&e.detail&&e.detail.viewId&&t.controllers[e.detail.viewId])&&t.controllers[e.detail.viewId].instance;if(!1===i)return;i.event=e.detail.event;const s=!!(e&&e.detail&&e.detail.elementId)&&document.getElementById(e.detail.elementId),n=!!(e&&e.detail&&e.detail.attrName)&&`data-pow-${e.detail.attrName}`,r=!(!s||!n)&&this.interpolation.decodeHtml(s.getAttribute(n));r&&t.safeEval({text:r,$powerUi:t,scope:i})}safeEval({text:e,scope:t}){return new ParserEval({text:e,scope:t,$powerUi:this}).currentValue}setValueOnScope({text:e,scope:t,valueToSet:i}){new ParserEval({text:e,scope:t,$powerUi:this,valueToSet:i})}getObjectOnScope({text:e,scope:t}){return new ParserEval({text:e,scope:t,$powerUi:this}).currentValue}initAll({template:e,routeId:t,viewId:i}){performance.now();this.initAlreadyRun&&this.powerTree.removeAllEvents(),this._createPowerTree(),this.truth={},this.tmp={dropmenu:{}},this.touchdevice=!!(navigator.maxTouchPoints||"ontouchstart"in document.documentElement),this.touchdevice||(this.keyboardManager=new KeyboardManager(this)),this.initAlreadyRun=!0;for(const e of this.waitingInit)document.getElementById(e.node.id).style.visibility=null;this.waitingInit=[];for(const e of Object.keys(this.controllers||{}))"$routeSharedScope"!==e&&this.callOnViewLoad(this,e);performance.now()}callOnViewLoad(e,t){e.controllers[t]&&e.controllers[t].instance&&(e.controllers[t].instance.onViewLoad&&e.controllers[t].instance.onViewLoad(e.powerTree.allPowerObjsById[t].$shared.element),e.controllers[t].instance._onViewLoad&&e.controllers[t].instance._onViewLoad(e.powerTree.allPowerObjsById[t].$shared.element))}initNodes({template:e,routeId:t,viewId:i,refreshing:s}){performance.now();for(const e of this.waitingInit)this.powerTree.createAndInitObjectsFromCurrentNode({id:e.node.id}),document.getElementById(e.node.id).style.visibility=null,this.callOnViewLoad(this,e.node.id);performance.now();this.waitingInit=[]}prepareViewToLoad({viewId:e,routeId:t}){const i=document.getElementById(e);return this.addSpinnerAndHideView(i),this.waitingInit.push({node:i,viewId:e}),i}addSpinner(e){const t=document.getElementById(e);this.addSpinnerAndHideView(t,!0)}removeSpinner(e){const t=document.getElementById("_power-spinner");if(t.parentNode.removeChild(t),e){document.getElementById(e).style.visibility=null}}addSpinnerAndHideView(e,t){if(!document.getElementById("_power-spinner")){const e=document.createElement("div");e.classList.add("pw-spinner-backdrop"),e.id="_power-spinner";const t=document.createElement("p");t.classList.add("pw-spinner-label"),t.innerText=this.config.spinnerLabel||"LOADING",e.appendChild(t);const i=document.createElement("div");i.classList.add("pw-spinner"),e.appendChild(i),document.body.appendChild(e)}e&&(e.style.visibility="hidden",t||(this.waitingViews=this.waitingViews+1))}runRouteController(){let e=1;for(const t of this.ctrlWaitingToRun)e+=1,this.controllers[t.viewId]&&this.controllers[t.viewId].instance&&this.controllers[t.viewId].instance.ctrl(this.controllers[t.viewId].params);this.ctrlWaitingToRun=[]}loadTemplateUrl({template:e,viewId:t,currentRoutes:i,routeId:s,routes:n,title:r}){const o=this,a=this.prepareViewToLoad({viewId:t,routeId:s});this.request({url:e,method:"GET",status:"Loading page",withCredentials:!1}).then((function(i,l){e=l.responseText,o.buildViewTemplateAndMayCallInit({self:o,view:a,template:e,routeId:s,viewId:t,title:r});const c=n[s];!0!==c.avoidCacheTemplate?(c.template=l.responseText,c.templateIsCached=!0):c.templateIsCached=!1})).catch((function(e,i){o.ifNotWaitingServerCallInit({template:e,routeId:s,viewId:t})}))}loadTemplateComponent({template:e,viewId:t,currentRoutes:i,routeId:s,routes:n,title:r,$ctrl:o}){const a=this,l=this.prepareViewToLoad({viewId:t,routeId:s}),c=new e({$powerUi:this,viewId:t,routeId:s,$ctrl:o});o.$tscope=c.component,n[s].$tscope=c.component,c.template.then((function(i){e=i,a.buildViewTemplateAndMayCallInit({self:a,view:l,template:e,routeId:s,viewId:t,title:r});const o=n[s];!0!==o.avoidCacheTemplate?(o.template=e,o.templateIsCached=!0):o.templateIsCached=!1})).catch((function(e,i){a.ifNotWaitingServerCallInit({template:e,routeId:s,viewId:t})}))}loadTemplate({template:e,viewId:t,currentRoutes:i,routeId:s,routes:n,title:r}){const o=this.prepareViewToLoad({viewId:t,routeId:s});n[s].$tscope&&(this.controllers[t].instance.$tscope=n[s].$tscope),this.buildViewTemplateAndMayCallInit({self:this,view:o,template:e,routeId:s,viewId:t,title:r})}buildViewTemplateAndMayCallInit({self:e,view:t,template:i,routeId:s,viewId:n,title:r,refreshing:o,reloadCtrl:a,initAll:l}){e.controllers[n]&&e.controllers[n].instance&&e.controllers[n].instance.isWidget&&(!o&&e.controllers[n].instance.init&&e.controllers[n].instance.init(),i=e.controllers[n].instance.$buildTemplate({template:i,title:r})),t.innerHTML=i,e.ifNotWaitingServerCallInit({template:i,routeId:s,viewId:n,refreshing:o,reloadCtrl:a,initAll:l})}ifNotWaitingServerCallInit({template:e,routeId:t,viewId:i,refreshing:s,reloadCtrl:n,initAll:r}){const o=this;(!s||s&&n)&&o.ctrlWaitingToRun.push({viewId:i,routeId:t}),setTimeout((function(){o.waitingViews=o.waitingViews-1,0===o.waitingViews&&((!s||s&&n)&&o.runRouteController(),o.initAlreadyRun&&!r?o.initNodes({template:e,routeId:t,viewId:i,refreshing:s}):o.initAll({template:e,routeId:t,viewId:i}),o.removeSpinner(),o._events.ready.broadcast("ready"))}),10)}removeCss(e,t){document.getElementById(e).classList.remove(t)}addCss(e,t){document.getElementById(e).classList.add(t)}onFormError({id:e,msg:t}){const i=document.getElementById(e),s=i.parentNode;s.classList.add("pw-has-error");const n=s.getElementsByClassName("pw-control-helper")||null,r=n?n[0]:null;r&&(r.innerText=t);const o=i.value;new watchInputUntilThen(i,(function(e){let t=!1;return e.value!==o&&(t=!0),t}),(function(e){s&&s.classList.remove("pw-has-error"),r&&(r.innerText="")}))}sanitizeHTML(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}_powerView(e){return new PowerView(e,this)}_powerMenu(e){return new PowerMenu(e,this)}_powerMain(e){return new PowerMain(e,this)}_powerBrand(e){return new PowerBrand(e,this)}_powerItem(e){return new PowerItem(e,this)}_powerAccordion(e){return new PowerAccordion(e,this)}_powerAccordionSection(e){return new PowerAccordionSection(e,this)}_powerTabs(e){return new PowerTabs(e,this)}_powerTabSection(e){return new PowerTabSection(e,this)}_powerList(e){return new PowerList(e,this)}_powerAction(e){return new PowerAction(e,this)}_powerToggle(e){return new PowerToggle(e,this)}_powerDropmenu(e){return new PowerDropmenu(e,this)}_powerTreeView(e){return new PowerTreeView(e,this)}_powerStatus(e){return new PowerStatus(e,this)}_powerBasicElement(e){return new _PowerBasicElement(e,this)}_offsetComputedStyles(e){return parseInt(e.left.split("px")[0]||0)+parseInt(e["margin-left"].split("px")[0]||0)+parseInt(e["border-left-width"].split("px")[0]||0)}_offsetComputedRootElementStyles(e){return parseInt(e["margin-left"].split("px")[0]||0)}}export{PowerUi};class PowerScope{constructor({$powerUi:e}){this.$powerUi=e,this._servicesInstances={}}$service(e){return this._servicesInstances[e]?this._servicesInstances[e]:(this._servicesInstances[e]=new this.$powerUi._services[e].component({$powerUi:this.$powerUi,$ctrl:this,params:this.$powerUi._services[e].params}),this._servicesInstances[e])}}export{PowerScope};class PowerServices{constructor({$powerUi:e,$ctrl:t}){this.$powerUi=e,this.$ctrl=t}}class JSONSchemaService extends PowerServices{constructor({$powerUi:e,$ctrl:t}){super({$powerUi:e,$ctrl:t})}cloneObject(e){if("object"==typeof e&&void 0!==e.length){const t=[];for(const i of e)"object"==typeof i?t.push(this.cloneObject(i)):t.push(i);return t}{const t={};for(const i of Object.keys(e))if("object"==typeof e[i]&&void 0!==e[i].length){t[i]=[];for(const s of e[i])"object"==typeof s?t[i].push(this.cloneObject(s)):t[i].push(s)}else if("object"==typeof e[i]){t[i]={};const s=e[i];for(const e of Object.keys(s))"object"==typeof s[e]?t[i][e]=this.cloneObject(s[e]):t[i][e]=s[e]}else t[i]=e[i];return t}}overwriteJSON(e,t){for(const i of Object.keys(t))if(e[i])if("object"==typeof t[i]&&void 0!==t[i].length){let s=0;for(const n of t[i])void 0===e[i][s]?e[i].push(n):e[i][s]="object"==typeof n?this.overwriteJSON(e[i][s],n):n,s+=1}else if("object"==typeof t[i]){const s=t[i];for(const t of Object.keys(s))"object"==typeof s[t]&&void 0!==e[i][t]?e[i][t]=this.overwriteJSON(e[i][t],s[t]):e[i][t]=s[t]}else e[i]=t[i];else e[i]=t[i];return e}registerJSONById(e){this.$powerUi.JSONById[e.$id]||(this.$powerUi.JSONById[e.$id]=e)}getNewJSON(e){const t=this.cloneObject(this.$powerUi.JSONById[e.$ref]);delete t.$id;const i=this.overwriteJSON(t,e);return delete i.$ref,i}validateType(e,t){return typeof t===e||("array"===e&&void 0!==t.length||("any"===e||(void 0!==e.length&&t.length,window.console.log(`JSON type expected to be "${e}" but is "${typeof t}"`,t),!1)))}especialRequired(e,t){const i={html:!0,button:!0,item:!0,status:!0,icon:!0,menu:!0,dropmenu:!0,dropmenubutton:!0,simpleform:!0,tree:!0,accordion:!0,grid:!0};for(const s of Object.keys(e))if(i[s]&&"object"==typeof e[s]&&t===s)return!0}_validateEvents(e,t,i){for(const s of e)if(!1===this._validate(this.gridDef().properties.events,s))return window.console.log(`Failed JSON ${i} event:`,s,e,t),`Failed JSON ${i} event!`;return!0}_validate(e,t){for(const i of Object.keys(e.properties||{}))if(e.properties[i].type&&void 0!==t[i]&&!1===this.validateType(e.properties[i].type,t[i]))return!1;if(e.required)for(const i of e.required)if(!this.especialRequired(t,i)&&!t[i])return window.console.log(`JSON missing required property: "${i}"`,t),!1;return!0}_getEventTmpl(e){if(e){let t="";for(const i of e)t=`${t} ${i.event}="${i.fn}" `;return t=`data-pow-event ${t}`,t}return""}_getIdTmpl(e,t){return e?`id="${e}"`:t?`id="${t}_${this.$powerUi._Unique.next()}"`:""}_getAttrTmpl(e){let t="";if(e)for(const i of e)t=void 0!==i.value?`${t} ${i.name}="${i.value}"`:`${t} ${i.name}`;return t}_getClassTmpl(e){let t="";if(e){for(const i of e)t=t?`${t} ${i}`:i;return`class="${t}"`}return t}_getHtmlBasicTmpl(e,t){return`${this._getIdTmpl(e.id,t)} ${this._getClassTmpl(e.classList)} ${this._getAttrTmpl(e.attrs)} ${this._getEventTmpl(e.events)}${e.title?' title="'+e.title+'"':""}${e.for?' for="'+e.for+'"':""}${e.src?' src="'+e.src+'"':""}${e.cols?' cols="'+e.cols+'"':""}${e.rows?' rows="'+e.rows+'"':""}${e.width?' width="'+e.width+'"':""}${e.height?' height="'+e.height+'"':""}${!0===e.disabled?" disabled":""}${!0===e.selected?" selected":""}${e.bind?' data-pow-bind="'+e.bind+'"':""}${e.value?' value="'+e.value+'"':""}${e.name?' name="'+e.name+'"':""}${e.required?" required":""}`}_getHtmlMoreBasicTmpl(e,t){return`${this._getIdTmpl(e.id,t)} ${this._getClassTmpl(e.classList)} ${this._getAttrTmpl(e.attrs)} ${this._getEventTmpl(e.events)}`}_getInputBasicTmpl(e,t){return`${this._getHtmlBasicTmpl(e,t)} type="${e.type||"text"}"${e.pattern?' pattern="'+e.pattern+'"':""}`}_arrayOfSchemas(e,t){let i="";for(const s of e)i=`${i}\n\t\t\t\t${this[t](s)}`;return i}otherJsonKind(e){return e.button?this.button(e.button):e.simpleForm?this.simpleForm(e.simpleForm):e.tree?this.tree(e.tree):e.dropMenuButton?this.dropMenuButton(e.dropMenuButton):e.dropmenu?this.dropmenu(e.dropmenu):e.menu?this.menu(e.menu):e.accordion?this.accordion(e.accordion):e.icon?this.icon(e.icon):e.status?this.status(e.status):e.html?this.html(e.html):null}appendClassList({element:e,json:t}){for(const i of t.classList)e.classList.add(i)}appendIcon({element:e,json:t,mirrored:i}){const s=document.createElement("div"),n={};"img"===t.icon&&t["icon-src"]?(n.kind="img",n.src=t["icon-src"]):n.icon=t.icon,s.innerHTML=this.icon(n);const r=s.childNodes[0];!t["icon-position"]&&!0!==i||"left"===t["icon-position"]?e.insertBefore(r,e.childNodes[0]):e.appendChild(r)}appendStatus({element:e,json:t,mirrored:i}){const s=document.createElement("div");s.innerHTML=this.status(t);const n=s.childNodes[0];n.dataset.powerInactive=!0===i?t.inactive.replace("right","left"):t.inactive,n.dataset.powerActive=t.active,"left"===t.position||!0===i?e.insertBefore(n,e.childNodes[0]):e.appendChild(n)}accordion(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"accordion");if(e.$ref)return this.accordion(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.accordionDef(),t))throw window.console.log("Failed JSON accordion:",t),"Failed JSON accordion!";if(!1===this._validate(this.accordionDef().properties.config,t.config))throw window.console.log("Failed JSON accordion config:",t.config),"Failed JSON accordion config!";t.classList||(t.classList=[]),t.classList.push("power-accordion");let i=`<div ${this._getHtmlBasicTmpl(t)} data-multiple-sections-open="${!(!t.config||!t.config.multipleSectionsOpen)&&t.config.multipleSectionsOpen}">`;for(const e of t.panels){if(!1===this._validate(this.accordionDef().properties.panels,e))throw window.console.log("Failed JSON accordion panel:",e),"Failed JSON accordion panel!";if(!1===this._validate(this.accordionDef().properties.panels.properties.header,e.header))throw window.console.log("Failed JSON accordion header:",e.header),"Failed JSON accordion header!";if(!1===this._validate(this.accordionDef().properties.panels.properties.section,e.section))throw window.console.log("Failed JSON accordion section:",e.section),"Failed JSON accordion section!";const t={};e.header.icon&&("img"===e.header.icon&&e.header["icon-src"]?(t.kind="img",t.src=e.header["icon-src"]):t.icon=e.header.icon);const s={};e.header.status&&(s.active=e.header.status.active,s.inactive=e.header.status.inactive);const n=e.section.id||this.$powerUi._Unique.next(),r=`\n\t\t\t\t<div class="power-action" data-power-target="${n}" ${this._getIdTmpl(e.header.id,!0)}>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t${this.icon(t)}\n\t\t\t\t\t\t<span class="pw-label">${e.header.label}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.status(s)}\n\t\t\t\t</div>`;let o=`<div class="power-accordion-section" ${this._getIdTmpl(n)}>\n\t\t\t\t\t${e.section.text||""}`;if(e.section.children)for(const t of e.section.children)o+=this.otherJsonKind(t);o+="</div>",i=i+r+o}return i+"</div>"}}powertabs(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"powertabs");if(e.$ref)return this.powertabs(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.powertabsDef(),t))throw window.console.log("Failed JSON powertabs:",t),"Failed JSON powertabs!";t.classList||(t.classList=[]),t.classList.push("power-tabs");let i=`<div ${this._getHtmlBasicTmpl(t)}>`;for(const e of t.tabs){if(!1===this._validate(this.powertabsDef().properties.tabs,e))throw window.console.log("Failed JSON tab:",e),"Failed JSON tab!";if(!1===this._validate(this.powertabsDef().properties.tabs.properties.header,e.header))throw window.console.log("Failed JSON tab header:",e.header),"Failed JSON tab header!";if(!1===this._validate(this.powertabsDef().properties.tabs.properties.section,e.section))throw window.console.log("Failed JSON tab section:",e.section),"Failed JSON tab section!";const t={};e.header.icon&&("img"===e.header.icon&&e.header["icon-src"]?(t.kind="img",t.src=e.header["icon-src"]):t.icon=e.header.icon);const s={};e.header.status&&(s.active=e.header.status.active,s.inactive=e.header.status.inactive);const n=e.section.id||this.$powerUi._Unique.next(),r=`\n\t\t\t\t<div class="power-action" data-power-target="${n}" ${this._getIdTmpl(e.header.id,!0)}>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t${this.icon(t)}\n\t\t\t\t\t\t<span class="pw-label">${e.header.label}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.status(s)}\n\t\t\t\t</div>`;let o=`<div class="power-tab-section" ${this._getIdTmpl(n)}>\n\t\t\t\t\t${e.section.text||""}`;if(e.section.children)for(const t of e.section.children)o+=this.otherJsonKind(t);o+="</div>",i=i+r+o}return i+"</div>"}}menu(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"menu");if(e.$ref)return this.menu(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.menuDef(),t))throw window.console.log("Failed JSON menu:",t),"Failed JSON dropmenu!";if(t.events){const e=this._validateEvents(t.events,t,"menu");if(!0!==e)throw e}const i=document.createElement("div");t.position||(t.orientation&&"horizontal"!==t.orientation?"vertical"===t.orientation&&(!0===t.mirrored||void 0===t.mirrored&&("fixed-right"===t.kind||"float-right"===t.kind)?t.position="left-bottom":t.position="right-bottom"):!0===t.mirrored?void 0===t.kind||"fixed-top"===t.kind?t.position="bottom-left":"fixed-bottom"===t.kind&&(t.position="top-left"):void 0===t.kind||"fixed-top"===t.kind?t.position="bottom-right":"fixed-bottom"===t.kind&&(t.position="top-right")),i.innerHTML=this.dropmenu(t,t.mirrored,!0);const s=i.children[0];if("fixed-top"===t.kind?(s.classList.add("pw-menu-fixed"),s.classList.add("pw-top")):"fixed-bottom"===t.kind?(s.classList.add("pw-menu-fixed"),s.classList.add("pw-bottom")):"fixed-left"===t.kind?(s.classList.add("pw-menu-fixed"),s.classList.add("pw-left")):"fixed-right"===t.kind?(s.classList.add("pw-menu-fixed"),s.classList.add("pw-right")):"float-left"===t.kind?(s.classList.add("pw-menu-float"),s.classList.add("pw-left")):"float-right"===t.kind&&(s.classList.add("pw-menu-float"),s.classList.add("pw-right")),t.brand){s.classList.add("pw-horizontal");const e=document.createElement("div");e.innerHTML=`<div class="power-brand">${t.brand}</div>`;const i=e.children[0];s.insertBefore(i,s.childNodes[0])}if(t.orientation&&"horizontal"!==t.orientation)"vertical"===t.orientation&&s.classList.add("pw-vertical");else{s.classList.add("pw-horizontal");const e=document.createElement("div");e.innerHTML=`<a id="${t.id}-action" class="power-toggle" data-power-target="${t.id}">\n\t\t\t\t\t<i class="pw-icon icon-hamburguer"></i>\n\t\t\t\t</a>`;const i=e.children[0];s.appendChild(i)}return t.classList&&this.appendClassList({element:s,json:t}),i.innerHTML}}dropmenu(e,t,i){const s=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"dropmenu");if(e.$ref)return this.dropmenu(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.dropmenuDef(),s))throw window.console.log("Failed JSON dropmenu:",s),"Failed JSON dropmenu!";if(s.events){const e=this._validateEvents(s.events,s,"dropmenu");if(!0!==e)throw e}const n=document.createElement("div");if(s.classList||(s.classList=[]),s.classList.push(i?"power-menu":"power-dropmenu"),n.innerHTML=`<nav ${this._getHtmlBasicTmpl(s)} ${!0===t?" pw-mirrored":""}></nav>`,s.position){n.children[0].dataset.powerPosition=s.position}for(const e of s.items){const i=document.createElement("div");e.item?i.innerHTML=this.item({item:e.item,mirrored:void 0===e.mirrored?t:e.mirrored,dropmenuId:!!e.dropmenu&&e.dropmenu.id}):e.button&&e.dropmenu?(void 0!==t&&void 0===e.button.mirrored&&(e.button.mirrored=t),i.innerHTML=this.dropMenuButton(e)):e.button&&!e.dropmenu&&(void 0!==t&&void 0===e.button.mirrored?i.innerHTML=this.button(e.button,t):i.innerHTML=this.button(e.button),i.children[0].classList.add("power-item"));const s=i.children[0];if(e.item&&!e.button&&e.status&&this.appendStatus({element:s,json:e.status,mirrored:t}),n.children[0].appendChild(s),e.button&&e.dropmenu)n.children[0].appendChild(i.children[0]);else if(e.dropmenu&&!e.button){const i=document.createElement("div");i.innerHTML=this.dropmenu(e.dropmenu,t),n.children[0].appendChild(i.children[0])}}return n.innerHTML}}item({item:e,mirrored:t,dropmenuId:i}){const s=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"item");if(e.$ref)return this.item(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.itemDef(),s))return window.console.log("Failed JSON item:",s),"Failed JSON item!";if(s.events){const e=this._validateEvents(s.events,s,"item");if(!0!==e)throw e}const n=document.createElement("div");s.classList||(s.classList=[]),s.classList.push(i?"power-action":"power-item"),n.innerHTML=`<a ${this._getHtmlBasicTmpl(s)} ${i?'data-power-target="'+i+'"':""}><span class="pw-label">${s.label}</span></a>`;const r=n.children[0];return s.icon&&this.appendIcon({element:r,json:s,mirrored:t}),n.innerHTML}}dropMenuButton(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"dropMenuButton");if(e.$ref)return this.dropMenuButton(this.getNewJSON(e));{if(!1===this._validate(this.dropmenubuttonDef(),t))throw window.console.log("Failed JSON dropMenuButton:",t),"Failed JSON dropMenuButton!";e.$id&&this.registerJSONById(e);const i=document.createElement("div");i.innerHTML=this.button(t.button,t.button.mirrored);const s=i.children[0];return s.dataset.powerTarget=t.dropmenu.id,s.classList.add("power-action"),t.status&&this.appendStatus({element:s,json:t.status,mirrored:t.button.mirrored}),i.innerHTML=i.innerHTML+this.dropmenu(t.dropmenu,t.button.mirrored),i.innerHTML}}button(e,t){const i=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"button");if(e.$ref)return this.button(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.itemDef(),i))throw window.console.log("Failed JSON button:",i),"Failed JSON button!";if(i.events){const e=this._validateEvents(i.events,i,"button");if(!0!==e)throw e}const s=document.createElement("div");i.classList||(i.classList=[]),i.type||(i.type="button"),i.classList.push(i.kind?`pw-btn-${i.kind}`:"pw-btn-default"),s.innerHTML=`<button ${this._getInputBasicTmpl(i)}><span class="pw-label">${i.label}</span></button>`;const n=s.children[0];return i.icon&&this.appendIcon({element:n,json:i,mirrored:t}),i.classList&&this.appendClassList({element:n,json:i}),s.innerHTML}}tree(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"tree");if(e.$ref)return this.tree(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.treeDef(),t))throw window.console.log("Failed JSON tree:",t),"Failed JSON tree!";if(t.events){const e=this._validateEvents(t.events,t,"tree");if(!0!==e)throw e}t.classList||(t.classList=[]),t.classList.push("power-tree-view");let i=`<nav ${this._getHtmlMoreBasicTmpl(t)} ${t.onClickFile?'data-on-click-file="'+t.onClickFile+'"':""}>`;for(const e of t.nodes){if(!1===this._validate(this.treeNodeDef(),e))throw window.console.log("Failed JSON tree node:",e),"Failed JSON tree node!";if(e.events){const t=this._validateEvents(e.events,e,"tree node");if(!0!==t)throw t}if(e.classList||(e.classList=[]),"file"===e.kind)e.classList.push("power-item"),i=`${i}\n\t\t\t\t\t<a ${this._getHtmlMoreBasicTmpl(e)} ${e.path?' data-file-path="'+encodeURI(e.path)+'"':""} `,i=`${i}\n\t\t\t\t\t><span class="pw-icon ${e.icon||"icon-document-blank"}"></span> <span>${e.fullName}</span></a>`;else if("folder"===e.kind){const t=`list-${this.$powerUi._Unique.next()}`;e.classList.push("power-list"),i=`${i}\n\t\t\t\t\t<a ${this._getHtmlMoreBasicTmpl(e)} data-power-target="${t}">\n\t\t\t\t\t\t<span class="power-status pw-icon" data-power-active="${e.active||"icon-folder-open"}" data-power-inactive="${e.inactive||"icon-folder-close"}"></span> <span>${e.fullName}</span>\n\t\t\t\t\t</a>\n\t\t\t\t\t${this.tree({nodes:e.nodes,id:t})}`}}return i=`${i}\n\t\t\t</nav>`,i}}grid(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"grid");if(e.$ref)return this.grid(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.gridDef(),t))throw window.console.log("Failed JSON grid:",t),"Failed JSON grid!";if(t.events){const e=this._validateEvents(t.events,t,"grid");if(!0!==e)throw e}t.classList||(t.classList=[]),t.classList.push("pw-grid"),t.classList.push(t.kind||"scroll-12"),!0===t.border&&t.classList.push("border"),!0===t.inline&&t.classList.push("inline-grid"),t.gap?t.classList.push(`gap-${t.gap}`):t.classList.push("no-gap");let i=`<div ${this._getHtmlBasicTmpl(t)}>`;t.sizes||(t.sizes=["s-1 m-1 l-1 xl-1"]);let s=0;for(const e of t.fields){if(!1===this._validate(this.gridDef().properties.fields,e))throw window.console.log("Failed JSON grid field:",e,t),"Failed JSON grid field!";if(e.events){const t=this._validateEvents(e.events,e,"field");if(!0!==t)throw t}if(e.classList||(e.classList=[]),e.classList.push("pw-col"),e.classList.push(e.size||t.sizes[s]),i=`${i}\n\t\t\t\t\t<div ${this._getIdTmpl(e.id)} ${this._getClassTmpl(e.classList)}>${e.text||""}`,e.children)for(const t of e.children)i=`${i}\n\t\t\t\t\t\t\t${this.otherJsonKind(t)}`;i+="</div>",e.size||(s+=1),s>=t.sizes.length&&(s=0)}return i=`${i}\n\t\t\t</div>`,i}}simpleFormControls({controls:e,template:t,inline:i}){for(const s of e){if(!1===this._validate(this.simpleformcontrolsDef(),s))throw window.console.log("Failed JSON control:",s),"Failed JSON control!";if(s.events){const e=this._validateEvents(s.events,s,"control");if(!0!==e)throw e}s.id||(s.id="input_"+this.$powerUi._Unique.next());const e=s.label?`<label for="${s.id}">${s.label}</label>`:null;let n="";if(s.classList)for(const e of s.classList)n=`${n} ${e}`;s.classList||(s.classList=[]),s.classList.push("pw-field");const r=s.size?s.size:"s-12 m-12 l-12 xl-12";if(t=`${t}\n\t\t\t\t<div class="${s.controls?"pw-inner-grid":""} pw-col ${r}">`,s.controls)t=`${t}\n\t\t\t\t<div class="pw-grid scroll-12 gap-1 ${!0===s.inline||!0===i?"inline-grid":""}">\n\t\t\t\t\t${this.simpleFormControls({controls:s.controls,template:""})}\n\t\t\t\t</div>`;else if(s.children)for(const e of s.children)t+=this.otherJsonKind(e);else if(s.button)t=`${t}\n\t\t\t\t\t${this.button(s.button)}`;else if("submit"===s.type||"reset"===s.type)s.classList.pop(),t=`${t}\n\t\t\t\t<div class="pw-field-container">\n\t\t\t\t\t<input ${this._getInputBasicTmpl(s)} />\n\t\t\t\t\t<div class="pw-control-helper"></div>\n\t\t\t\t</div>`;else if("select"===s.type){t=`${t}\n\t\t\t\t<div class="pw-field-container">\n\t\t\t\t\t${e||""}\n\t\t\t\t\t<select ${this._getInputBasicTmpl(s)} ${!0===s.multiple?"multiple":""}>`;for(const e of s.list)t=`${t}<option value="${e.value}"${!0===e.disabled?" disabled":""}${!0===e.selected?" selected":""}>${e.label}</option>`;t=`${t}\n\t\t\t\t\t</select>\n\t\t\t\t\t<div class="pw-control-helper"></div>\n\t\t\t\t</div>`}else t="radio"===s.type||"checkbox"===s.type?`${t}\n\t\t\t\t<div class="pw-field-container">\n\t\t\t\t\t<input ${this._getInputBasicTmpl(s)} /> ${e||""}\n\t\t\t\t</div>`:"textarea"===s.type?`${t}\n\t\t\t\t<div class="pw-field-container">\n\t\t\t\t\t${e||""}\n\t\t\t\t\t<textarea ${this._getInputBasicTmpl(s)} ${s.rows?'rows="'+s.rows+'"':""} ${s.cols?'cols="'+s.cols+'"':""}>\n\t\t\t\t\t\t${s.value||""}\n\t\t\t\t\t</textarea>\n\t\t\t\t\t<div class="pw-control-helper"></div>\n\t\t\t\t</div>`:`${t}\n\t\t\t\t<div class="pw-field-container">\n\t\t\t\t\t${e||""}\n\t\t\t\t\t<input ${this._getInputBasicTmpl(s)} />\n\t\t\t\t\t<div class="pw-control-helper"></div>\n\t\t\t\t</div>`;t=`${t}\n\t\t\t\t</div>`}return t}simpleForm(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"form");if(e.$ref)return this.simpleForm(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.simpleformDef(),t))throw window.console.log("Failed JSON form:",t),"Failed JSON form!";if(t.events){const e=this._validateEvents(t.events,t,"form");if(!0!==e)throw e}const i=["pw-vertical-form",`${t.theme||"pw-simple-form"}`,"pw-grid scroll-12","gap-4"];if(!1!==t.inline&&i.push("inline-grid"),t.classList&&t.classList.length)for(const e of t.classList)i.push(e);const s=this._getClassTmpl(i),n="form"===t.type?"form":"div";let r=`<${n} ${this._getIdTmpl(t.id,"form")} ${s}>`;return r=this.simpleFormControls({controls:t.controls,template:r}),r=`${r}\n\t\t\t</${n}>`,r}}html(e){const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"html");if(e.$ref)return this.html(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.htmlDef(),t))return window.console.log("Failed JSON html:",t),"Failed JSON html!";if(t.events){const e=this._validateEvents(t.events,t,"html");if(!0!==e)throw e}if(void 0===t.tagName)return this.otherJsonKind(t);const i=t.tagName.toLowerCase();if(["area","base","br","col","embed","hr","img","link","meta","param","source","track","wbr"].includes(i))return`<${i} ${this._getHtmlBasicTmpl(t)} />`;if("input"===i)return`<${i} ${this._getInputBasicTmpl(t)} />`;{let e=`<${i} ${this._getHtmlBasicTmpl(t)} ${!0===t.multiple?"multiple":""}>\n\t\t\t\t\t${t.text||""}`;if(t.children)for(const i of t.children)e=`${e}\n\t\t\t\t\t\t\t${this.html(i)}`;return e=`${e}\n\t\t\t\t</${i}>`,e}}}icon(e){if(void 0===e.icon&&void 0===e.kind)return"";const t=this.cloneObject(e);if(e.length)return this._arrayOfSchemas(e,"icon");if(e.$ref)return this.icon(this.getNewJSON(e));{if(e.$id&&this.registerJSONById(e),!1===this._validate(this.iconDef(),e))return window.console.log("Failed JSON icon:",e),"Failed JSON icon!";let i="";if(t.classList||(t.classList=[]),t.classList.push("pw-icon"),"img"===t.kind&&t.src){const e=t.src;delete t.src,i=`<span ${this._getHtmlBasicTmpl(t)}><img src=${e} /></span>`}else t.classList.push(t.icon),i=`<span ${this._getHtmlBasicTmpl(t)}></span>`;return i}}status(e){if(!e.inactive&&!e.active)return"";const t=this.cloneObject(e);return e.length?this._arrayOfSchemas(e,"status"):e.$ref?this.status(this.getNewJSON(e)):(e.$id&&this.registerJSONById(e),!1===this._validate(this.statusDef(),e)?(window.console.log("Failed JSON status:",e),"Failed JSON status!"):(t.classList||(t.classList=[]),t.classList.push("pw-icon"),t.classList.push("power-status"),`<span ${this._getHtmlBasicTmpl(t)} data-power-inactive="${t.inactive}" data-power-active="${t.active}"></span>`))}accordionDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/accordion",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},id:{type:"string"},classList:{type:"array"},config:{type:"object",properties:{multipleSectionsOpen:{type:"boolean"}}},panels:{type:"array",properties:{header:{type:"object",properties:{id:{type:"string"},label:{type:"string"},icon:{type:"string"},"icon-position":{type:"string"},status:{$ref:"#/schema/draft-07/status"}},required:["label","id"]},section:{type:"object",properties:{id:{type:"string"},text:{type:"string"},children:{type:"array",properties:{html:{$ref:"#/schema/draft-07/html"},button:{$ref:"#/schema/draft-07/item"},item:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},icon:{$ref:"#/schema/draft-07/icon"},menu:{$ref:"#/schema/draft-07/menu"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"},dropmenubutton:{$ref:"#/schema/draft-07/dropmenubutton"},simpleform:{$ref:"#/schema/draft-07/simpleform"},tree:{$ref:"#/schema/draft-07/tree"},accordion:{$ref:"#/schema/draft-07/accordion"},grid:{$ref:"#/schema/draft-07/grid"}}}},required:["id"]}},required:["header","section"]}},required:["panels"]}}powertabsDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/powertabs",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},id:{type:"string"},classList:{type:"array"},tabs:{type:"array",properties:{header:{type:"object",properties:{id:{type:"string"},label:{type:"string"},icon:{type:"string"},"icon-position":{type:"string"},status:{$ref:"#/schema/draft-07/status"}},required:["label","id"]},section:{type:"object",properties:{id:{type:"string"},text:{type:"string"},children:{type:"array",properties:{html:{$ref:"#/schema/draft-07/html"},button:{$ref:"#/schema/draft-07/item"},item:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},icon:{$ref:"#/schema/draft-07/icon"},menu:{$ref:"#/schema/draft-07/menu"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"},dropmenubutton:{$ref:"#/schema/draft-07/dropmenubutton"},simpleform:{$ref:"#/schema/draft-07/simpleform"},tree:{$ref:"#/schema/draft-07/tree"},accordion:{$ref:"#/schema/draft-07/accordion"},grid:{$ref:"#/schema/draft-07/grid"}}}},required:["id"]}},required:["header","section"]}},required:["tabs"]}}simpleformcontrolsDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/simpleformcontrols",type:"array",properties:{$id:{type:"string"},$ref:{type:"string"},classList:{type:"array"},label:{type:"string"},type:{type:"string"},value:{type:"any"},name:{type:"string"},bind:{type:"string"},id:{type:"string"},controls:{$ref:"#/schema/draft-07/simpleformcontrols"},button:{$ref:"#/schema/draft-07/item"},item:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},icon:{$ref:"#/schema/draft-07/icon"},menu:{$ref:"#/schema/draft-07/menu"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"},dropmenubutton:{$ref:"#/schema/draft-07/dropmenubutton"},simpleform:{$ref:"#/schema/draft-07/simpleform"},tree:{$ref:"#/schema/draft-07/tree"},html:{$ref:"#/schema/draft-07/html"},accordion:{$ref:"#/schema/draft-07/accordion"},grid:{$ref:"#/schema/draft-07/grid"}}}}simpleformDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/simpleform",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},classList:{type:"array"},type:{type:"string"},inline:{type:"boolean"},padding:{type:"boolean"},controls:{$ref:"#/schema/draft-07/simpleformcontrols"}},required:["controls"]}}dropmenuDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/dropmenu",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},id:{type:"string"},classList:{type:"array"},items:{type:"array",properties:{button:{$ref:"#/schema/draft-07/item"},item:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"}}}},required:["id","items"]}}menuDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/menu",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},id:{type:"string"},classList:{type:"array"},mirrored:{type:"boolean"},position:{type:"string"},orientation:{type:"string"},kind:{type:"string"},items:{type:"array",properties:{button:{$ref:"#/schema/draft-07/item"},item:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"}}}},required:["id"]}}itemDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/item",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},classList:{type:"array"},label:{type:"string"},id:{type:"string"},icon:{type:"string"},"icon-src":{type:"string"},"icon-position":{type:"string"},kind:{type:"string"},mirrored:{type:"boolean"},events:{type:"array",properties:{event:{type:"string"},fn:{type:"string"}},required:["event","fn"]}},required:["label"]}}treeNodeDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/treenode",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},classList:{type:"array"},id:{type:"string"},name:{type:"string"},fullName:{type:"string"},extension:{type:"string"},path:{type:"string"},kind:{type:"string"},events:{type:"array",properties:{event:{type:"string"},fn:{type:"string"}},required:["event","fn"]},nodes:{$ref:"tree"}},required:["name","fullName","path","kind"]}}treeDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/tree",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},id:{type:"string"},classList:{type:"array"},events:{type:"array",properties:{event:{type:"string"},fn:{type:"string"}},required:["event","fn"]},nodes:{$ref:"treenode"}},required:["nodes"]}}dropmenubuttonDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/dropmenubutton",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},button:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"}},required:["button"]}}statusDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/status",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},active:{type:"string"},inactive:{type:"string"},position:{type:"string"},classList:{type:"array"}},required:["active","inactive"]}}iconDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/icon",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},icon:{type:"string"},kind:{type:"string"},src:{type:"string"},classList:{type:"array"}}}}htmlDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/html",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},classList:{type:"array"},id:{type:"string"},tagName:{type:"string"},multiple:{type:"boolean"},src:{type:"string"},width:{type:"string"},height:{type:"string"},type:{type:"string"},bind:{type:"string"},title:{type:"string"},for:{type:"string"},attrs:{type:"array"},cols:{type:"string"},rows:{type:"string"},value:{type:"any"},name:{type:"string"},required:{type:"boolean"},disabled:{type:"boolean"},pattern:{type:"string"},events:{type:"array",properties:{event:{type:"string"},fn:{type:"string"}},required:["event","fn"]},children:{type:"array",properties:{$id:{type:"string"},$ref:{type:"string"},classList:{type:"array"},id:{type:"string"},tagName:{type:"string"},multiple:{type:"boolean"},src:{type:"string"},width:{type:"string"},height:{type:"string"},type:{type:"string"},bind:{type:"string"},title:{type:"string"},for:{type:"string"},attrs:{type:"array"},cols:{type:"string"},rows:{type:"string"},value:{type:"any"},name:{type:"string"},required:{type:"boolean"},disabled:{type:"boolean"},pattern:{type:"string"},events:{type:"array",properties:{event:{type:"string"},fn:{type:"string"}},required:["event","fn"]},html:{$ref:"#/schema/draft-07/html"},button:{$ref:"#/schema/draft-07/item"},item:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},icon:{$ref:"#/schema/draft-07/icon"},menu:{$ref:"#/schema/draft-07/menu"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"},dropmenubutton:{$ref:"#/schema/draft-07/dropmenubutton"},simpleform:{$ref:"#/schema/draft-07/simpleform"},tree:{$ref:"#/schema/draft-07/tree"},accordion:{$ref:"#/schema/draft-07/accordion"},grid:{$ref:"#/schema/draft-07/grid"}}}},required:["tagName"]}}gridDef(){return{$schema:"http://json-schema.org/draft-07/schema#",$id:"#/schema/draft-07/grid",type:"object",properties:{$id:{type:"string"},$ref:{type:"string"},classList:{type:"array"},id:{type:"string"},kind:{type:"string"},border:{type:"boolean"},gap:{type:"number"},sizes:{type:"array"},fields:{type:"array",properties:{classList:{type:"array"},text:{type:"string"},size:{type:"string"},events:{type:"array",properties:{event:{type:"string"},fn:{type:"string"}},required:["event","fn"]},children:{type:"array",properties:{html:{$ref:"#/schema/draft-07/html"},button:{$ref:"#/schema/draft-07/item"},item:{$ref:"#/schema/draft-07/item"},status:{$ref:"#/schema/draft-07/status"},icon:{$ref:"#/schema/draft-07/icon"},menu:{$ref:"#/schema/draft-07/menu"},dropmenu:{$ref:"#/schema/draft-07/dropmenu"},dropmenubutton:{$ref:"#/schema/draft-07/dropmenubutton"},simpleform:{$ref:"#/schema/draft-07/simpleform"},tree:{$ref:"#/schema/draft-07/tree"},accordion:{$ref:"#/schema/draft-07/accordion"},grid:{$ref:"#/schema/draft-07/grid"}}}}},events:{type:"array",properties:{event:{type:"string"},fn:{type:"string"}},required:["event","fn"]}},required:["fields"]}}$ref(e){const t="#/schema/draft-07/",i={};return i[`${t}item`]=this.itemDef,i[`${t}status`]=this.statusDef,i[`${t}icon`]=this.iconDef,i[`${t}menu`]=this.menuDef,i[`${t}dropmenu`]=this.dropmenuDef,i[`${t}dropmenubutton`]=this.dropmenubuttonDef,i[`${t}simpleform`]=this.simpleformDef,i[`${t}simpleformcontrols`]=this.simpleformcontrolsDef,i[`${t}tree`]=this.treeDef,i[`${t}html`]=this.htmlDef,i[`${t}accordion`]=this.accordionDef,i[`${t}grid`]=this.gridDef,i[e]()}}class WidgetService extends PowerServices{mayAddCtrlParams({params:e,onCommit:t,onCancel:i,onCancelError:s,onCommitError:n}){return void 0===e&&(e={}),t&&(e.onCommit=t),i&&(e.onCancel=i),n&&(e.onCommitError=n),s&&(e.onCancelError=s),e}alert(e){e.kind="alert",this.open(e)}confirm(e){e.kind="confirm",this.open(e)}yesno(e){e.kind="yesno",this.open(e)}modal(e){e.kind="modal",this.open(e)}window(e){e.kind="window",this.open(e)}windowIframe(e){e.kind="windowIframe",this.open(e)}open({title:e,template:t,ctrl:i,target:s,params:n,controller:r,kind:o,onCommit:a,onCommitError:l,onCancel:c,onCancelError:h,templateUrl:d,templateComponent:u,url:p}){i||r||(r=function(){}),!i&&r&&"function"==typeof r&&(i={component:wrapFunctionInsideDialog({controller:r,kind:o,params:n=this.mayAddCtrlParams({params:n,onCommit:a,onCancel:c,onCommitError:l,onCancelError:h})})}),void 0===i.params&&(i.params={});const m=`pow_route_${this.$powerUi._Unique.next()}`;this.$ctrl.volatileRouteIds.push(m),this._open({routeId:m,target:s||"_blank",title:e,template:t,templateUrl:d,templateComponent:u,url:p,ctrl:i,params:n})}_open({routeId:e,params:t,target:i,title:s,template:n,ctrl:r,templateUrl:o,templateComponent:a,url:l}){const c={id:e,title:s,route:this.$powerUi.router.config.rootPath+e,template:o||a||n||l,templateUrl:o,templateComponent:a,hidden:!0,ctrl:r,isVolatile:!0};this.$powerUi.router.routes[e]=c,this.$powerUi.router.openRoute({routeId:e||this.$ctrl._routeId,currentRouteId:this.$ctrl._routeId,currentViewId:this.$ctrl._viewId,params:t,target:i,title:s||null})}}class PowerController extends PowerScope{constructor({$powerUi:e}){super({$powerUi:e}),this.volatileRouteIds=[]}get router(){return this.$powerUi.router}refresh(e,t){const i=document.getElementById(this._viewId),s=i.getElementsByClassName("pw-container")[0],n=i.getElementsByClassName("pw-body")[0];s&&(this._containerScrollTop=s.scrollTop||0,this._containerScrollLeft=s.scrollLeft||0),n&&(this._bodyScrollTop=n.scrollTop||0,this._bodyScrollLeft=n.scrollLeft||0),this.router._refresh(e,t)}reload(e){this.refresh(e,!0)}openRoute({routeId:e,params:t,target:i}){const s="root-view"===this._viewId?"main-view":this._viewId,n="$root"===this._routeId?this.$powerUi.controllers["main-view"].instance._routeId:this._routeId,r=this.$powerUi.router.getOpenedRoute({routeId:n,viewId:s});this.router.openRoute({routeId:e||n,currentRouteId:n,currentViewId:s,params:t,target:i,title:r.title||null})}closeCurrentRoute(){const e=this.router.getOpenedRoute({routeId:this._routeId,viewId:this._viewId}),t=decodeURI(this.router.locationHashWithHiddenRoutes()).split("?");let i=0,s="";for(let n of t)n.includes(e.route)||(n=0!==i?"?"+n:n.replace(this.router.config.rootPath,""),s+=n,i+=1);this.router.navigate({hash:s,title:e.title||null})}safeEval(e){return this.$powerUi.safeEval({text:e,scope:this})}getObjectById(e){return this.$powerUi.powerTree.allPowerObjsById[e]||null}getBindById(e){const t=this.getObjectById(e);return t?t.powBind:null}}export{PowerController};class Request{constructor({config:e,$powerUi:t}){this.$powerUi=t,e.authCookie&&(this.$powerUi.authCookie=e.authCookie),e.authToken&&(this.$powerUi.authToken=e.authToken),e.headers&&(this.$powerUi.headers=e.headers);const i=this;return function(e){e.withCredentials=void 0===e.withCredentials||e.withCredentials,e.headers=e.headers||i.$powerUi.headers||{},i.$powerUi.authCookie?e.headers.Authorization=`Bearer ${i.$powerUi.getCookie(i.$powerUi.authCookie)}`||null:i.$powerUi.authToken&&(e.headers.Authorization=`Bearer ${i.$powerUi.authToken}`);const t={then:function(e){return this.onsucess=e,this},catch:function(e){return this.onerror=e,this}};return i.ajaxRequest({method:e.method,url:e.url,data:e,onsucess:function(e){if(t.onsucess)try{return t.onsucess(JSON.parse(e.response),e)}catch(i){return t.onsucess(e.response,e)}return t},onerror:function(e){if(t.onerror)try{const s=JSON.parse(e.response);if(s&&s.fields&&s.fields.length>0)for(const e of s.fields)i.$powerUi.onFormError({id:e.id,msg:e.msg});return t.onerror(s,e)}catch(i){return t.onerror(e.response,e)}}}),t}}encodedParams(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t.length>0&&(t+="&"),t+=encodeURI(i+"="+e[i]));return t}ajaxRequest({method:e,url:t,onsucess:i,onerror:s,async:n,data:r}){null==n&&(n=!0);const o=new XMLHttpRequest;return o.open(e,t,n),o.onload=function(){200===o.status&&i?i(o):200!==o.status&&s?s(o):window.console("Request failed.  Returned status of "+o.status)},e&&"POST"===e.toUpperCase()?o.setRequestHeader("Content-Type","application/json"):o.setRequestHeader("Content-Type","text/html"),r.headers&&r.headers["Content-Type"]&&o.setRequestHeader("Content-Type",r.headers["Content-Type"]),r.headers&&r.headers.Authorization&&o.setRequestHeader("Authorization",r.headers.Authorization),r&&r.body?o.send(JSON.stringify(r.body)):o.send(),o}}class PowerRoot extends PowerController{constructor({$powerUi:e,viewId:t,routeId:i}){return super({$powerUi:e}),this._viewId=t,this._routeId=i,{template:this._template(),component:this}}_template(){return new Promise(this.template.bind(this))}}export{PowerRoot};function getEmptyRouteObjetc(){return{params:[],id:"",viewId:"",route:"",secundaryRoutes:[],hiddenRoutes:[]}}class Router{constructor(e={},t){if(this.config=e,this.$powerUi=t,this.routes={},this.oldRoutes=getEmptyRouteObjetc(),this.currentRoutes=getEmptyRouteObjetc(),this.config.rootPath||(this.config.rootPath="#!/"),e.routes)for(const t of e.routes)this.add(t);this.init(),window.onhashchange=this.hashChange.bind(this)}add({id:e,route:t,template:i,templateUrl:s,templateComponent:n,url:r,avoidCacheTemplate:o,callback:a,viewId:l,ctrl:c,title:h,hidden:d}){if(i=s||i||n||r,!this.config.routerMainViewId&&!1!==this.config.routerMainViewId&&(this.config.routerMainViewId="main-view",!document.getElementById(this.config.routerMainViewId)))throw new Error('The router needs a element with an ID to render views, you can define some HTML element with the id "main-view" or set your on id in the config using the key "routerMainViewId" with the choosen id. If you not want render any view in a main view, set the config key "routerMainViewId" to false and a "viewId" flag to each route with a view.');if(!this.config.routerSecundaryViewId&&!1!==this.config.routerSecundaryViewId&&(this.config.routerSecundaryViewId="secundary-view",!document.getElementById(this.config.routerSecundaryViewId)))throw new Error('The router needs a element with an ID to render views, you can define some HTML element with the id "secundary-view" or set your on id in the config using the key "routerSecundaryViewId" with the choosen id. If you not want render any view in a secundary view, set the config key "routerSecundaryViewId" to false and a "viewId" flag to each route with a view.');if(!e)throw new Error("A route ID must be given");if(!t&&!i&&!a)throw new Error("route, template, templateUrl or callback must be given");if(!1===this.config.routerMainViewId&&i&&!l)throw new Error(`You set the config flag "routerMainViewId" to false, but do not provide a custom "viewId" to the route "${t}" and id "${e}". Please define some element with some id to render the template, templateUrl, and pass it as "viewId" paramenter to the router.`);if(!1===this.config.routerSecundaryViewId&&i&&!l)throw new Error(`You set the config flag "routerSecundaryViewId" to false, but do not provide a custom "viewId" to the route "${t}" and id "${e}". Please define some element with some id to render the template, templateUrl, and pass it as "viewId" paramenter to the router.`);if("string"!=typeof t&&"$root"!==e)throw new TypeError("typeof route must be a string");if(a&&"function"!=typeof a)throw new TypeError("typeof callback must be a function");"/"===t&&(t="");const u={title:h,route:this.config.rootPath+t,callback:a||null,template:i||null,templateUrl:s||null,templateComponent:n||null,avoidCacheTemplate:!0===o,templateIsCached:!s&&!n,viewId:l||null,ctrl:c||null,hidden:d||null};if("otherwise"!==e||i)for(const i of Object.keys(this.routes||{}))if(this.routes[i].route===u.route&&("otherwise"!==i||this.routes[i].template))throw"otherwise"===i||"otherwise"===e?new Error(`the route "${t||"/"}" already exists, so "${e}" can't use it if you use a template. You can remove the template or use another route.`):new Error(`the route "${t||"/"}" already exists, so "${e}" can't use it.`);if(this.routes[e])throw new Error(`the id ${t.id} already exists`);this.routes[e]=u}hashChange(e,t){this.oldRoutes=this.cloneRoutes({source:this.currentRoutes}),this.currentRoutes=getEmptyRouteObjetc(),this.init({onHashChange:e,reloading:t})}cloneRoutes({source:e}){const t={params:[],id:e.id,viewId:e.viewId,route:e.route,secundaryRoutes:[],hiddenRoutes:[]};for(const i of e.params)t.params.push({key:i.key,value:i.value});for(const i of e.secundaryRoutes){const e={id:i.id,viewId:i.viewId,route:i.route,params:[]};for(const t of i.params)e.params.push({key:t.key,value:t.value});t.secundaryRoutes.push(e)}for(const i of e.hiddenRoutes){const e={id:i.id,viewId:i.viewId,route:i.route,params:[]};for(const t of i.params)e.params.push({key:t.key,value:t.value});t.hiddenRoutes.push(e)}return t}_refresh(e,t){if("root-view"===e||!e&&this.$powerUi._rootScope)return void this._refreshAll(t);let i=this.getOpenedRoutesRefreshData();e&&(i=i.filter(t=>t.viewId===e));for(const e of i)if(e.$tscope){const i=this;e.$tscope._template().then((function(s){const n=s;i.replaceViewContent({view:e.view,viewId:e.viewId,routeId:e.routeId,title:e.title,template:n,reloadCtrl:t})})).catch((function(t,i){window.console.log("_refresh fails",e)}))}else this.replaceViewContent({view:e.view,viewId:e.viewId,routeId:e.routeId,title:e.title,template:e.template,reloadCtrl:t})}_refreshAll(e){let t=this.getOpenedRoutesRefreshData();t.unshift(this.$powerUi._rootScope);for(const e of t)this.$powerUi.powerTree.allPowerObjsById[e.viewId]&&this.$powerUi.powerTree.allPowerObjsById[e.viewId].$shared.removeInnerElementsFromPower();for(const i of t){if(!document.getElementById(i.view.id)){document.getElementById("secundary-view").appendChild(i.view)}let t=this.$powerUi.prepareViewToLoad({viewId:i.viewId,routeId:i.routeId});if(i.$tscope){const s=this;i.$tscope._template().then((function(n){const r=n;s.$powerUi.buildViewTemplateAndMayCallInit({self:s.$powerUi,view:t,template:r,routeId:i.routeId,viewId:i.viewId,title:i.title,refreshing:!0,reloadCtrl:e,initAll:!0})})).catch((function(e,t){window.console.log("_refreshAll fails",e,i)}))}else this.$powerUi.buildViewTemplateAndMayCallInit({self:this.$powerUi,view:t,template:i.template,routeId:i.routeId,viewId:i.viewId,title:i.title,refreshing:!0,reloadCtrl:e,initAll:!0})}}replaceViewContent({view:e,viewId:t,routeId:i,title:s,template:n,reloadCtrl:r}){this.$powerUi.powerTree.allPowerObjsById[t]&&this.$powerUi.powerTree.allPowerObjsById[t].$shared.removeInnerElementsFromPower(),this.$powerUi.addSpinnerAndHideView(e),this.$powerUi.waitingInit.push({node:e,viewId:t}),this.$powerUi.buildViewTemplateAndMayCallInit({self:this.$powerUi,view:e,template:n,routeId:i,viewId:t,title:s,refreshing:!0,reloadCtrl:r})}getOpenedRoutesRefreshData(){const e=[];e.push({view:document.getElementById(this.currentRoutes.viewId),routeId:this.currentRoutes.id,viewId:this.currentRoutes.viewId,title:this.currentRoutes.title,template:this.routes[this.currentRoutes.id].template,$tscope:this.routes[this.currentRoutes.id].$tscope||null});for(const t of this.currentRoutes.secundaryRoutes)e.push({view:document.getElementById(t.viewId),routeId:t.id,viewId:t.viewId,title:t.title,template:this.routes[t.id].template,$tscope:this.routes[t.id].$tscope||null});for(const t of this.currentRoutes.hiddenRoutes)e.push({view:document.getElementById(t.viewId),routeId:t.id,viewId:t.viewId,title:t.title,template:this.routes[t.id].template,$tscope:this.routes[t.id].$tscope||null});return e}locationHashWithHiddenRoutes(){return decodeURI(window.location.hash+(this.hiddenLocationHash||""))}init({secundaryRoute:e,hiddenRoute:t,reloading:i,onHashChange:s}={}){const n=this.extractRouteParts(e||t||this.locationHashWithHiddenRoutes()||this.config.rootPath);for(const s of Object.keys(this.routes||{}))if("otherwise"!==s||this.routes[s].template){const r=this.getRouteParamKeys(this.routes[s].route);let o=this.buildRegExPatternToRoute(s,r);if(n.path.match(o)){if(this.routes[s]&&this.routes[s].title&&(document.title=this.routes[s].title),!e&&!t){this.oldRoutes.id&&this.oldRoutes.route===n.path.replace(this.config.rootPath,"")||(this.removeMainView({viewId:this.routes[s].viewId||this.config.routerMainViewId,reloading:i}),this.loadRoute({routeId:s,paramKeys:r,viewId:this.config.routerMainViewId,ctrl:this.routes[s].ctrl,title:this.routes[s].title})),this.setMainRouteState({routeId:s,paramKeys:r,route:n.path,viewId:this.config.routerMainViewId,title:this.routes[s].title});for(const e of n.secundaryRoutes)this.init({secundaryRoute:e,reloading:i});for(const e of n.hiddenRoutes)this.init({hiddenRoute:e,reloading:i});return this.closeOldSecundaryAndHiddenViews({reloading:i}),!0}if(e){const t=e.replace(this.config.rootPath,""),i=this.oldRoutes.secundaryRoutes.find(e=>e&&e.route===t),n=this.currentRoutes.secundaryRoutes.find(e=>e&&e.route===t);if(i||n)n||this.currentRoutes.secundaryRoutes.push(i);else{const t=this.loadSecundaryOrHiddenRoute({routeId:s,paramKeys:r,routeViewId:this.config.routerSecundaryViewId,ctrl:this.routes[s].ctrl});this.currentRoutes.secundaryRoutes.push(this.setSecundaryOrHiddenRouteState({routeId:s,paramKeys:r,route:e,viewId:t,title:this.routes[s].title}))}}else if(t){const e=t.replace(this.config.rootPath,""),i=this.oldRoutes.hiddenRoutes.find(t=>t&&t.route===e),n=this.currentRoutes.hiddenRoutes.find(t=>t&&t.route===e);if(i||n)n||this.currentRoutes.hiddenRoutes.push(i);else{const e=this.loadSecundaryOrHiddenRoute({routeId:s,paramKeys:r,routeViewId:this.config.routerSecundaryViewId,ctrl:this.routes[s].ctrl});this.currentRoutes.hiddenRoutes.push(this.setSecundaryOrHiddenRouteState({routeId:s,paramKeys:r,route:t,viewId:e,title:this.routes[s].title}))}}}}if(!e&&!t){const e=this.routes.otherwise?this.routes.otherwise.route:this.config.rootPath;window.location.replace(encodeURI(e))}}closeOldSecundaryAndHiddenViews({reloading:e}){for(const t of this.oldRoutes.secundaryRoutes)this.currentRoutes.secundaryRoutes.find(e=>e.route===t.route)||this.removeSecundaryOrHiddenView({viewId:t.viewId,routeId:t.id,reloading:e});for(const t of this.oldRoutes.hiddenRoutes)this.currentRoutes.hiddenRoutes.find(e=>e.route===t.route)||this.removeSecundaryOrHiddenView({viewId:t.viewId,routeId:t.id,reloading:e});this.clearRouteSharedScopes(),0===document.body.getElementsByClassName("pw-backdrop").length&&document.body.classList.remove("modal-open")}clearRouteSharedScopes(){for(const e of this.$powerUi.controllers.$routeSharedScope.$waitingToDelete)this.$powerUi.controllers.$routeSharedScope[e]&&0===this.$powerUi.controllers.$routeSharedScope[e]._instances&&delete this.$powerUi.controllers.$routeSharedScope[e];this.$powerUi.controllers.$routeSharedScope.$waitingToDelete=[]}removeSecundaryOrHiddenView({viewId:e,routeId:t,reloading:i}){!i&&this.routes[t]&&this.routes[t].isVolatile&&delete this.routes[t],this.$powerUi.powerTree.allPowerObjsById[e]&&this.$powerUi.powerTree.allPowerObjsById[e].$shared&&this.$powerUi.powerTree.allPowerObjsById[e].$shared.removeElementAndInnersFromPower();const s=document.getElementById(e);s.parentNode.removeChild(s),this.removeCustomCssNode(e),this.$powerUi.controllers[e]&&(i||this.removeVolatileViews({viewId:e}),delete this.$powerUi.controllers[e],this.$powerUi.controllers.$routeSharedScope[t]&&void 0!==this.$powerUi.controllers.$routeSharedScope[t]._instances&&(this.$powerUi.controllers.$routeSharedScope[t]._instances=this.$powerUi.controllers.$routeSharedScope[t]._instances-1,0===this.$powerUi.controllers.$routeSharedScope[t]._instances&&this.$powerUi.controllers.$routeSharedScope.$waitingToDelete.push(t)))}removeMainView({viewId:e,reloading:t}){this.$powerUi.powerTree&&(t||this.removeVolatileViews({viewId:e}),this.removeCustomCssNode(e),this.$powerUi.powerTree.allPowerObjsById[e].$shared.removeInnerElementsFromPower())}removeVolatileViews({viewId:e}){if(this.$powerUi.controllers[e]&&this.$powerUi.controllers[e].instance&&this.$powerUi.controllers[e].instance.volatileRouteIds&&this.$powerUi.controllers[e].instance.volatileRouteIds.length)for(const t of this.$powerUi.controllers[e].instance.volatileRouteIds)delete this.routes[t]}removeCustomCssNode(e){const t=document.getElementById("_css"+e);if(t){const e=t.parentNode;e&&e.removeChild(t)}}loadRoute({routeId:e,paramKeys:t,viewId:i,ctrl:s,title:n}){const r=this.routes[e].viewId||i;if(s){this.$powerUi.controllers[r]={component:s.component,params:s.params};const i=s.params||{};i.$powerUi=this.$powerUi,i.viewId=r,i.routeId=e,i.title=n,this.$powerUi.controllers[r].instance=new s.component(i),this.$powerUi.controllers[r].instance._viewId=r,this.$powerUi.controllers[r].instance._routeId=e,this.$powerUi.controllers[r].instance._routeParams=t?this.getRouteParamValues({routeId:e,paramKeys:t}):{},this.$powerUi.controllers[r].instance.$root=this.$powerUi.controllers["root-view"]&&this.$powerUi.controllers["root-view"].instance?this.$powerUi.controllers["root-view"].instance:null}if(this.routes[e].template&&!this.config.noRouterViews){if(this.routes[e].viewId&&!document.getElementById(this.routes[e].viewId))throw new Error(`You defined a custom viewId "${this.routes[e].viewId}" to the route "${this.routes[e].route}" but there is no element on DOM with that id.`);if(this.routes[e].templateUrl&&!0!==this.routes[e].templateIsCached)this.$powerUi.loadTemplateUrl({template:this.routes[e].template,viewId:r,currentRoutes:this.currentRoutes,routeId:e,routes:this.routes,title:n});else if(void 0!==this.routes[e].templateComponent&&!0!==this.routes[e].templateIsCached)this.$powerUi.loadTemplateComponent({template:this.routes[e].template,viewId:r,currentRoutes:this.currentRoutes,routeId:e,routes:this.routes,title:n,$ctrl:this.$powerUi.controllers[r].instance});else if(void 0!==this.routes[e].templateComponent&&this.routes[e].$tscope){this.routes[e].$tscope&&this.routes[e].$tscope.css&&(this.routes[e].$tscope._viewId=r,this.routes[e].$tscope.appendCss());const t=this;this.routes[e].$tscope._template().then((function(i){const s=i;t.$powerUi.loadTemplate({template:s,viewId:r,currentRoutes:t.currentRoutes,routeId:e,routes:t.routes,title:n})})).catch((function(t,i){window.console.log("loadRoute fails",t,e)}))}else this.$powerUi.loadTemplate({template:this.routes[e].template,viewId:r,currentRoutes:this.currentRoutes,routeId:e,routes:this.routes,title:n})}if(this.routes[e].callback)return this.routes[e].callback.call(this,this.routes[e])}loadSecundaryOrHiddenRoute({routeId:e,paramKeys:t,routeViewId:i,ctrl:s,title:n}){s&&(s.params||(s.params={}),this.$powerUi.controllers.$routeSharedScope[e]||(this.$powerUi.controllers.$routeSharedScope[e]={},this.$powerUi.controllers.$routeSharedScope[e]._instances=0),this.$powerUi.controllers.$routeSharedScope[e]._instances=this.$powerUi.controllers.$routeSharedScope[e]._instances+1,s.params.$shared=this.$powerUi.controllers.$routeSharedScope[e]);const r=document.createElement("div"),o=getIdAndCreateIfDontHave(r);return r.id=o,r.classList.add("power-view"),document.getElementById(i).appendChild(r),this.loadRoute({title:n,routeId:e,paramKeys:t,viewId:o,ctrl:this.routes[e].ctrl,title:this.routes[e].title}),o}routeKind(e){return this.routes[e].hidden?"hr":"sr"}openRoute({routeId:e,params:t,target:i,currentRouteId:s,currentViewId:n,title:r}){const o=this.routeKind(e),a=this.getRouteParamKeysWithoutDots(this.routes[e].route);if(a)for(const i of a)if(!t||!t[i])throw`The parameter "${i}" of route "${e}" is missing!`;if(!this.routeExists({routeId:e,params:t}))if("_self"===i){const i=this.getOpenedRoute({routeId:s,viewId:n}),l=this.getOpenedSecundaryOrHiddenRoutesHash({filter:[i.route]})+`?${o}=${this.buildHash({routeId:e,params:t,paramKeys:a})}`;this.navigate({hash:l,title:r})}else if("_blank"===i){const i=this.getOpenedSecundaryOrHiddenRoutesHash({})+`?${o}=${this.buildHash({routeId:e,params:t,paramKeys:a})}`;this.navigate({hash:i,title:r})}else this.navigate({hash:this.buildHash({routeId:e,params:t,paramKeys:a}),title:r,isMainView:!0})}getOpenedSecundaryOrHiddenRoutesHash({filter:e=[]}){const t=this.extractRouteParts(this.locationHashWithHiddenRoutes());let i=t.path.replace(this.config.rootPath,"");for(let s of t.secundaryRoutes.concat(t.hiddenRoutes)){const n=t.hiddenRoutes.includes(s)?"hr":"sr";s=s.replace(this.config.rootPath,""),0!==e.lenght&&e.includes(s)||(i+=`?${n}=${s}`)}return i}navigate({hash:e,title:t,isMainView:i}){const s=this.extractRouteParts(e);let n=s.path||"",r="";for(const e of s.secundaryRoutes)n=`${n}?sr=${e.replace(this.config.rootPath,"")}`;for(const e of s.hiddenRoutes)r=`${r}?hr=${e.replace(this.config.rootPath,"")}`;this.hiddenLocationHash=encodeURI(r),window.location.hash!==encodeURI(this.config.rootPath+n)?(window.history.pushState(null,t,window.location.href),window.location.replace(encodeURI(this.config.rootPath)+encodeURI(n)),i&&window.scrollTo(0,0)):this.hashChange()}buildHash({routeId:e,params:t,paramKeys:i}){let s=this.routes[e].route.slice(3,this.routes[e].length);if(t&&i.length)for(const e of i)s=s.replace(`:${e}`,t[e]);return s}routeExists({routeId:e,params:t}){let i=!1;if(e===this.currentRoutes.id){if(!t)return!0;let e=!1;for(const s of Object.keys(t||{})){for(const i of this.currentRoutes.params)s===i.key&&t[s]===i.value&&(e=!0);i=e,e=!1}if(i)return!0}for(const s of this.currentRoutes.secundaryRoutes.concat(this.currentRoutes.hiddenRoutes))if(e===s.id){let e=!1;for(const n of Object.keys(t||{})){for(const i of s.params)n===i.key&&t[n]===i.value&&(e=!0);i=e,e=!1}}return i}setMainRouteState({routeId:e,paramKeys:t,route:i,viewId:s,title:n}){this.currentRoutes.id=e,this.currentRoutes.route=i.replace(this.config.rootPath,""),this.currentRoutes.viewId=this.routes[e].viewId||s,this.currentRoutes.isMainView=!0,this.currentRoutes.title=n,this.currentRoutes.params=t?this.getRouteParamValues({routeId:e,paramKeys:t}):[]}setSecundaryOrHiddenRouteState({routeId:e,paramKeys:t,route:i,viewId:s,title:n}){const r={title:n,isMainView:!1,params:[],id:"",route:i.replace(this.config.rootPath,""),viewId:this.routes[e].viewId||s};return r.id=e,t&&(r.params=this.getRouteParamValues({routeId:e,paramKeys:t,route:i})),r}extractRouteParts(e){const t={path:e,secundaryRoutes:[],hiddenRoutes:[]};if(e.includes("?")){const i=e.split("?");t.path=i[0];for(const e of i)if(e.includes("sr="))for(const i of e.split("sr="))i&&t.secundaryRoutes.push(this.config.rootPath+i);else if(e.includes("hr="))for(const i of e.split("hr="))i&&t.hiddenRoutes.push(this.config.rootPath+i)}return t}buildRegExPatternToRoute(e,t){let i=new RegExp(`^${this.routes[e].route}$`);if(t){let e=i.toString();e=e.substring(1),e=e.slice(0,-1);for(const i of t)e=e.replace(i,"[^]*");i=new RegExp(e)}return i}getRoute({routeId:e}){return this.routes[e]}getOpenedRoute({routeId:e,viewId:t}){if(this.currentRoutes.id===e&&this.currentRoutes.viewId)return this.currentRoutes;for(const i of this.currentRoutes.secundaryRoutes.concat(this.currentRoutes.hiddenRoutes))if(i.id===e&&i.viewId===t)return i}getRouteParamKeys(e){const t=new RegExp(/:[^\s/]+/g);return e.match(t)}getRouteParamKeysWithoutDots(e){const t=[];for(const i of this.getRouteParamKeys(e)||[])t.push(i.substring(1));return t}getRouteParamValues({routeId:e,paramKeys:t,route:i}){const s=this.routes[e].route.split("/"),n=(i||this.locationHashWithHiddenRoutes()||this.config.rootPath).split("/"),r=[];for(const e of t)r.push({key:e.substring(1),value:n[s.indexOf(e)]});return r}getParamValue(e){const t=this.currentRoutes.params.find(t=>t.key===e);return t?t.value:null}}class PowerTemplate extends PowerScope{constructor({$powerUi:e,viewId:t,routeId:i,$ctrl:s}){if(super({$powerUi:e}),this._viewId=t,this._routeId=i,this.$ctrl=s,this.css){const e=this;new Promise(this.css.bind(this)).then((function(t){e.response=t,e.appendCss()})).catch((function(e){console.log("catch",e)}))}return{template:this._template(),component:this}}_template(){return new Promise(this.template.bind(this))}appendCss(){const e=document.getElementsByTagName("head")[0];let t=document.createElement("style");t.innerHTML=this.response,t.id="_css"+this._viewId,e.appendChild(t)}}export{PowerTemplate};class PowerInterpolation{constructor(e={},t){this.config=e,this.$powerUi=t,this.startSymbol=e.interpolateStartSymbol||"{{",this.endSymbol=e.interpolateEndSymbol||"}}"}compile({template:e,scope:t,view:i}){return!t&&i&&(t=!!(i&&i.id&&this.$powerUi.controllers[i.id])&&this.$powerUi.controllers[i.id].instance),this.replaceInterpolation(e,t)}getDatasetResult(e,t){return this.compile({template:`${this.startSymbol} ${this.decodeHtml(e)} ${this.endSymbol}`,scope:t})}standardRegex(){const e=`${this.startSymbol}[^]*?${this.endSymbol}`;return new RegExp(e,"gm")}replaceInterpolation(e,t){const i=(e=this.stripWhiteChars(e)).replace(/<!--[\s\S]*?-->/gm,"").match(this.standardRegex());if(i)for(const s of i){const i=this.getInterpolationValue(s,t);e=e.replace(s,i)}return e.trim()}stripWhiteChars(e){let t=e.replace(/ +(?= )/g,"");return t=t.replace(/[\t\n\r]/g,""),t}stripInterpolation(e){let t=e.replace(this.startSymbol,"");return t=t.replace(this.endSymbol,""),t}replaceWith({entry:e,oldValue:t,newValue:i}){const s=new RegExp(t,"gm"),n=e.match(this.standardRegex());if(n)for(const t of n){let n=t.replace(s,i);e=e.replace(t,n)}return e=this.replaceIdsAndRemoveInterpolationSymbol({entry:e,regexOldValue:s,newValue:i})}replaceIdsAndRemoveInterpolationSymbol({entry:e,regexOldValue:t,newValue:i}){const s=document.createElement("div");s.innerHTML=e;for(const e of s.children){for(const s of e.attributes)(s.name.includes("data-pow")||s.name.includes("data-pwc"))&&(s.value=s.value.replace(t,i));e.id&&(e.id=this.replaceInterpolation(e.id,this.$powerUi)),e.children.length&&(e.innerHTML=this.replaceIdsAndRemoveInterpolationSymbol({entry:e.innerHTML,regexOldValue:t,newValue:i}))}return s.innerHTML}getInterpolationValue(e,t){let i=this.stripWhiteChars(e);return i=this.stripInterpolation(i),this.encodeHtml(this.safeEvaluate(i,t))}safeEvaluate(e,t){let i;try{i=this.$powerUi.safeEval({text:e,scope:t,$powerUi:this.$powerUi})}catch(e){i=""}return void 0===i?"":i}safeString(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}encodeHtml(e){const t=document.createElement("div");return t.innerText=t.textContent=e,e=t.innerHTML}decodeHtml(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}}class PowerView extends _PowerBasicElementWithEvents{constructor(e){super(e),this.isView=!0}}PowerUi.injectPowerCss({name:"power-view",isMain:!0});class SyntaxTree{constructor({counter:e}){this.currentPriority=0,this.nodes=[],this.tokensListener=new TokensListener({counter:e,syntaxTree:this}),this.validAfter={variable:this.variableValidation,string:this.stringValidation,parentheses:this.parenthesesValidation,dot:this.dotValidation,integer:this.numberValidation,float:this.numberValidation,operator:this.operationValidation,equal:this.equalityValidation,"NOT-equal":this.equalityValidation,"greater-than":this.equalityValidation,"minor-than":this.equalityValidation,"minor-or-equal":this.equalityValidation,"greater-or-equal":this.equalityValidation,object:this.objectValidation,function:this.objectValidation,anonymousFunc:this.objectValidation,dictNode:this.objectValidation,comma:this.commaValidation,AND:this.orAndNotValidation,OR:this.orAndNotValidation,NOT:this.orAndNotValidation,"NOT-NOT":this.orAndNotValidation,"short-hand":this.shortHandValidation,dictDefinition:()=>!0,arrayDefinition:()=>!0}}buildTreeLeaf(e){this.tree=this.checkAndPrioritizeSyntax({nodes:this.nodes,isParameter:e})}shortHandValidation({currentNode:e,isParameter:t}){return!(e.condition[0]&&e.condition[0].expression_nodes&&!e.condition[0].expression_nodes.length)&&(!(e.if[0]&&e.if[0].expression_nodes&&!e.if[0].expression_nodes.length)&&!(e.else[0]&&e.else[0].expression_nodes&&!e.else[0].expression_nodes.length))}firstNodeValidation({node:e,isParameter:t}){return!["dot","anonymousFunc","AND","OR","NOT-equal","minor-or-equal","greater-or-equal","equal","minor-than","greater-than"].includes(e.syntax)&&("operator"!==e.syntax||"+"===e.label||"-"===e.label)}orAndNotValidation({nextNode:e,isParameter:t}){return!!["string","variable","integer","object","float","dictNode","parentheses","NOT","NOT-NOT","function"].includes(e.syntax)||"operator"===e.syntax&&("+"===e.label||"-"===e.label)}commaValidation({nextNode:e,isParameter:t}){return!!["string","variable","integer","object","float","dictNode","parentheses","arrayDefinition","dictDefinition","NOT","NOT-NOT","comma","function","end"].includes(e.syntax)||"operator"===e.syntax&&("+"===e.label||"-"===e.label)}objectValidation({nextNode:e,isParameter:t}){return!!(["operator","anonymousFunc","short-hand","NOT-equal","equal","minor-than","greater-than","minor-or-equal","greater-or-equal","dot","AND","OR","dictNode","end"].includes(e.syntax)||"comma"===e.syntax&&t)}equalityValidation({nextNode:e,currentNode:t,isParameter:i}){return!!["variable","parentheses","function","arrayDefinition","dictDefinition","float","integer","dictNode","object","NOT","NOT-NOT","string"].includes(e.syntax)||("string"===e.syntax&&"+"===t.label||"operator"===e.syntax&&("+"===e.label||"-"===e.label))}operationValidation({nextNode:e,currentNode:t,isParameter:i}){return!!["NOT","NOT-NOT","float","object","integer","variable","dictNode","arrayDefinition","dictDefinition","parentheses","function"].includes(e.syntax)||("string"===e.syntax&&"+"===t.label||"operator"===e.syntax&&("+"===e.label||"-"===e.label))}variableValidation({nextNode:e,isParameter:t}){return!!(["dot","operator","NOT-equal","equal","minor-than","greater-than","minor-or-equal","greater-or-equal","AND","OR","short-hand","end"].includes(e.syntax)||"comma"===e.syntax&&t)}numberValidation({nextNode:e,isParameter:t}){return!!(["operator","NOT-equal","equal","minor-than","greater-than","AND","minor-or-equal","greater-or-equal","OR","short-hand","end"].includes(e.syntax)||"comma"===e.syntax&&t)}stringValidation({nextNode:e,isParameter:t}){return!["NOT","NOT-NOT","string","variable","dictNode","function","parentheses","arrayDefinition","dictDefinition","integer","float","especial","anonymousFunc","dot","dictNode"].includes(e.syntax)&&(e.syntax,!0)}parenthesesValidation({nextNode:e,isParameter:t}){return!!(["anonymousFunc","dot","operator","short-hand","NOT-equal","equal","minor-or-equal","greater-or-equal","minor-than","greater-than","AND","OR","short-hand","end"].includes(e.syntax)||"comma"===e.syntax&&t)}dotValidation({nextNode:e,isParameter:t}){return!!["function","variable","dictNode"].includes(e.syntax)}isNextValidAfterCurrent({currentNode:e,nextNode:t,isParameter:i}){return!!this.validAfter[e.syntax]&&this.validAfter[e.syntax]({currentNode:e,nextNode:t,isParameter:i})}checkAndPrioritizeSyntax({nodes:e,isParameter:t}){let i=[],s=[],n=[],r=!1;if((e=this.filterNodesAndUnifyObjects(e)).push({syntax:"end"}),!e.length)return[];let o=0;const a=e.length-1;let l=!0;if(l=this.firstNodeValidation({node:this.getCurrentNode({index:0,nodes:e})}),!1===l)throw`PowerUI template invalid syntax: "${e[0].label}" starting the expression.`;for(;o<=a&&l;){const a=this.getCurrentNode({index:o,nodes:e});if(l=this.isNextValidAfterCurrent({currentNode:a,nextNode:this.getNextNode({index:o,nodes:e}),isParameter:t}),!1===l&&"end"!==a.syntax)throw`PowerUI template invalid syntax: "${a.label}".`;const c=this.createExpressionGroups({index:o,currentNode:a,previousNode:this.getPreviousNode({index:o,nodes:e}),nextNode:this.getNextNode({index:o,nodes:e}),current_expression_nodes:i,priority_nodes:s,expression_groups:n,doubleOperator:r});s=c.priority_nodes,i=c.current_expression_nodes,n=c.expression_groups,r=c.doubleOperator,o+=1}return n=this.prioritizeExpressionGroups({priority:"equality",expression_groups:n}),n=this.prioritizeExpressionGroups({priority:"AND",expression_groups:n}),n.pop(),n}createExpressionGroups({index:e,currentNode:t,previousNode:i,nextNode:s,current_expression_nodes:n,priority_nodes:r,expression_groups:o,doubleOperator:a}){if("operator"===t.syntax&&0===e?(r.push(t),a=!0):"operator"===t.syntax&&"operator"===i.syntax?(r.push(t),a=!0):["integer","float","string","variable","parentheses","object","short-hand","dictDefinition","arrayDefinition"].includes(t.syntax)?"operator"===s.syntax&&"+"!==s.label&&"-"!==s.label||"operator"===i.syntax&&"+"!==i.label&&"-"!==i.label?r.push(t):a?(r.push(t),a=!1):n.push(t):"operator"===t.syntax&&("+"!==t.label&&"-"!==t.label?r.push(t):(r.length&&(n.push({priority:r}),r=[]),n.push(t))),["NOT-equal","equal","greater-than","minor-than","minor-or-equal","greater-or-equal","OR","AND","end"].includes(t.syntax)){const e=["OR","AND"].includes(t.syntax)?t.syntax:"equality";r.length&&(n.push({priority:r}),r=[]);const i={kind:"expression",expression_nodes:n};o.push(i),n=[],t.kind="end"===t.syntax?"end":e,o.push(t)}return{priority_nodes:r,current_expression_nodes:n,expression_groups:o,doubleOperator:a}}prioritizeExpressionGroups({priority:e,expression_groups:t}){let i=[],s=[],n=!1;for(const r of t)"end"===r.syntax&&s.length?(i.length?i.push({priority:s}):i=s,i.push(r),s=[]):r.kind===e?(n=!0,s.push(r)):!r.priority&&"expression"!==r.kind&&n&&s.length?(i.push({priority:s}),i.push(r),s=[],n=!1):"OR"===r.syntax||"AND"===r.syntax?(i.push({priority:s}),i.push(r),s=[]):s.push(r);return i}getCurrentNode({index:e,nodes:t}){return t[e]}getPreviousNode({index:e,nodes:t}){return t[e-1]||{syntax:"end"}}getNextNode({index:e,nodes:t}){return t[e+1]||{syntax:"end"}}filterNodesAndUnifyObjects(e){const t=[];let i=this.newObject(),s=e.length-1,n=!1;for(;e[s];){if("empty"!==e[s].syntax)if(["function","dictNode","anonymousFunc"].includes(e[s].syntax)){i.parameters.unshift(e[s]);let t=e[s].label;"function"===e[s].syntax&&(t+="()"),i.label=t+i.label,n=!0}else n&&(t.unshift(i),n=!1,i=this.newObject()),t.unshift(e[s]);else n&&(t.unshift(i),n=!1,i=this.newObject());s-=1}return n&&(t.unshift(i),n=!1,i=this.newObject()),t}newObject(){return{syntax:"object",label:"",parameters:[]}}}class PowerLexer{constructor({text:e,tokensTable:t,counter:i,isParameter:s}){this.isParameter=s,this.originalText=String(e),this.syntaxTree=new SyntaxTree({counter:i}),this.tokens=[]}scan(){for(const e of this.originalText){const t=this.convertToToken(e);this.tokens.push(t)}this.tokens.push({name:"end",value:null})}convertToToken(e){for(const t of this.tokensTable)if(t.values.includes(e))return{name:t.name,value:e};return{name:"undefined",value:e}}}class PowerTemplateParser extends PowerLexer{constructor({text:e,tokensTable:t,counter:i,isParameter:s}){super({text:e,tokensTable:t,counter:i||0,isParameter:s}),this.counter=i||0,this.tokensTable=t||[{name:"blank",values:[" ","\t","\n"]},{name:"escape",values:["\\"]},{name:"especial",values:["_","$"]},{name:"quote",values:['"',"`","'"]},{name:"braces",values:["{","}"]},{name:"separator",values:["(",")","[","]"]},{name:"operator",values:["+","-","*","/","%"]},{name:"equal",values:["="]},{name:"minor-than",values:["<"]},{name:"greater-than",values:[">"]},{name:"NOT",values:["!"]},{name:"AND",values:["&"]},{name:"OR",values:["|"]},{name:"comma",values:","},{name:"dot",values:["."]},{name:"short-hand",values:["?",":"]},{name:"number",values:["0","1","2","3","4","5","6","7","8","9"]},{name:"letter",values:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{name:"end",values:[null]}],this.buildSyntaxTree()}buildSyntaxTree(){this.scan(),this.syntaxTree.buildTreeLeaf(this.isParameter||!1)}scan(){let e=this.counter;for(const t of this.originalText){const i=this.convertToToken(t);this.tokens.push(i),this.syntaxTree.tokensListener.read({token:i,counter:e}),e+=1}const t=this.convertToToken(null);this.tokens.push(t),this.syntaxTree.tokensListener.read({token:t,counter:e})}}class TokensListener{constructor({counter:e,syntaxTree:t}){this.syntaxTree=t,this.currentTokens=[],this.currentLabel="",this.start=e,this.patterns=[{name:"empty",obj:EmptyPattern},{name:"string",obj:StringPattern},{name:"arrayDefinition",obj:ArrayDefinitionPattern},{name:"variable",obj:VariablePattern},{name:"number",obj:NumberPattern},{name:"operator",obj:OperationPattern},{name:"equal",obj:EqualPattern},{name:"minor-than",obj:MinorThanPattern},{name:"greater-than",obj:GreaterThanPattern},{name:"NOT",obj:NotPattern},{name:"AND",obj:AndPattern},{name:"OR",obj:OrPattern},{name:"comma",obj:CommaPattern},{name:"dot",obj:DictPattern},{name:"braces",obj:BracesPattern},{name:"separator",obj:DictPattern},{name:"short-hand",obj:ShortHandPattern},{name:"parentheses",obj:parenthesesPattern}],this.candidates=[],this.checking="firstToken",this.resetCandidates()}read({token:e,counter:t}){for(const i of this.candidates)if(i.instance[this.checking]({token:e,counter:t})){this.currentTokens.push(e),this.currentLabel=this.currentLabel+(e.value||(null===e.value?"":e.value));break}}nextPattern({token:e,counter:t,syntax:i,parameters:s}){this.syntaxTree.nodes.push({syntax:i,label:this.currentLabel,tokens:this.currentTokens,start:this.start,end:t,parameters:s||[]}),this.start=t,this.currentTokens=[],this.currentLabel="",this.checking="firstToken",this.resetCandidates(),this.read({token:e,counter:t})}resetCandidates(){this.candidates=[];for(const e of this.patterns)this.candidates.push({name:e.name,instance:new e.obj(this)})}}class ParserEval{constructor({text:e,nodes:t,scope:i,$powerUi:s,valueToSet:n}){this.$powerUi=s,this.$scope=i||{},this.nodes=t||new PowerTemplateParser({text:e}).syntaxTree.tree,this.currentValue="",this.operator="",this.doubleOperator="",this.lastNode="",this.currentNode="",this.nextNode="",this.equality="$_not_Setted_$",this.leftExpressionValueToCompare="$_not_Setted_$",this.rightExpressionValueToCompare="$_not_Setted_$",this.evalNodes(n)}evalNodes(e){let t=0;for(let i of this.nodes){if(i.expression_nodes)for(const s of i.expression_nodes)this.currentNode=s,this.nextNode=i.expression_nodes[t+1],"short-hand"===s.syntax?this.evalShortHandExpression(s):"dictDefinition"===s.syntax?this.evalDictDefinition(s):"variable"===s.syntax&&["true","false","null","undefined"].includes(s.label)?this.evalSpecialValues(s.label):this.eval(s,e),this.lastNode=s;else"equality"===i.kind||["===","!==","==","!=",">=","<=",">","<"].includes(i.label)?(this.leftExpressionValueToCompare=this.currentValue,this.currentValue="",this.equality=i):["OR","AND"].includes(i.syntax)?(this.leftExpressionValueToCompare=this.currentValue,this.currentValue="",this.orAndExpression=i):this.nodes[t+1]&&"OR"===this.nodes[t+1].syntax&&i.priority&&i.priority[0]&&i.priority[0].priority?i.priority.length>1?this.currentValue=this.recursiveEval(i.priority):this.currentValue=this.recursiveEval(i.priority[0].priority):this.nodes[t-1]&&"OR"===this.nodes[t-1].syntax&&i.priority&&i.priority[0]&&i.priority[0].priority?i.priority.length>1?this.currentValue=this.recursiveEval(i.priority):this.currentValue=this.recursiveEval(i.priority[0].priority):this.nodes[t+1]&&"AND"===this.nodes[t+1].syntax&&i.priority?this.currentValue=this.recursiveEval(i.priority):this.nodes[t-1]&&"AND"===this.nodes[t-1].syntax&&i.priority?this.currentValue=this.recursiveEval(i.priority):console.log("NO EXPRESSION_NODES!!",this.currentValue,i,this.nodes);this.equality&&""!==this.currentValue&&"$_not_Setted_$"!==this.leftExpressionValueToCompare?this.evalEquality():this.orAndExpression&&"OR"===this.orAndExpression.syntax&&""!==this.currentValue&&"$_not_Setted_$"!==this.leftExpressionValueToCompare?this.evalOrExpression():this.orAndExpression&&"AND"===this.orAndExpression.syntax&&""!==this.currentValue&&"$_not_Setted_$"!==this.leftExpressionValueToCompare&&this.evalAndExpression(),t+=1}}evalDictDefinition(e){this.currentValue={};for(const t of e.parameters)this.currentValue[this.recursiveEval(t.key)]=this.recursiveEval(t.value)}evalArrayDefinition(e){this.currentValue=[];for(const t of e.parameters)this.currentValue.push(this.recursiveEval(t))}evalSpecialValues(e){"true"===e?this.currentValue=!0:"false"===e?this.currentValue=!1:"null"===e?this.currentValue=null:"undefined"===e&&(this.currentValue=void 0)}evalShortHandExpression(e){const t=this.recursiveEval(e.condition),i=this.recursiveEval(e.if),s=this.recursiveEval(e.else);this.currentValue=t?i:s}evalOrExpression(){this.currentValue=this.leftExpressionValueToCompare||this.currentValue,this.leftExpressionValueToCompare="$_not_Setted_$"}evalAndExpression(){this.currentValue=this.leftExpressionValueToCompare&&this.currentValue,this.leftExpressionValueToCompare="$_not_Setted_$"}evalEquality(){"==="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare===this.currentValue:"=="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare==this.currentValue:"!=="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare!==this.currentValue:"!="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare!=this.currentValue:"<="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare<=this.currentValue:">="===this.equality.label?this.currentValue=this.leftExpressionValueToCompare>=this.currentValue:">"===this.equality.label?this.currentValue=this.leftExpressionValueToCompare>this.currentValue:"<"===this.equality.label&&(this.currentValue=this.leftExpressionValueToCompare<this.currentValue),this.leftExpressionValueToCompare="$_not_Setted_$"}eval(e,t){let i="";if("float"===e.syntax)i=parseFloat(e.label),""===this.currentValue?this.currentValue=this.adjustForNegative(i):this.currentValue=this.mathOrConcatValues(i);else if("integer"===e.syntax)i=parseInt(e.label),""===this.currentValue?this.currentValue=this.adjustForNegative(i):this.currentValue=this.mathOrConcatValues(i);else if("operator"===e.syntax)this.operator?"-"===this.operator&&"-"===e.label?this.operator="+":"-"===this.operator&&"+"===e.label?this.operator="-":"+"===this.operator&&"-"===e.label?this.operator="-":"+"===this.operator&&"+"===e.label?this.operator="+":"-"===this.doubleOperator&&"-"===e.label?this.doubleOperator="+":"-"===this.doubleOperator&&"+"===e.label?this.doubleOperator="-":"+"===this.doubleOperator&&"-"===e.label?this.doubleOperator="-":"+"===this.doubleOperator&&"+"===e.label?this.doubleOperator="+":this.doubleOperator=e.label:this.operator=e.label;else if(e.priority||"parentheses"===e.syntax){const t=e.priority?[{expression_nodes:e.priority}]:e.parameters;i=this.recursiveEval(t),this.currentValue=this.mathOrConcatValues(i)}else"variable"===e.syntax?(i=this.getOrSetObjectOnScope(e.label,t),""===this.currentValue?this.currentValue=this.adjustForNegative(i):this.currentValue=this.mathOrConcatValues(i)):"string"===e.syntax?(i=this.removeQuotes(e.label),""===this.currentValue?this.currentValue=this.adjustForNegative(i):this.currentValue=this.mathOrConcatValues(i)):"arrayDefinition"===e.syntax?this.evalArrayDefinition(e):"object"===e.syntax?(i=this.evalOrSetObjectOnScope(e,t),this.currentValue=this.mathOrConcatValues(i)):console.log("NOT NUMBER OR OPERATOR OR PRIORITY OR SHORT-HAND",e);return i}removeQuotes(e){let t="";for(const i of e)['"',"`","'"].includes(i)||(t+=i);return t}evalOrSetObjectOnScope(e,t){let i="",s="",n="",r="",o="",a=0;for(const t of e.parameters){let e="";if("function"===t.syntax?e=t.label:"dictNode"===t.syntax?e=this.recursiveEval(t.parameters):"anonymousFunc"!==t.syntax&&console.log("NOT FUNCTION or DICTNODE!",t),0===a)i=this.getObjScope(e),o=i,a=1;else if(""===i)return;if("anonymousFunc"!==t.syntax)if(""===s&&i)s=i[e];else{if(!s)return s;s=s[e]}if("function"===t.syntax||"anonymousFunc"===t.syntax){const e=[];for(const i of t.parameters[0].expression_nodes)e.push(this.recursiveEval([{expression_nodes:[i]}]));n=s.apply(i||null,e),s=n}r=e,"object"==typeof s&&(o=s)}return""!==s&&(n=s,s=""),void 0!==t&&(o[r]=t),n}recursiveEval(e){return new ParserEval({nodes:e,scope:this.$scope,$powerUi:this.$powerUi}).currentValue}adjustForNegative(e){return"-"===this.operator&&(e=-e),this.operator="",e}mathOrConcatValues(e){return this.operator&&!1===isNaN(e)&&(Number.isInteger(e)?e=parseInt(e):!1===isNaN(parseFloat(e))&&(e=parseFloat(e))),"-"===this.doubleOperator&&(e=-e,this.doubleOperator=""),"+"===this.operator?e=this.currentValue+e:"-"===this.operator?e=this.currentValue-e:"/"===this.operator?e=this.currentValue/e:"*"===this.operator&&(e=this.currentValue*e),this.operator="",e}getOrSetObjectOnScope(e,t){return void 0!==this.$scope[e]?(void 0!==t&&(this.$scope[e]=t),this.$scope[e]):this.$scope.$root&&void 0!==this.$scope.$root[e]?(void 0!==t&&(this.$scope.$root[e]=t),this.$scope.$root[e]):void 0!==this.$powerUi[e]?(void 0!==t&&(this.$powerUi[e]=t),this.$powerUi[e]):void 0}getObjScope(e){return void 0!==this.$scope[e]?this.$scope:this.$scope.$root&&void 0!==this.$scope.$root[e]?this.$scope.$root:void 0!==this.$powerUi[e]?this.$powerUi:void 0}}class StringPattern{constructor(e){this.listener=e,this.openQuote=null,this.escape=!1,this.invalid=!1}firstToken({token:e,counter:t}){return!!["quote"].includes(e.name)&&(this.openQuote=e.value,this.listener.candidates=this.listener.candidates.filter(e=>"string"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return e.value!==this.openQuote&&"end"!==e.name?("escape"===e.name&&(this.escape=!0),!0):e.value===this.openQuote&&("escape"===e.name?this.escape=!1:(this.openQuote=null,this.listener.checking="endToken"),!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"string",token:e,counter:t}),!1):!0===this.invalid&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class VariablePattern{constructor(e){this.listener=e}firstToken({token:e,counter:t}){return!!["letter","especial"].includes(e.name)&&(this.listener.candidates=this.listener.candidates.filter(e=>"variable"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return!!["letter","especial","number"].includes(e.name)||(["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"variable",token:e,counter:t}),!1):"("===e.value||"["===e.value||"dot"===e.name?(this.listener.checking="firstToken",this.listener.firstNodeLabel=this.listener.currentLabel,this.listener.candidates=[{name:"object",instance:new ObjectPattern(this.listener)}],!0):(this.listener.checking="endToken",!0))}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class BracesPattern{constructor(e){this.listener=e,this.innerObjects=0,this.currentParams="",this.dictDefinition=[],this.currentKey="",this.currentValue=""}firstToken({token:e,counter:t}){return"{"===e.value&&(this.listener.candidates=this.listener.candidates.filter(e=>"braces"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){if(0!==this.innerObjects||"}"!==e.value)return["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","number","letter","operator","dot","separator","undefined","short-hand","braces"].includes(e.name)?(["{","(","["].includes(e.value)?this.innerObjects=this.innerObjects+1:["}",")","]"].includes(e.value)&&(this.innerObjects=this.innerObjects-1),0===this.innerObjects&&(":"===e.value?(this.currentKey=this.currentParams.trim(),this.currentParams="",this.containsQuotes(this.currentKey)||(this.currentKey=`"${this.currentKey}"`),this.currentKey=new PowerTemplateParser({text:this.currentKey,counter:t-this.currentKey.length,isParameter:!0}).syntaxTree.tree):","===e.value&&this.setDictDefinition(t)),(":"!==e.value&&","!==e.value||0!==this.innerObjects)&&(this.currentParams=this.currentParams+e.value),!0):(this.listener.checking="endToken",!0);this.setDictDefinition(t),this.listener.checking="endToken"}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"dictDefinition",token:e,counter:t,parameters:this.dictDefinition}),!1)}containsQuotes(e){return e.indexOf("'")>=0||e.indexOf('"')>=0||e.indexOf("`")>=0}setDictDefinition(e){""!==this.currentParams&&(this.currentValue=this.currentParams,this.currentParams="",this.currentValue=new PowerTemplateParser({text:this.currentValue,counter:e-this.currentValue.length,isParameter:!0}).syntaxTree.tree,this.dictDefinition.push({kind:"keyValue",key:this.currentKey,value:this.currentValue}))}}class NumberPattern{constructor(e){this.listener=e,this.float=!1}firstToken({token:e,counter:t}){return"number"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"number"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return!1===this.float&&"number"===e.name||(!1===this.float&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT-NOT","NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"integer",token:e,counter:t}),!1):!1===this.float&&"."===e.value?(this.float=!0,!0):!0===this.float&&"number"===e.name||(!0===this.float&&["blank","end","operator","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT-NOT","NOT","AND","OR","short-hand","comma"].includes(e.name)?(this.listener.nextPattern({syntax:"float",token:e,counter:t}),!1):(this.listener.checking="endToken",!0)))}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class OperationPattern{constructor(e){this.listener=e}firstToken({token:e,counter:t}){return"operator"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"operator"===e.name),this.openOperator=e.value,this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return["blank","end","letter","especial","number","quote","operator"].includes(e.name)||"("===e.value?(this.listener.nextPattern({syntax:"operator",token:e,counter:t}),!1):(this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class EqualPattern{constructor(e){this.listener=e,this.one=null,this.two=null,this.three=null,this.invalid=!1}firstToken({token:e,counter:t}){return"equal"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"equal"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return null===this.two?"equal"===e.name?(this.two=e.value,!0):(this.invalid=!0,this.listener.checking="endToken",!0):"equal"===e.name?(this.three=e.value,this.listener.checking="endToken",!0):["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"equal",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"equal",token:e,counter:t}),!1):!0!==this.invalid||!["blank","end"].includes(e.name)||(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}}class MinorThanPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"minor-than"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"minor-than"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return"equal"===e.name?(this.listener.checking="endToken",!0):["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"minor-than",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"minor-or-equal",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class GreaterThanPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"greater-than"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"greater-than"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return"equal"===e.name?(this.listener.checking="endToken",!0):["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"greater-than",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"greater-or-equal",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class NotPattern{constructor(e){this.listener=e,this.one=null,this.two=null,this.three=null,this.invalid=!1}firstToken({token:e,counter:t}){return"NOT"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"NOT"===e.name),this.listener.checking="middleTokens",this.one=e.value,!0)}middleTokens({token:e,counter:t}){return null===this.two?"equal"===e.name||"NOT"===e.name?(this.two=e.value,!0):["blank","end","letter","especial","number","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"NOT",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0):(this.three=e.value,"="===this.two&&"equal"===e.name?(this.listener.checking="endToken",!0):"="===this.two&&["blank","end","letter","especial","number","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"NOT-equal",token:e,counter:t}),!1):"!"===this.two&&["blank","end","letter","especial","number","quote"].includes(e.name)?(this.listener.checking="endToken",this.listener.nextPattern({syntax:"NOT-NOT",token:e,counter:t}),!1):"!"===this.two&&"NOT"===e.name?(this.listener.checking="endToken",!0):(this.invalid=!0,this.listener.checking="endToken",!0))}endToken({token:e,counter:t}){return!1===this.invalid&&"="===this.three&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"NOT-equal",token:e,counter:t}),!1):!1===this.invalid&&"!"===this.three&&["blank","end","letter","number","especial","quote"].includes(e.name)?void this.listener.nextPattern({syntax:"NOT-NOT",token:e,counter:t}):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):("!"!==e.value&&(this.invalid=!0),!0)}}class AndPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"AND"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"AND"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return"AND"===e.name?(this.listener.checking="endToken",!0):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"AND",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class OrPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"OR"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"OR"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return"OR"===e.name?(this.listener.checking="endToken",!0):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","letter","number","especial","NOT","NOT-NOT","quote"].includes(e.name)?(this.listener.nextPattern({syntax:"OR",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class ShortHandPattern{constructor(e){this.listener=e,this.currentParams="",this.shortHand={syntax:"short-hand",condition:[],if:[],else:[],label:""},this.counter=0,this.openShortHand=0,this.needCloseShortHand=0,this.parentheses=0,this.brackets=0}firstToken({token:e,counter:t}){return"short-hand"===e.name&&"?"===e.value&&(this.openShortHand=this.openShortHand+1,this.createConditionNode({token:e,counter:t}),!0)}middleTokens({token:e,counter:t}){if(["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","number","letter","operator","dot","separator","undefined"].includes(e.name))return this.currentParams=this.currentParams+e.value,"("===e.value?this.parentheses=this.parentheses+1:"["===e.value?this.brackets=this.brackets+1:")"===e.value?this.parentheses=this.parentheses-1:"]"===e.value&&(this.brackets=this.brackets-1),!0;if("short-hand"===e.name&&":"===e.value)return 0===this.brackets&&0===this.parentheses&&(this.needCloseShortHand=this.needCloseShortHand+1,this.openShortHand===this.needCloseShortHand&&(this.needCloseShortHand=this.needCloseShortHand-1,this.createIfNode({token:e,text:this.currentParams}))),this.currentParams=this.currentParams+e.value,!0;if("short-hand"===e.name&&"?"===e.value){if(0===this.brackets&&0===this.parentheses){if(1===this.openShortHand&&1===this.needCloseShortHand){let i=this.shortHand.label+this.currentParams;return this.listener.syntaxTree.nodes=[{syntax:"temp",label:i}],this.shortHand={syntax:"short-hand",condition:[],if:[],else:[],label:""},this.openShortHand=this.openShortHand-1,this.needCloseShortHand=this.needCloseShortHand-1,this.counter=0,this.currentParams=this.currentParams+e.value,this.createConditionNode({token:e,counter:t}),!0}this.openShortHand=this.openShortHand+1}return this.currentParams=this.currentParams+e.value,!0}return"end"===e.name?(this.createElseNode({token:e}),!1):(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1)}createConditionNode({token:e}){for(const e of this.listener.syntaxTree.nodes)this.shortHand.label=`${this.shortHand.label}${e.label}`;this.shortHand.condition=new PowerTemplateParser({text:this.shortHand.label,counter:this.counter,isParameter:!0}).syntaxTree.tree,this.listener.syntaxTree.nodes=[],this.listener.candidates=this.listener.candidates.filter(e=>"short-hand"===e.name),this.listener.checking="middleTokens",this.counter=this.shortHand.label.length+1,this.currentParams="",this.fullLabel=this.shortHand.label+e.value}createIfNode({token:e,text:t}){this.shortHand.if=new PowerTemplateParser({text:t,counter:this.counter,isParameter:!0}).syntaxTree.tree,this.shortHand.label=this.fullLabel+this.currentParams,this.counter=this.shortHand.label.length+1,this.currentParams=""}createElseNode({token:e}){this.shortHand.else=new PowerTemplateParser({text:this.currentParams,counter:this.counter,isParameter:!0}).syntaxTree.tree,this.shortHand.label=this.shortHand.label+this.currentParams,this.shortHand.start=0,this.shortHand.end=this.shortHand.label.length,this.listener.syntaxTree.nodes.push(this.shortHand),this.openShortHand=this.openShortHand-1,this.needCloseShortHand=this.needCloseShortHand-1}}class CommaPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){return"comma"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"comma"===e.name),this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){return!1===this.invalid&&["blank","end","especial","separator","operator","quote","equal","NOT","NOT-NOT","comma","number","letter"].includes(e.name)?(this.listener.nextPattern({syntax:"comma",token:e,counter:t}),!1):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class DictPattern{constructor(e){this.listener=e,this.invalid=!1}firstToken({token:e,counter:t}){if("dot"===e.name&&0===this.listener.syntaxTree.nodes.length){this.listener.checking="endToken",this.listener.firstNodeLabel=this.listener.currentLabel;const e=new ObjectPattern(this.listener);return e.invalid=!0,this.listener.candidates=[{name:"object",instance:e}],!0}if("dot"===e.name||"["===e.value){this.listener.checking="firstToken",this.listener.firstNodeLabel=this.listener.currentLabel;const e=new ObjectPattern(this.listener);return e.anonymous=!0,this.listener.candidates=[{name:"object",instance:e}],!0}return!1}}class parenthesesPattern{constructor(e){this.listener=e,this.invalid=!1,this.nodes=[],this.currentOpenChar=null,this.currentParams="",this.currentParamsCounter=null,this.innerOpenedParenteses=0,this.anonymous=!1}firstToken({token:e,counter:t}){if(this.currentOpenChar=e.value,"("!==this.currentOpenChar||this.listener.isAnonymousFunc){if(!0===this.listener.isAnonymousFunc){this.listener.checking="firstToken",this.listener.firstNodeLabel=this.listener.currentLabel;const e=new ObjectPattern(this.listener);return e.anonymous=!0,this.listener.candidates=[{name:"object",instance:e}],this.listener.isAnonymousFunc=!1,!0}return!1}return this.listener.candidates=this.listener.candidates.filter(e=>"parentheses"===e.name),this.listener.checking="middleTokens",null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0}middleTokens({token:e,counter:t}){return")"===e.value&&0===this.innerOpenedParenteses?(this.listener.checking="endToken",!0):["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator","braces","undefined"].includes(e.name)?(this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),"("===e.value?this.innerOpenedParenteses=this.innerOpenedParenteses+1:")"===e.value&&(this.innerOpenedParenteses=this.innerOpenedParenteses-1),!0):this.innerOpenedParenteses>=0&&"end"===e.name?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0)}endToken({token:e,counter:t}){if(!1===this.invalid){if(["blank","end","dot","operator"].includes(e.name)){const i=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return this.listener.nextPattern({syntax:this.anonymous?"anonymousFunc":"parentheses",token:e,counter:t,parameters:i}),!1}if("("===e.value){const e=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return this.listener.syntaxTree.nodes.push({syntax:this.anonymous?"anonymousFunc":"parentheses",label:this.listener.currentLabel,tokens:this.listener.currentTokens,start:this.listener.start,end:t,parameters:e||[]}),this.listener.start=t,this.listener.currentTokens=[],this.currentParams=[],this.listener.currentLabel="",this.anonymous=!0,this.listener.checking="middleTokens",!0}return this.invalid=!0,!0}return!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}}class ArrayDefinitionPattern{constructor(e){this.listener=e,this.invalid=!1,this.nodes=[],this.innerOpenedObjects=0,this.currentParams="",this.arrayContent=[],this.currentParamsCounter=null}firstToken({token:e,counter:t}){const i=this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1];return!("["!==e.value||i&&"dictNode"===i.syntax)&&(this.listener.candidates=this.listener.candidates.filter(e=>"arrayDefinition"===e.name),this.listener.checking="middleTokens",null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0)}middleTokens({token:e,counter:t}){return"]"===e.value&&0===this.innerOpenedObjects?(this.listener.checking="endToken",""!==this.currentParams&&this.setArrayItem(),!0):["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator","braces","undefined"].includes(e.name)?(0===this.innerOpenedObjects&&","===e.value?this.setArrayItem():this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),["{","(","["].includes(e.value)?this.innerOpenedObjects=this.innerOpenedObjects+1:["}",")","]"].includes(e.value)&&(this.innerOpenedObjects=this.innerOpenedObjects-1),!0):void 0}endToken({token:e,counter:t}){return!1===this.invalid?["end","blank","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","operator"].includes(e.name)?(this.listener.nextPattern({syntax:"arrayDefinition",token:e,counter:t,parameters:this.arrayContent}),!1):(this.invalid=!0,!0):!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}setArrayItem(){const e=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!1}).syntaxTree.tree;this.arrayContent.push(e),this.currentParams=""}}class ObjectPattern{constructor(e){this.listener=e,this.invalid=!1,this.nodes=[],this.currentOpenChar=null,this.currentParams="",this.currentParamsCounter=null,this.innerOpenedObjects=0,this.anonymous=!1}firstToken({token:e,counter:t}){if(null===e.value){const i=this.listener.currentTokens[this.listener.currentTokens.length-1];if("("===i.value||"["===i.value||"."===i.value)return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1}return this.currentOpenChar=this.listener.currentTokens[this.listener.currentTokens.length-1].value,"("===this.currentOpenChar?")"===e.value?(this.listener.checking="endToken",!0):["blank","end","letter","number","especial","NOT","NOT-NOT","quote","undefined"].includes(e.name)||"-"===e.value||"+"===e.value?(this.listener.checking="middleTokens",this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0):["(","[","{"].includes(e.value)?(this.innerOpenedObjects=this.innerOpenedObjects+1,this.currentParams=this.currentParams+e.value,this.listener.checking="middleTokens",null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0):(this.invalid=!0,this.listener.checking="endToken",!0):"["!==this.currentOpenChar&&"."!==this.currentOpenChar||"separator"===e.name&&"("!==e.value?("dot"===e.name||"separator"===e.name)&&(this.invalid=!0,this.listener.checking="endToken",!0):("."!==this.listener.currentLabel&&"["!==this.listener.currentLabel?(this.listener.firstNodeLabel=this.listener.currentLabel,this.currentParams=`"${this.listener.currentLabel.slice(0,this.listener.currentLabel.length-1)}"`,this.createDictionaryNode({token:e,counter:t}),"."===this.currentOpenChar&&"number"===e.name&&(this.invalid=!0)):this.listener.checking="middleTokens",this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0)}middleTokens({token:e,counter:t}){if("("===this.currentOpenChar&&")"===e.value&&0===this.innerOpenedObjects)return this.listener.checking="endToken",!0;if("("===this.currentOpenChar&&["blank","escape","especial","quote","equal","minor-than","greater-than","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator","braces","undefined"].includes(e.name))return this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),["(","{","["].includes(e.value)?this.innerOpenedObjects=this.innerOpenedObjects+1:[")","}","]"].includes(e.value)&&(this.innerOpenedObjects=this.innerOpenedObjects-1),!0;if("("===this.currentOpenChar&&this.innerOpenedObjects>=0&&"end"===e.name)return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1;if("["===this.currentOpenChar&&"]"===e.value&&0===this.innerOpenedObjects)return this.invalid=!this.currentParams.length,this.listener.checking="endToken",!0;if("."!==this.currentOpenChar||!["blank","end","operator","dot"].includes(e.name)&&"("!==e.value&&"["!==e.value)return"["===this.currentOpenChar&&["blank","escape","especial","quote","equal","NOT-equal","greater-than","minor-than","greater-or-equal","minor-or-equal","NOT","NOT-NOT","AND","OR","comma","short-hand","number","letter","operator","dot","separator"].includes(e.name)?(this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),"["===e.value?this.innerOpenedObjects=this.innerOpenedObjects+1:"]"===e.value&&(this.innerOpenedObjects=this.innerOpenedObjects-1),!0):"."===this.currentOpenChar&&["especial","number","letter"].includes(e.name)?(this.currentParams=this.currentParams+e.value,null===this.currentParamsCounter&&(this.currentParamsCounter=t||null),!0):"["===this.currentOpenChar&&this.innerOpenedObjects>=0&&"end"===e.name?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,this.listener.checking="endToken",!0);{if(this.listener.currentTokens.length>=2&&"dot"===this.listener.currentTokens[0].name&&"number"===this.listener.currentTokens[1].name||this.listener.syntaxTree.nodes.length&&this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1]&&"dictNode"===this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1].syntax&&"."===this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1].tokens[this.listener.syntaxTree.nodes[this.listener.syntaxTree.nodes.length-1].tokens.length-1].value&&"number"===this.listener.currentTokens[0].name)return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1;const i=new PowerTemplateParser({text:`"${this.currentParams}"`,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return this.listener.currentLabel=this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,"("===e.value&&(this.listener.isAnonymousFunc=!0),this.listener.nextPattern({syntax:"dictNode",token:e,counter:t,parameters:i}),!1}}endToken({token:e,counter:t}){if(!1===this.invalid){if(["blank","end","operator","comma","dot"].includes(e.name)){const i=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;return"("===this.currentOpenChar?(this.listener.currentLabel=this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,this.listener.nextPattern({syntax:this.anonymous?"anonymousFunc":"function",token:e,counter:t,parameters:i}),!1):"["===this.currentOpenChar||"."===this.currentOpenChar?(this.listener.currentLabel=this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,this.listener.nextPattern({syntax:"dictNode",token:e,counter:t,parameters:i}),!1):(this.invalid=!0,!0)}return"("!==this.currentOpenChar||"("!==e.value&&"["!==e.value?"["!==this.currentOpenChar||"["!==e.value&&"("!==e.value?(this.invalid=!0,!0):(this.createDictionaryNode({token:e,counter:t}),this.currentOpenChar=e.value,!0):(this.listener.checking="middleTokens",this.createAnonymousFuncNode({token:e,counter:t}),this.currentOpenChar=e.value,!0)}return!0===this.invalid&&["blank","end"].includes(e.name)?(this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1):(this.invalid=!0,!0)}dictHaveInvalidParams(e){return 0===e.length&&(invalid=!0,!0)}createDictionaryNode({token:e,counter:t}){const i=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;if(this.dictHaveInvalidParams(i))return this.listener.nextPattern({syntax:"invalid",token:e,counter:t}),!1;this.listener.syntaxTree.nodes.push({syntax:"dictNode",label:this.listener.firstNodeLabel?this.listener.firstNodeLabel:this.listener.currentLabel,tokens:this.listener.currentTokens,start:this.listener.start,end:t,parameters:i||[]}),this.listener.start=t,this.listener.currentTokens=[],this.currentParams=[],this.listener.currentLabel="",this.listener.firstNodeLabel="",this.anonymous=!0,this.listener.checking="middleTokens"}createAnonymousFuncNode({token:e,counter:t}){const i=new PowerTemplateParser({text:this.currentParams,counter:this.currentParamsCounter,isParameter:!0}).syntaxTree.tree;this.listener.currentLabel=!0===this.anonymous?this.listener.currentLabel:this.listener.firstNodeLabel,this.listener.syntaxTree.nodes.push({syntax:!0===this.anonymous?"anonymousFunc":"function",label:this.listener.currentLabel,tokens:this.listener.currentTokens,start:this.listener.start,end:t,parameters:i||[]}),this.listener.start=t,this.listener.currentTokens=[],this.currentParams=[],this.listener.currentLabel="",this.listener.firstNodeLabel="",this.anonymous=!0,this.listener.checking="middleTokens"}}class EmptyPattern{constructor(e){this.listener=e}firstToken({token:e,counter:t}){return"blank"===e.name&&(this.listener.candidates=this.listener.candidates.filter(e=>"empty"===e.name),this.listener.checking="middleTokens",!0)}middleTokens({token:e,counter:t}){return"blank"===e.name||(this.listener.nextPattern({syntax:"empty",token:e,counter:t}),!1)}}class PowerWidget extends PowerController{constructor({$powerUi:e}){super({$powerUi:e}),this.isWidget=!0}$buildTemplate({template:e,title:t}){const i=document.createElement("div");return this.addBeforeTemplate&&(e=this.addBeforeTemplate+e),i.innerHTML=this.template({$title:t||null}),this.addAfterTemplate&&(e+=this.addAfterTemplate),i.querySelectorAll("[data-pw-content]")[0].innerHTML=e,e=i.innerHTML}}export{PowerWidget};class PowerDialogBase extends PowerWidget{constructor({$powerUi:e,noEsc:t}){if(super({$powerUi:e}),t)return;const i=this;this._closeWindow=function(){i._cancel()},e._events.Escape.subscribe(this._closeWindow)}_cancel(...e){if(this.onCancel){const t=this;new Promise((function(i,s){t.onCancel(i,s,...e)})).then(this.closeCurrentRoute.bind(this)).catch(()=>this.onCancelError?this.onCancelError():null)}else this.closeCurrentRoute()}_commit(...e){if(this.onCommit){const t=this;new Promise((function(i,s){t.onCommit(i,s,...e)})).then(this.closeCurrentRoute.bind(this)).catch(()=>this.onCommitError?this.onCommitError():null)}else this.closeCurrentRoute()}closeCurrentRoute(){const e=document.getElementById(this._viewId);this.$powerUi._events.Escape.unsubscribe(this._closeWindow),e?super.closeCurrentRoute():this.$powerUi._events.Escape.broadcast()}_onViewLoad(e){const t=e.getElementsByClassName("pw-container")[0],i=e.getElementsByClassName("pw-body")[0];t&&(t.scrollTop=this._containerScrollTop||0,t.scrollLeft=this._containerScrollLeft||0),i&&(i.scrollTop=this._bodyScrollTop||0,i.scrollLeft=this._bodyScrollLeft||0)}$buttons(){if(this.commitBt||this.cancelBt){let e="";if(this.commitBt){const t=this.noBt?"Yes":"Ok",i=`<span class="pw-icon ${this.commitBt.icon?this.commitBt.icon:"icon-ok-black"}"></span>`;e+=`<button\n\t\t\t\t\t\t\t\tclass="${this.commitBt.css?this.commitBt.css:"pw-btn-default"}"\n\t\t\t\t\t\t\t\tdata-pow-event onclick="_commit(true)">\n\t\t\t\t\t\t\t\t${!1!==this.commitBt.icon?i:""}\n\t\t\t\t\t\t\t\t<span class="pw-label">\n\t\t\t\t\t\t\t\t\t${this.commitBt.label?this.commitBt.label:t}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</button>`}if(this.noBt){const t=`<span class="pw-icon ${this.noBt.icon?this.noBt.icon:"icon-cancel-black"}"></span>`;e+=`<button\n\t\t\t\t\t\t\t\tclass="${this.noBt.css?this.noBt.css:"pw-btn-default"}"\n\t\t\t\t\t\t\t\tdata-pow-event onclick="_commit(false)">\n\t\t\t\t\t\t\t\t${!1!==this.noBt.icon?t:""}\n\t\t\t\t\t\t\t\t<span class="pw-label">\n\t\t\t\t\t\t\t\t\t${this.noBt.label?this.noBt.label:"No"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</button>`}if(this.cancelBt){const t=this.noBt?"icon-cancel-simple":"icon-cancel-black",i=`<span class="pw-icon ${this.cancelBt.icon?this.cancelBt.icon:t}"></span>`;e+=`<button\n\t\t\t\t\t\t\t\tclass="${this.cancelBt.css?this.cancelBt.css:"pw-btn-default"}"\n\t\t\t\t\t\t\t\tdata-pow-event onclick="_cancel()">\n\t\t\t\t\t\t\t\t${!1!==this.cancelBt.icon?i:""}\n\t\t\t\t\t\t\t\t<span class="pw-label">\n\t\t\t\t\t\t\t\t\t${this.cancelBt.label?this.cancelBt.label:"Cancel"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</button>`}return e}return""}template({$title:e}){return this.$title=this.$title||e,`<div class="pw-title-bar">\n\t\t\t\t\t<span class="pw-title-bar-label">${this.$title}</span>\n\t\t\t\t\t<div data-pow-event onclick="_cancel()" class="pw-bt-close pw-icon icon-cancel-black"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="pw-body">\n\t\t\t\t\t<div class="pw-container" data-pw-content>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="pw-container">\n\t\t\t\t\t\t${this.$buttons()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`}}export{PowerDialogBase};class PowerDialog extends PowerDialogBase{constructor({$powerUi:e}){super({$powerUi:e})}template({$title:e}){return this.$title=this.$title||e,`<div class="pw-dialog pw-dialog-container pw-backdrop">\n\t\t\t\t\t${super.template({$title:e})}\n\t\t\t\t</div>`}}class PowerAlert extends PowerDialog{constructor({$powerUi:e}){super({$powerUi:e}),this.commitBt=!0}}class PowerConfirm extends PowerDialog{constructor({$powerUi:e}){super({$powerUi:e}),this.commitBt=!0,this.cancelBt=!0}}class PowerYesNo extends PowerDialog{constructor({$powerUi:e}){super({$powerUi:e}),this.commitBt=!0,this.noBt=!0,this.cancelBt=!0}}function wrapFunctionInsideDialog({controller:e,kind:t,params:i}){class s extends PowerAlert{constructor({$powerUi:t}){if(super({$powerUi:t}),this.ctrl=e,i)for(const e of Object.keys(i||{}))this[e]=i[e]}}class n extends PowerConfirm{constructor({$powerUi:t}){if(super({$powerUi:t}),this.ctrl=e,i)for(const e of Object.keys(i||{}))this[e]=i[e]}}class r extends PowerYesNo{constructor({$powerUi:t}){if(super({$powerUi:t}),this.ctrl=e,i)for(const e of Object.keys(i||{}))this[e]=i[e]}}class o extends PowerModal{constructor({$powerUi:t}){if(super({$powerUi:t}),this.ctrl=e,i)for(const e of Object.keys(i||{}))this[e]=i[e]}}class a extends PowerWindow{constructor({$powerUi:t}){if(super({$powerUi:t}),this.ctrl=e,i)for(const e of Object.keys(i||{}))this[e]=i[e]}}class l extends PowerWindowIframe{constructor({$powerUi:t}){if(super({$powerUi:t}),this.ctrl=e,i)for(const e of Object.keys(i||{}))this[e]=i[e]}}return"confirm"===t?n:"yesno"===t?r:"modal"===t?o:"window"===t?a:"windowIframe"===t?l:s}export{PowerDialog,PowerAlert,PowerConfirm};class PowerModal extends PowerDialogBase{constructor({$powerUi:e,classList:t}){super({$powerUi:e}),this.isModal=!0,t&&(this.classList=t)}clickOutside(e){e.target.classList.contains("pw-backdrop")&&this._cancel()}template({$title:e}){document.body&&document.body.classList&&document.body.classList.add("modal-open");let t=" ";if(this.classList)for(const e of this.classList)t=`${t} ${e}`;return this.$title=this.$title||e,`<div class="pw-modal pw-backdrop${this.$powerUi.touchdevice?" pw-touchdevice":""}${t}" data-pow-event onclick="clickOutside(event)">\n\t\t\t\t\t${super.template({$title:e})}\n\t\t\t\t</div>`}}export{PowerModal};class PowerTreeTemplate{constructor({$powerUi:e,tree:t,boilerplate:i}){this.boilerplate=i||!1,this.$powerUi=e,this.tree=t,this.template=this.buildTemplate(this.tree)}buildTemplate(e,t){let i=`<nav ${t?'id="'+t+'"':""} class="power-tree-view">`;for(const t of e)if("file"===t.kind)i=this.boilerplate?`${i}\n\t\t\t\t\t<a class="power-item" data-pow-event onclick="_commit({path:'${t.path}'})"><span class="pw-icon document-blank"></span> ${t.fullName}</a>`:`${i}\n\t\t\t\t\t<a class="power-item"><span class="pw-icon document-blank"></span> ${t.fullName}</a>`;else if("folder"===t.kind){const e=`list-${this.$powerUi._Unique.next()}`;i=`${i}\n\t\t\t\t<a class="power-list" data-power-target="${e}">\n\t\t\t\t\t<span class="power-status pw-icon" data-power-active="icon-folder-open" data-power-inactive="icon-folder-close"></span> ${t.fullName}\n\t\t\t\t</a>\n\t\t\t\t${this.buildTemplate(t.content,e)}`}return i=`${i}\n\t\t</nav>`,i}}class PowerWindow extends PowerDialogBase{constructor({$powerUi:e}){super({$powerUi:e,noEsc:!0}),this.isWindow=!0,this._resizeWindow=this.resizeWindow.bind(this),window.addEventListener("resize",this._resizeWindow,!1)}_cancel(...e){window.removeEventListener("resize",this._resizeWindow,!1),super._cancel(e)}_onViewLoad(e){if(this.currentView=e,this.element=this.currentView.getElementsByClassName("pw-window")[0],this.dragElement(),this._top&&this._left&&(this.element.style.top=this._top,this.element.style.left=this._left),this.bodyEl=this.currentView.getElementsByClassName("pw-body")[0],this.resizableEl=this.currentView.getElementsByClassName("pw-window-resizable")[0],this.titleBarEl=this.currentView.getElementsByClassName("pw-title-bar")[0],this.resizeElement(),this._width&&this._height)this.bodyEl.style.width=this._width,this.bodyEl.style.height=this._bodyHeight,this.resizableEl.style.width=this._width,this.resizableEl.style.height=this._height;else{const e=this.bodyEl.offsetHeight+50+"px",t=this.bodyEl.offsetWidth+50+"px";this.bodyEl.style.height=e,this.resizableEl.style.height=e,this.bodyEl.style.width=t,this.resizableEl.style.width=t}this.resizeWindow(),this.windowsOrder(),super._onViewLoad(this.currentView)}template({$title:e}){return this.$title=this.$title||e,`<div class="pw-window${this.$powerUi.touchdevice?" pw-touchdevice":""}">\n\t\t\t\t\t<div class="pw-window-resizable">\n\t\t\t\t\t\t${super.template({$title:e})}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`}resizeElement(){this.bodyEl.onmousedown=this.resizeMouseDown.bind(this)}resizeMouseDown(){this.windowsOrder(!0),document.onmouseup=this.closeDragElement.bind(this),document.onmousemove=this.resizeWindow.bind(this)}resizeWindow(){this._width=this.bodyEl.offsetWidth;const e=this.bodyEl.offsetHeight,t=this.titleBarEl.offsetHeight;this._height=e+t,this._width<130&&(this._width=130),this._height<130&&(this._height=130),this.replaceWindowSizeQuery(),this.replaceMenuBreakQuery(),this._width=`${this._width}px`,this._height=`${this._height}px`,this.resizableEl.style.width=this._width,this.resizableEl.style.height=this._height,this.bodyEl.style.width=this._width,this.bodyEl.style.height=this.resizableEl.offsetHeight-t+"px",this.onResize&&this.onResize()}replaceWindowSizeQuery(){let e=this.currentWindowQuery;e=this._width<=600?"pw-wsize-tinny":this._width>=601&&this._width<=900?"pw-wsize-small":this._width>=901&&this._width<=1200?"pw-wsize-medium":this._width>=1201&&this._width<=1500?"pw-wsize-large":"pw-wsize-extra-large",void 0!==this.currentWindowQuery&&this.currentWindowQuery===e||(this.removeWindowQueries(),this.element.classList.add(e),this.currentWindowQuery=e)}removeWindowQueries(){this.element.classList.remove("pw-wsize-tinny"),this.element.classList.remove("pw-wsize-small"),this.element.classList.remove("pw-wsize-medium"),this.element.classList.remove("pw-wsize-large"),this.element.classList.remove("pw-wsize-extra-large")}replaceMenuBreakQuery(){let e=this.currentMenuBreakQuery;e=this._width<=768&&"pw-menu-break",void 0!==this.currentMenuBreakQuery&&this.currentMenuBreakQuery===e||(this.removeMenuBreakQuery(),e&&this.element.classList.add(e),this.currentMenuBreakQuery=e)}removeMenuBreakQuery(){this.element.classList.remove("pw-menu-break")}dragElement(){this.pos1=0,this.pos2=0,this.pos3=0,this.pos4=0;const e=this.currentView.getElementsByClassName("pw-title-bar")[0];e?e.onmousedown=this.dragMouseDown.bind(this):this.element.onmousedown=this.dragMouseDown.bind(this)}dragMouseDown(e){(e=e||window.event).preventDefault(),this.windowsOrder(!0),this.pos3=e.clientX,this.pos4=e.clientY,document.onmouseup=this.closeDragElement.bind(this),document.onmousemove=this.elementDrag.bind(this)}elementDrag(e){(e=e||window.event).preventDefault(),this.pos1=this.pos3-e.clientX,this.pos2=this.pos4-e.clientY,this.pos3=e.clientX,this.pos4=e.clientY,this.element.style.top=this.element.offsetTop-this.pos2+"px",this.element.style.left=this.element.offsetLeft-this.pos1+"px",this._top=this.element.style.top,this._left=this.element.style.left}closeDragElement(){this.element.classList.add("pw-active"),this.resizeWindow(),this._bodyHeight=window.getComputedStyle(this.bodyEl).height,document.onmouseup=null,document.onmousemove=null}windowsOrder(e){const t=this;this.$powerUi._windowsOrderTimeout||(this.$powerUi._windowsOrderInterval=setTimeout((function(){let i=document.getElementsByClassName("pw-window");const s=t.currentView.getElementsByClassName("pw-window")[0];let n=1002;const r={};for(const e of i){let t=parseInt(e.style.zIndex||n);e!==s&&(r[t]=e,t>=n&&(n=t+1))}const o=Object.keys(r).sort((e,t)=>parseInt(e)-parseInt(t));n=1002;for(const e of o)r[e].style.zIndex=n,n+=1,r[e].classList.remove("pw-active");s.style.zIndex=n+1,e?s.classList.remove("pw-active"):s.classList.add("pw-active")}),10))}}class PowerWindowIframe extends PowerWindow{constructor({$powerUi:e}){super({$powerUi:e,noEsc:!0}),this.isWindow=!0}_onViewLoad(e){this.currentView=e,this.iframe=this.currentView.getElementsByTagName("iframe")[0],super._onViewLoad(e)}resizeWindow(){super.resizeWindow(),this.iframe.style.width=parseInt(this._width.replace("px",""))-10+"px",this.iframe.style.height=parseInt(this._height.replace("px",""))-53+"px"}template({$title:e,$url:t}){this.$title=this.$title||e;const i=`iframe_${this.$powerUi._Unique.next()}`;return`<div class="pw-window${this.$powerUi.touchdevice?" pw-touchdevice":""}">\n\t\t\t\t\t<div class="pw-window-resizable">\n\t\t\t\t\t\t<div class="pw-title-bar">\n\t\t\t\t\t\t\t<span class="pw-title-bar-label">${this.$title}</span>\n\t\t\t\t\t\t\t<div data-pow-event onmousedown="_cancel()" class="pw-bt-close pw-icon icon-cancel-black"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="pw-cover-iframe" data-pow-event onmousedown="dragMouseDown()">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="pw-body pw-body-iframe">\n\t\t\t\t\t\t\t<iframe frameBorder="0" name="${i}" id="${i}" data-pw-content src="${t}">\n\t\t\t\t\t\t\t</iframe>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`}$buildTemplate({template:e,title:t}){return this.template({$title:t||null,$url:e})}}export{PowerWindow,PowerWindowIframe};class AccordionModel{constructor(e){this.ctx=e,this.multipleSectionsOpen="true"===e.element.getAttribute("data-multiple-sections-open")}}class AccordionSectionModel{constructor(e){this.ctx=e,this.active=!1}}class AccordionSectionHtmlCtrl{constructor(e){this.ctx=e}toggle(){if(!this.ctx.powerAccordion.model.multipleSectionsOpen)for(const e of Object.keys(this.ctx.powerAccordion.childrenActions||{})){const t=this.ctx.powerAccordion.childrenActions[e];t.targetObj.id!==this.ctx.powerAccordion.id&&t._$pwActive&&this.ctx!==t.targetObj&&(t.toggle({avoidCallAction:!0}),t.targetObj.model.active=!t.targetObj.model.active)}}}class PowerAccordion extends PowerTarget{constructor(e){super(e),this.model=new AccordionModel(this)}init(){this.childrenSections=this.getChildrenByPowerCss("powerAccordionSection"),this.childrenActions=this.getChildrenByPowerCss("powerAction")}}PowerUi.injectPowerCss({name:"power-accordion"});class PowerAccordionSection extends PowerTarget{constructor(e){super(e),this.model=new AccordionSectionModel(this),this.ctrl="htmlCtrl"}init(){this.htmlCtrl=new AccordionSectionHtmlCtrl(this);let e=this.parent;do{"powerAccordion"===e.$powerCss?this.powerAccordion=e:e=e.parent}while(e&&"powerAccordion"!==e.$powerCss)}action(){this[this.ctrl].toggle()}}PowerUi.injectPowerCss({name:"power-accordion-section"});class PowerList extends PowerTarget{constructor(e){if(super(e),this._target=this.element.dataset.powerTarget,!this._target)throw console.error("power-action/power-list/power-toggle selectors needs a power element target",this.element),'Missing power-action/power-list/power-toggle target. Please define it: data-power-target="power_element_id"'}init(){const e=this.$powerUi.powerTree.allPowerObjsById[this._target];for(const t in e)e[t].powerTarget&&(this.targetObj=e[t]);this.subscribe({event:"click",fn:this.toggle})}toggle(){this._$pwActive?(this._$pwActive=!1,this.targetObj._$pwActive=!1,this.targetObj.element.classList.remove("power-active"),this.element.classList.remove("power-active"),this.$pwMain.isMenu&&this.$pwMain.order>0&&(this.$pwMain.order=this.$pwMain.order-1,0===this.$pwMain.order&&this.$pwMain.element.classList.remove("pw-order"))):(this._$pwActive=!0,this.targetObj._$pwActive=!0,this.targetObj.element.classList.add("power-active"),this.element.classList.add("power-active"),this.$pwMain.isMenu&&(0===this.$pwMain.order&&this.$pwMain.element.classList.add("pw-order"),this.$pwMain.order=this.$pwMain.order+1)),this.broadcast("toggle",!0)}}PowerUi.injectPowerCss({name:"power-list"});class PowerAction extends PowerList{constructor(e){super(e)}init(){super.init(),this.targetObj.powerAction=this}toggle(e={}){this.targetObj.action&&!e.avoidCallAction&&this.targetObj.action(),super.toggle()}ifClickOut(){this._$pwActive?document.removeEventListener("click",this._clickPowerItemOrOutside):(this._clickPowerItemOrOutside=this.clickPowerItemOrOutside.bind(this),document.addEventListener("click",this._clickPowerItemOrOutside))}clickPowerItemOrOutside(e){const t=document.getElementById(this.targetObj.id),i=document.getElementById(this.id);let s=e.target;if(s.classList.contains("power-action")||s.classList.contains("power-toggle")||!s.parentNode||!s.parentNode.classList||s.parentNode.classList.contains("power-action")||s.parentNode.classList.contains("power-toggle")){do{if(s===t||s===i)return;s=s.parentNode}while(s);this.toggle()}else this.toggle()}}PowerUi.injectPowerCss({name:"power-action"});class PowerToggle extends PowerAction{constructor(e){super(e)}}PowerUi.injectPowerCss({name:"power-toggle"});class PowerBrand extends PowerTarget{constructor(e){super(e),this.id=this.element.getAttribute("id")}}PowerUi.injectPowerCss({name:"power-brand"});class PowerDropmenu extends PowerTarget{constructor(e){super(e),this.defaultPosition=this.element.getAttribute("data-power-position")||"bottom-right",this._markRootAndMenuDropmenu()}init(){if(this.childrenPowerActions=this.getChildrenByPowerCss("powerAction"),this.innerPowerActionsWithoutChildren=this.getInnerWithoutChildrenByPowerCss("powerAction"),this.childrenPowerItems=this.getChildrenByPowerCss("powerItem"),this.innerPowerItemsWithoutChildren=this.getInnerWithoutChildrenByPowerCss("powerItem"),this.innerPowerDropmenus=this.getInnerByPowerCss("powerDropmenu"),this.isRootElement&&!this.isMenuElement){defineRootDropmenusPosition(this,this);for(const e of this.innerPowerDropmenus)defineInnerDropmenusPosition(this,e)}}_markRootAndMenuDropmenu(){const e=PowerTree._searchUpDOM(this.element,PowerTree._checkIfhavePowerParentElement);e.conditionResult?(e.powerElement.className.includes("power-dropmenu")?this.isRootElement=!1:this.isRootElement=!0,e.powerElement.className.includes("power-menu")&&(this.isMenuElement=!0)):this.isRootElement=!0}hoverModeOn(){if(this.$powerUi.tmp.dropmenu._mouseIsMovingTo)this.$powerUi.tmp.dropmenu._mouseIsMovingTo.id!==this.id&&this.moveOverPossibleNewTarget(this);else for(const e of this.childrenPowerActions)e.subscribe({event:"mouseenter",fn:this.onMouseEnterAction,action:e,dropmenu:this}),e.subscribe({event:"click",fn:this.onMouseEnterAction,action:e,dropmenu:this})}onMouseEnterAction(e,t,i){if(this.$powerUi.tmp.dropmenu._mouseIsMovingTo)this.$powerUi.tmp.dropmenu._mouseIsMovingTo.id!==i.dropmenu.id&&i.dropmenu.moveOverPossibleNewTarget(this);else if(!i.action._$pwActive){i.action.toggle(),i.dropmenu.onMouseEnterItem(e,t,i,!0);for(const e of i.dropmenu.childrenPowerItems)e.subscribe({event:"mouseenter",fn:i.dropmenu.onMouseEnterItem,action:i.action,dropmenu:i.dropmenu,item:e});i.dropmenu.startWatchMouseMove(e,t,i)}}onMouseEnterItem(e,t,i,s){if(this.$powerUi.tmp.dropmenu._mouseIsMovingTo)this.$powerUi.tmp.dropmenu._mouseIsMovingTo.id!==i.dropmenu.id&&i.dropmenu.moveOverPossibleNewTarget(i.item);else{s||i.action._$pwActive&&i.action.toggle();for(const e of i.dropmenu.innerPowerActionsWithoutChildren)e._$pwActive&&e.toggle();for(const e of i.dropmenu.childrenPowerActions)e._$pwActive&&e.id!==i.action.id&&e.toggle();for(const e of i.dropmenu.childrenPowerItems)e.unsubscribe({event:"mouseenter",fn:i.dropmenu.onMouseEnterItem,action:i.action,dropmenu:i.dropmenu})}}hoverModeOff(){this.stopWatchMouseMove();for(const e of this.childrenPowerActions)e.unsubscribe({event:"mouseenter",fn:this.onMouseEnterAction,action:e,dropmenu:this}),e.unsubscribe({event:"click",fn:this.onMouseEnterAction,action:e,dropmenu:this})}moveOverPossibleNewTarget(e){this.$powerUi.tmp.dropmenu._possibleNewTarget=e}onmousestop(){if(this.$powerUi.tmp.dropmenu._possibleNewTarget&&!this.$powerUi.tmp.dropmenu._possibleNewTarget._$pwActive){const e=this.$powerUi.tmp.dropmenu._possibleNewTarget;setTimeout((function(){e.broadcast("mouseenter")}),10),this.stopWatchMouseMove()}else this.$powerUi.tmp.dropmenu._resetMouseTimeout()}resetMouseTimeout(){clearTimeout(this.$powerUi.tmp.dropmenu.timeout),this.$powerUi.tmp.dropmenu.timeout=setTimeout(this.$powerUi.tmp.dropmenu._onmousestop,120)}startWatchMouseMove(e,t,i){this.$powerUi.tmp.dropmenu._mouseIsMovingTo||(i.action.targetObj.subscribe({event:"mouseenter",fn:this.stopWatchMouseMove,action:i.action,dropmenu:i.dropmenu}),this.$powerUi.tmp.dropmenu._mouseIsMovingTo=i.action.targetObj,this.$powerUi.tmp.dropmenu._onmousestop=this.onmousestop.bind(this),this.$powerUi.tmp.dropmenu._resetMouseTimeout=this.resetMouseTimeout.bind(this),this.$powerUi.tmp.dropmenu.timeout=setTimeout(this.$powerUi.tmp.dropmenu._onmousestop,300),document.addEventListener("mousemove",this.$powerUi.tmp.dropmenu._resetMouseTimeout,!0))}stopWatchMouseMove(){this.$powerUi.tmp.dropmenu._mouseIsMovingTo=!1,this.$powerUi.tmp.dropmenu._possibleNewTarget=!1,clearTimeout(this.$powerUi.tmp.dropmenu.timeout),document.removeEventListener("mousemove",this.$powerUi.tmp.dropmenu._resetMouseTimeout,!0),this.unsubscribe({event:"mouseenter",fn:this.stopWatchMouseMove})}setPositionRightBottom(e){this.element.style.left=this.powerAction.element.offsetLeft+this.powerAction.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop+"px"}setPositionBottomRight(e){this.element.style.top=this.powerAction.element.offsetTop+this.powerAction.element.offsetHeight+"px",this.element.style.left=this.powerAction.element.offsetLeft+"px"}setPositionLeftBottom(e){this.element.style.left=this.powerAction.element.offsetLeft-this.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop+"px"}setPositionBottomLeft(e){const t=this.powerAction.element.offsetWidth-this.element.offsetWidth;this.element.style.left=this.powerAction.element.offsetLeft+t+"px"}setPositionRightTop(e){this.element.style.left=this.powerAction.element.offsetLeft+this.powerAction.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop-(this.element.offsetHeight-this.powerAction.element.offsetHeight)+"px"}setPositionTopRight(e){this.element.style.left=this.powerAction.element.offsetLeft+"px",this.element.style.top=this.powerAction.element.offsetTop-this.element.offsetHeight+"px"}setPositionLeftTop(e){this.element.style.left=this.powerAction.element.offsetLeft-this.element.offsetWidth+"px",this.element.style.top=this.powerAction.element.offsetTop-(this.element.offsetHeight-this.powerAction.element.offsetHeight)+"px"}setPositionTopLeft(e){const t=this.powerAction.element.offsetWidth-this.element.offsetWidth;this.element.style.left=this.powerAction.element.offsetLeft+t+"px",this.element.style.top=this.powerAction.element.offsetTop-this.element.offsetHeight+"px"}ifPositionOutOfScreenChangeDirection(){let e=!1;const t=this.element.getBoundingClientRect(),i={topDown:this.defaultPosition.includes("bottom")?"bottom":"top",leftRight:this.defaultPosition.includes("right")?"right":"left"},s={topDown:0,leftRight:0};t.right>document.defaultView.innerWidth?(i.leftRight="left",s.leftRight++,e=!0):t.left<0&&(i.leftRight="right",s.leftRight++,e=!0),t.bottom>document.defaultView.innerHeight?(i.topDown="top",s.topDown++,e=!0):t.top<0&&(i.topDown="bottom",s.topDown++,e=!0),(s.topDown>0||s.leftRight>0)&&("top"===i.topDown?"left"===i.leftRight?this.setPositionLeftTop():this.setPositionRightTop():"left"===i.leftRight?this.setPositionLeftBottom():this.setPositionRightBottom(),this.setPositionLimits()),e&&this.fixPositionIfInsideFixedElement()}setPositionLimits(){const e=this.element.getBoundingClientRect();e.left<0&&(this.element.style.left="0px"),e.top<0&&(this.element.style.top="0px")}resetDropmenuPosition(){this.element.style.top=null,this.element.style.left=null}toggle(){this.resetDropmenuPosition(),this.element.classList.add("power-hide");const e=this;this._$pwActive?this.$powerUi.touchdevice||this.hoverModeOff():(setTimeout((function(){"bottom-right"===e.defaultPosition?e.setPositionBottomRight():"right-bottom"===e.defaultPosition?e.setPositionRightBottom():"bottom-left"===e.defaultPosition?e.setPositionBottomLeft():"left-bottom"===e.defaultPosition?e.setPositionLeftBottom():"top-right"===e.defaultPosition?e.setPositionTopRight():"right-top"===e.defaultPosition?e.setPositionRightTop():"left-top"===e.defaultPosition?e.setPositionLeftTop():"top-left"===e.defaultPosition?e.setPositionTopLeft():e.setPositionRightBottom(),"fixed"===window.getComputedStyle(e.powerAction.element).position&&(e.element.style.position="fixed",e.element.style.left=window.getComputedStyle(e.powerAction.element).left),e.fixPositionIfInsideFixedElement(),e.ifPositionOutOfScreenChangeDirection(),e.element.classList.remove("power-hide")}),50),this.$powerUi.touchdevice||this.hoverModeOn()),this.powerAction.ifClickOut(),this.broadcast("toggle",!0)}action(){this.toggle()}fixPositionIfInsideFixedElement(){const e=this;let t=0,i=0,s=!1;if(PowerTree._searchUpDOM(e.element,(function(e){return e.classList.contains("power-dropmenu")?(s=!0,!0):(t+=e.scrollTop,i+=e.scrollLeft,"fixed"===window.getComputedStyle(e).getPropertyValue("position")||void 0)})).conditionResult&&!s){if(t>0){const i=parseInt(window.getComputedStyle(e.element).top.replace("px","")||0);e.element.style.top=i-t+"px"}if(i>0){const t=parseInt(window.getComputedStyle(e.element).left.replace("px","")||0);e.element.style.left=t-i+"px"}}}}PowerUi.injectPowerCss({name:"power-dropmenu"});class PowerItem extends PowerTarget{constructor(e){super(e)}}PowerUi.injectPowerCss({name:"power-item"});class PowerMain extends _PowerBasicElementWithEvents{constructor(e){super(e)}}PowerUi.injectPowerCss({name:"power-main",isMain:!0});class PowerMenu extends PowerTarget{constructor(e,t){super(e),this.isMenu=!0,this.$powerUi=t,this.order=0,this._$pwActive=!1,this.id=this.element.getAttribute("id"),this.powerTarget=!0,this.defaultPosition=this.element.getAttribute("data-power-position"),this.defaultPosition||(this.element.classList.contains("power-horizontal")?this.defaultPosition="bottom-right":this.defaultPosition="right-bottom")}init(){this.childrenPowerActions=this.getChildrenByPowerCss("powerAction"),this.innerPowerActionsWithoutChildren=this.getInnerWithoutChildrenByPowerCss("powerAction"),this.childrenPowerDropmenus=this.getChildrenByPowerCss("powerDropmenu"),this.innerPowerDropmenus=this.getInnerByPowerCss("powerDropmenu");for(const e of this.innerPowerDropmenus)e.isRootElement?defineRootDropmenusPosition(this,e):defineInnerDropmenusPosition(this,e);for(const e of this.childrenPowerActions)this.$powerUi.touchdevice||(e.subscribe({event:"click",fn:this.hoverModeOn,menu:this}),e.subscribe({event:"toggle",fn:this.maySetHoverModeOff,menu:this}))}hoverModeOn(e,t,i){for(const e of i.menu.childrenPowerActions)e.subscribe({event:"mouseenter",fn:i.menu.onMouseEnterAction,action:e,menu:i.menu})}onMouseEnterAction(e,t,i){i.menu.resetAnyDropdownTmpInfo(),i.action._$pwActive||i.action.toggle();for(const e of i.menu.innerPowerActionsWithoutChildren)e._$pwActive&&e.toggle();for(const e of i.menu.childrenPowerActions)e._$pwActive&&e.id!==i.action.id&&e.toggle()}maySetHoverModeOff(e,t,i){setTimeout((function(){let s=!1;for(const e of i.menu.childrenPowerActions)e._$pwActive&&(s=!0);!1===s&&i.menu.hoverModeOff(e,t,i)}),50)}hoverModeOff(e,t,i){for(const e of i.menu.childrenPowerActions)e.unsubscribe({event:"mouseenter",fn:i.menu.onMouseEnterAction,action:e,menu:i.menu})}resetAnyDropdownTmpInfo(){this.$powerUi.tmp.dropmenu._mouseIsMovingTo=!1,this.$powerUi.tmp.dropmenu._possibleNewTarget=!1,clearTimeout(this.$powerUi.tmp.dropmenu.timeout),document.removeEventListener("mousemove",this.$powerUi.tmp.dropmenu._resetMouseTimeout,!0),this.unsubscribe({event:"mouseenter",fn:this.stopWatchMouseMove})}toggle(){this.powerAction.ifClickOut(),this.powerAction.broadcast("toggle",!0)}action(){this.toggle()}}PowerUi.injectPowerCss({name:"power-menu",isMain:!0});class PowerStatus extends PowerTarget{constructor(e){super(e);const t=this.element.getAttribute("data-power-active"),i=this.element.getAttribute("data-power-inactive");this.activeValues=t?t.split(" "):[],this.inactiveValues=i?i.split(" "):[],this.inactive()}active(){for(const e of this.activeValues)this.element.classList.add(e);for(const e of this.inactiveValues)this.element.classList.remove(e)}inactive(){for(const e of this.inactiveValues)this.element.classList.add(e);for(const e of this.activeValues)this.element.classList.remove(e)}toggle(){this._$pwActive=!this._$pwActive,this._$pwActive?this.active():this.inactive()}init(){let e=!1,t=this.element.parentElement;const i=this.$powerUi.powerTree.allPowerObjsById;for(;!e;){if(t)for(const e of Object.keys(i[t.id]||{}))i[t.id][e].powerTarget&&(this.targetObj=i[t.id][e]);this.targetObj||e?e=!0:t=t.parentElement}this.targetObj&&this.targetObj.subscribe({event:"toggle",fn:this.toggle.bind(this)})}}PowerUi.injectPowerCss({name:"power-status"});class PowerTabs extends PowerTarget{constructor(e){super(e)}init(){this.childrenSections=this.getChildrenByPowerCss("powerTabSection"),this.childrenActions=this.getChildrenByPowerCss("powerAction"),this.childrenActions[0].element.classList.add("power-active"),this.childrenSections[0].element.classList.add("power-active"),this.childrenActions[0]._$pwActive=!0,this.childrenSections[0]._$pwActive=!0}}PowerUi.injectPowerCss({name:"power-tabs"});class PowerTabSection extends PowerTarget{constructor(e){super(e)}init(){let e=this.parent;do{"powerTabs"===e.$powerCss?this.powerTabs=e:e=e.parent}while(e&&"powerTabs"!==e.$powerCss)}action(){if(!0===this._$pwActive)return this.powerAction._$pwActive=!1,void this.powerAction.broadcast("toggle",!0);for(const e of Object.keys(this.powerTabs.childrenActions||{})){const t=this.powerTabs.childrenActions[e];t.targetObj.id!==this.powerTabs.id&&t._$pwActive&&this!==t.targetObj&&(t.toggle({avoidCallAction:!0}),t.targetObj.active=!t.targetObj.active)}}}PowerUi.injectPowerCss({name:"power-tab-section"});class PowerTreeView extends PowerTarget{constructor(e){super(e),e.dataset.onClickFile&&(this.mainNode=!0)}init(){const e=this.$pwView;if(this.ctrlScope=!!(e&&e.id&&this.$powerUi.controllers[e.id])&&this.$powerUi.controllers[e.id].instance,this.mainNode){const e=this.element.getElementsByClassName("power-item");for(const t of e){const e=this.$powerUi.powerTree.allPowerObjsById[t.id];if(e&&e.powerItem){const i=this.$powerUi.getObjectOnScope({text:this.element.dataset.onClickFile,$powerUi:this.$powerUi,scope:this.ctrlScope});e.powerItem.subscribe({fn:i,event:"click",ctx:this.ctrlScope,path:decodeURI(e.powerItem.element.dataset.filePath),element:t})}}}}}PowerUi.injectPowerCss({name:"power-tree-view"});